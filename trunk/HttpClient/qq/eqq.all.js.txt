Jet().$package("EQQ.Global",function(b){var e=this,c=b.dom,a=b.event,d=b.cookie,f=b.http;this.initGlobal=function(){EQQ.vfwebqq=qqweb.portal.getVfWebQQ();};});Jet().$package("EQQ.Adapter",function(b){var e=this,c=b.dom,a=b.event,d=b.cookie,g=b.http;this.proxysend=function f(h,i){qqweb.rpcService.send(h,{context:null,method:i.method||"GET",data:"r="+encodeURIComponent(b.json.stringify(i.param)),onSuccess:i.onSuccess,onError:i.onError});};EQQ.BASE_CONST=qqweb.CONST;});Jet().$package("EQQ.Extend",function(c){var g=this,e=c.dom,b=c.event,f=c.cookie,h=c.http;var d=function(k,n){var j=k.length;var m=function(){j--;if(j==0){n();}};for(var l=0;l<j;l++){k[l](m);}};var a=function a(i,j){return function(k){j.onError=j.errback||function(){};k=k||function(){};j.onSuccess=function(l){k(l);j.callback(l);};EQQ.Adapter.proxysend(i,j);};};g.cgi_module=a;g.require=d;});Jet().$package("EQQ",function(i){var x=this,v=i.dom,u=i.event,w=i.cookie,t=i.http;var r=false;var c=false;var l={};var M=3;var N;var z;var f=false;var C=false;var F;F=window.location.host;i.out(">>dName: "+F);this.showLogin=function(J){J=J||{};if(!w.get("ptwebqq")||qqweb.portal.getLoginLevel()<3){qqweb.portal.showLoginWindow("eqq",true);return;}EQQ.init2({panel:{myPanel:qqweb.layout.getPanel("qqBar").body,mainPanel:x.getSideBar().body,mainBar:qqweb.layout.getPanel("statusBar").body,taskBar:qqweb.layout.getPanel("taskBar").body}});};var D={onExit:function(){if(!qqweb.portal.confirm("您确认要关闭 WebQQ 吗？")){return;}x.executeExit();},onNeedLogin:function(J){qqweb.portal.showLoginWindow("eqq");}};this.CONST={MAIN_DOMAIN:"qq.com",EQQ_SERVER_URL:"http://"+F+"/",CONN_SERVER_DOMAIN:"http://web2-b.qq.com/",CONN_SERVER_DOMAINS:["http://web2-b.qq.com/"],CONN_PROXY_URLS:["http://web2-b.qq.com/proxy.html?v=20101025002"],CONN_SERVER_DOMAIN2:"http://web.qq.com/",CONN_PROXY_URL:"http://web2-b.qq.com/proxy.html?v=20101025002",CHAT_PIC_SERVER:"http://"+F+"/",AVATAR_SERVER_DOMAIN:"http://qun.qq.com/",AVATAR_SERVER_DOMAINS:["http://face1.qun.qq.com/","http://face2.qun.qq.com/","http://face3.qun.qq.com/","http://face4.qun.qq.com/","http://face5.qun.qq.com/","http://face6.qun.qq.com/","http://face7.qun.qq.com/","http://face8.qun.qq.com/","http://face9.qun.qq.com/","http://face10.qun.qq.com/"],SYSTEM_FACE_URL:"http://"+F+"/style/face/",LOGIN_PROTECT_FINISH_URL:"./login_protect.html",UPLOAD_CUSTOM_FACE_SERVER:"http://web.qq.com/cgi-bin/cface_upload",DOWNLOAD_CHAT_LOG_SERVER:"http://sns.qq.com/buddy_state/feed/save_chat.php",FILE_SERVER:"http://file1.web.qq.com/",OFFLINE_FILE_SERVER:"http://weboffline.ftn.qq.com:80/ftn_access/",QZONE_SERVER_DOMAIN:"http://qzone.qq.com/",QZONE_USER_SERVER_DOMAIN:"http://user.qzone.qq.com/",QQ_GROUP_URL:"http://qun.qq.com/air/",MAX_LOGIN_AMOUNT:1,MAX_FAIL_AMOUNT:2,Z_INDEX_BASE:3000,LOAD_AVATAR_AMOUNT:50,TRANSFER_TABLE:[14,1,2,3,4,5,6,7,8,9,10,11,12,13,0,50,51,96,53,54,73,74,75,76,77,78,55,56,57,58,79,80,81,82,83,84,85,86,87,88,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,32,113,114,115,63,64,59,33,34,116,36,37,38,91,92,93,29,117,72,45,42,39,62,46,47,71,95,118,119,120,121,122,123,124,27,21,23,25,26,125,126,127,128,129,130,131,132,133,134,52,24,22,20,60,61,89,90,31,94,65,35,66,67,68,69,70,15,16,17,18,19,28,30,40,41,43,44,48,49],T_TRANSFER_TABLE:{14:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,0:14,50:15,51:16,96:17,53:18,54:19,73:20,74:21,75:22,76:23,77:24,78:25,55:26,56:27,57:28,58:29,79:30,80:31,81:32,82:33,83:34,84:35,85:36,86:37,87:38,88:39,97:40,98:41,99:42,100:43,101:44,102:45,103:46,104:47,105:48,106:49,107:50,108:51,109:52,110:53,111:54,112:55,32:56,113:57,114:58,115:59,63:60,64:61,59:62,33:63,34:64,116:65,36:66,37:67,38:68,91:69,92:70,93:71,29:72,117:73,72:74,45:75,42:76,39:77,62:78,46:79,47:80,71:81,95:82,118:83,119:84,120:85,121:86,122:87,123:88,124:89,27:90,21:91,23:92,25:93,26:94,125:95,126:96,127:97,128:98,129:99,130:100,131:101,132:102,133:103,134:104,52:105,24:106,22:107,20:108,60:109,61:110,89:111,90:112,31:113,94:114,65:115,35:116,66:117,67:118,68:119,69:120,70:121,15:122,16:123,17:124,18:125,19:126,28:127,30:128,40:129,41:130,43:131,44:132,48:133,49:134}};this.hash={onlineStatus:{callme:"callme",online:"online",away:"away",busy:"busy",silent:"silent",hidden:"hidden",offline:"offline"},onlineStatusText:{callme:"Q我吧",online:"在线",away:"离开",busy:"忙碌",silent:"静音",hidden:"隐身",offline:"离线"},clientType:{1:"PC",2:"PC",3:"PC",4:"PC",5:"PC",6:"PC",10:"PC",21:"Phone",22:"Phone",23:"Phone",24:"Phone",41:"WebQQ",10000:"PC"},clientTypeText:{1:"PC",2:"PC",3:"PC",4:"PC",5:"PC",6:"PC",10:"PC",21:"手机QQ",22:"手机QQ",23:"手机QQ",24:"手机QQ",41:"WebQQ",10000:"PC"},userClassType:{online:"online",stranger:"stranger",blacklist:"blacklist"}},document.domain=this.CONST.MAIN_DOMAIN;var d=function(J){if(J.keyCode===27){J.preventDefault();}};u.on(document,"keydown",d);var P=function(T){var J=T.msgList[0].type;switch(J){case"single":qqweb.sound.playSound("./sound/msg.mp3",true);break;case"group":var S=EQQ.Model.BuddyList.getGroupMask();var R=EQQ.Model.BuddyList.getGroupByGid(T.gid);if(S===1||(parseInt(S)===0&&parseInt(R.mask)===0)){qqweb.sound.playSound("./sound/msg.mp3",true);}break;case"system":case"mysigntips":case"mail":qqweb.sound.playSound("./sound/system.mp3",true);break;}};this.init2=function(R){r=false;c=false;l={};N=null;z=null;f=false;C=false;this.panel=R.panel||{};p;g=0;O=false;m=0;u.addObserver(qqweb.portal,"exit",k);u.addObserver(EQQ,"LoginSuccess",H);u.addObserver(x,"LoginFailure",j);u.addObserver(x,"VerifyLoginProtectSuccess",n);u.addObserver(x,"MessageReceive",P);u.addObserver(x,"exit",D.onExit);u.addObserver(x,"needLogin",D.onNeedLogin);u.addObserver(EQQ.RPCService,"NotLogin",A);u.addObserver(EQQ.RPCService,"FailCountOverMax",s);u.addObserver(EQQ,"ReLinkSuccess",L);u.addObserver(EQQ,"ReLinkFailure",s);u.addObserver(EQQ,"UinNotInWhitelist",q);u.addObserver(EQQ,"UinInBlacklist",y);u.addObserver(EQQ,"Overload",b);u.addObserver(EQQ,"PtwebqqFail",o);u.addObserver(EQQ.RPCService,"LogoutSuccess",G);u.addObserver(EQQ.RPCService,"PollComplete",I);u.addObserver(EQQ.RPCService,"CheckProtectSuccess",K);x.createContainer();EQQ.RPCService.init();EQQ.Presenter.MainPanel.init();try{EQQ.Presenter.ChatBox.init();EQQ.Presenter.TaskBar.init();}catch(S){}EQQ.Model.BuddyList.init();EQQ.Model.ChatMsg.init();var J=EQQ.Presenter.MainPanel.getCookieTips();if(J&&J=="hide"){}else{}EQQ.Presenter.MainPanel.show();x.login();};this.loginEQQ=function(J){this.showLogin();};this.getDefaultState=function(){var J=EQQ.hash.onlineStatus[i.string.mapQuery(window.location.search).login_state||"online"];return J;};this.getUserDefaultAvatar=function(J){J=J||40;return"./style/images/avatar_default_"+J+"_"+J+".gif";};this.getFaceServer=function(J){return EQQ.CONST.AVATAR_SERVER_DOMAINS[(J%10)];};this.getUserAvatar=function(R,J){return EQQ.getFaceServer(R)+"cgi/svr/face/getface?cache=0&type=1&fid=0&uin="+R;};this.getGroupAvatar=function(R,J){return EQQ.getFaceServer(R)+"cgi/svr/face/getface?cache=0&type=4&fid=0&uin="+R;};this.getQzoneUrl=function(J){return EQQ.CONST.QZONE_USER_SERVER_DOMAIN+J;};this.getSendMailUrl=function(J){return"http://mail.qq.com/cgi-bin/login?Fun=clientwrite&vm=pt&email="+J+"@qq.com";};this.createContainer=function(){this.document=v.getDoc();this.container=v.node("div",{id:"EQQ_Container","class":"EQQ_Container"});this.container.innerHTML='			<div id="EQQ_MsgBox" class="EQQ_msgBox">				<div class="EQQ_titleInMsgBox">					<div class="EQQ_titleTextInMsgBox">消息盒子</div>					<div id="EQQ_ViewMainPanelButtonInMsgBox" class="EQQ_viewMainPanelButtonInMsgBox" title="点击查看好友列表">好友列表</div>				</div>				<div id="EQQ_MessageList" class="EQQ_messageList">				</div>				<div id="EQQ_IgnoreAllMsgButtonInMsgBox" class="EQQ_ignoreAllMsgButtonInMsgBox" title="点击忽略全部消息">忽略全部</div>			</div>			<div id="EQQ_LoginBox" class="EQQ_LoginBox">				<div class="EQQ_LoginBox_Title">					<div id="EQQ_LoginBox_CloseButton" class="EQQ_LoginBox_CloseButton" title="关闭">X</div>					<div class="EQQ_LoginBox_TitleText">WebQQ登录保护</div>				</div>				<iframe id="EQQ_LoginBox_Iframe" class="EQQ_LoginBox_Iframe" src="about:blank" frameborder="no" scrolling="no"></iframe>			</div>		';this.document.body.appendChild(this.container);};this.getCookieUin=function(){return parseInt(i.cookie.get("uin",EQQ.CONST.MAIN_DOMAIN).substr(1),10);};this.getCookieSkey=function(){return i.cookie.get("skey",EQQ.CONST.MAIN_DOMAIN);};this.getCookiePtWebQQ=function(){return i.cookie.get("ptwebqq",EQQ.CONST.MAIN_DOMAIN);};this.getVfWebQQ=function(){return N;};this.setVfWebQQ=function(J){N=J;};this.getPsessionid=function(){return z;};this.dna_result_key="";this.login=function(J){EQQ.Presenter.MainPanel.showLogin();this.loginStart=(new Date()).getTime();var R={status:J||"",ptwebqq:qqweb.portal.getPtwebqq(),passwd_sig:this.dna_result_key};EQQ.RPCService.sendLogin(R);};var e=function(){var J=qqweb.config.configList.chatboxMode;var R=qqweb.config.configList.isNotNeedCtrlKey;EQQ.initChatboxMode(J);EQQ.initSendMsgKey(R);var S=qqweb.portal.getLoginLevel();if(S>2){u.notifyObservers(EQQ,"eqqUacChange",{chatboxMode:J,isNotNeedCtrlKey:R});}};var K=function(J){if(J.type=="nop"){EQQ.Presenter.MainPanel.toggleShow();}else{if(J.type=="url"){}}};var n=function(J){if(J){x.dna_result_key=J;EQQ.Presenter.MainPanel.toggleShow();}};var k=function(){x.executeExit();};this.executeExit=function(){try{EQQ.View.ChatBox.onExitHotkey();}catch(J){}u.notifyObservers(EQQ,"CloseWebQQ");EQQ.stopPoll();EQQ.logout();qqweb.portal.removeExitConfirm();setTimeout(function(){u.notifyObservers(EQQ,"exitSuccess");},1000);};this.logout=function(){EQQ.setIsLogin(false);EQQ.RPCService.sendLogout();};this.reLogin=function(){this.login(EQQ.Model.BuddyList.getSelf().oldState);};var q=function(J){window.location=qqweb.CONST.MAIN_URL+"overload.html";};var y=function(J){};var b=function(J){window.location=qqweb.CONST.MAIN_URL+"overload.html";};var o=function(J){j(J);alert("验证信息过期，请重新登录！");window.location.reload();};var h=function(){var J=EQQ.Model.BuddyList.getSelf().oldState;var R={status:J,ptwebqq:x.ptWebQQ,passwd_sig:x.dna_result_key};EQQ.RPCService.sendReLink(R);};var L=function(){M=3;this.startPoll();e();};var s=function(){x.stopPoll();if(M>1){setTimeout(function(){h();M--;},10000);}else{var J="因网络或其他原因与服务器失去联系，请重新登录。";u.notifyObservers(x,"SelfOffline",J);}};var A=function(){var J="因网络或其他原因与服务器失去联系，请重新登录。";u.notifyObservers(x,"SelfOffline",J);};var G=function(){var J="您已登出";u.notifyObservers(EQQ,"exitSuccess");};var I=function(){var J=EQQ.getIsLogin();if(J){if(typeof EQQ!=="undefined"){EQQ.keepPoll();}}};var H=function(J){i.out("登录第一步成功");M=3;N=J.vfwebqq;z=J.psessionid;u.notifyObservers(qqweb.portal,"GetLoginInfoSuccess");x.start(J);e();};this.start=function(J){EQQ.setIsLogin(true);qqweb.portal.addExitConfirm();this.mode="master";i.out("start: "+EQQ);EQQ.Global.initGlobal();EQQ.Model.BuddyList.reset();EQQ.Presenter.MainPanel.View.showPullData();EQQ.Extend.require([EQQ.Model.BuddyList.sendGetBuddyList({h:"hello"}),EQQ.Model.BuddyList.sendGetGroupList()],function(){B.inject();EQQ.startPoll();EQQ.Model.BuddyList.sendGetRecentList({})();setTimeout(function(){EQQ.api.makeCall();},13);qqweb.portal.speedTest.sRTS(11,"end",(new Date()),true);});if(r){}else{r=true;this.timer=window.setInterval(E,60000);}};var B={inject:function(){qqweb.portal.addNotificationSource(EQQ,"NotifyMessage","NotifyHasHandled");u.addObserver(EQQ,"MessageReceive",B.onMessageReceive);u.addObserver(EQQ,"NotifyHasHandled",B.onNotifyHasHandled);},onMessageReceive:function(J){var S=[],V,R=J.uin||J.gid;for(var T in J.msgList){var Y=J.msgList[T];if(!R){R=Y.from_uin;}V={targetModel:EQQ,uin:R,type:Y.type,msgId:Y.msg_id,title:R,content:"",time:Y.time||i.date.format(new Date(),"YYYY-MM-DD hh:mm:ss"),isAllow:true,extraInfo:{}};switch(Y.type){case"single":var X=EQQ.api.__api.getChatBox(R);V.title=(Y.sender?(Y.sender.htmlShowName||R):R);V.content=EQQ.util.trimChatMsg(Y);V.extraInfo={isChatBoxOpen:X};break;case"group":var X=EQQ.api.__api.getChatBox(R);var W=EQQ.Model.BuddyList.isGroupPrompt(R);var U=EQQ.Model.BuddyList.getGroupByGid(R);V.title=(U?(U.htmlShowName||R):R);V.content=EQQ.util.trimChatMsg(Y);V.isAllow=W;V.extraInfo={isChatBoxOpen:X};break;case"system":V.content=Y.content;V.extraInfo={uin:Y.opt.uin,nick:Y.opt.nick,allow:Y.opt.allow,type:Y.opt.type,msg:Y.opt.msg,gid:Y.opt.gid};break;default:break;}if(!V.extraInfo.isChatBoxOpen){S.push(V);}}u.notifyObservers(EQQ,"NotifyMessage",S);},onNotifyHasHandled:function(R){switch(R.type){case"single":EQQ.api.call(["chat",["single",R.uin]]);break;case"group":var J=EQQ.Model.BuddyList.getGroupByGid(R.uin);EQQ.api.call(["chat",["group",J.code]]);break;case"system":qqweb.portal.runApp("buddyAdder",R.extraInfo);break;default:break;}}};var j=function(J){EQQ.setIsLogin(false);i.out("对不起，登录失败！");qqweb.portal.setLoginLevel(qqweb.CONST.LOGIN_LEVEL_NOCHAT);EQQ.Presenter.MainPanel.showReLoginPanel();};var Q=0;var E=function(){if(Q>240){Q=0;}u.notifyObservers(EQQ,"NotifyBeat_1");if((Q%2)==0){u.notifyObservers(EQQ,"NotifyBeat_2");}if((Q%5)==0){u.notifyObservers(EQQ,"NotifyBeat_5");if((Q%10)==0){u.notifyObservers(EQQ,"NotifyBeat_10");if((Q%30)==0){u.notifyObservers(EQQ,"NotifyBeat_30");if((Q%60)==0){u.notifyObservers(EQQ,"NotifyBeat_60");if((Q%120)==0){u.notifyObservers(EQQ,"NotifyBeat_120");if((Q%240)==0){u.notifyObservers(EQQ,"NotifyBeat_240");}}}}}}Q++;};var p;var g=0;var O=false;var m=0;this.startBeat2=function(){O=true;g=0;p=window.setInterval(a,250);i.out(">>>>>>>>>: startBeat2");};this.stopBeat2=function(){O=false;window.clearInterval(p);g=0;p=null;i.out(">>>>>>>>>: stopBeat2");};this.isStartBeat2=function(){return O;};this.addNeedBeat2=function(J){if(!l[J]){l[J]=true;m++;}if(!EQQ.isStartBeat2()){EQQ.startBeat2();}};this.removeNeedBeat2=function(J){if(l[J]){if(m>0){m--;}}if(m===0){EQQ.stopBeat2();}};var a=function(){if(g>5000){g=0;}u.notifyObservers(EQQ,"NotifyBeat_250");if((g%2)==0){u.notifyObservers(EQQ,"NotifyBeat_500");if((g%6)==0){u.notifyObservers(EQQ,"NotifyBeat_1000");}if((g%10)==0){u.notifyObservers(EQQ,"NotifyBeat_3000");if((g%20)==0){u.notifyObservers(EQQ,"NotifyBeat_5000");}}}g++;};this.startPoll=function(){this.setNeedPollFlag(true);this.keepPoll();};this.keepPoll=function(){if(this.getNeedPollFlag()){EQQ.RPCService.sendPoll();}};this.setNeedPollFlag=function(J){return f=J;};this.getNeedPollFlag=function(){return f;};this.stopPoll=function(){this.setNeedPollFlag(false);};});Jet().$package("EQQ.util",function(g){var o=g.dom,n=g.event,i=g.string,l=g.http;var j=1;var f=function(v,B){var F="";if(B){for(var z=0;z<v.content.length;z++){var y=v.content[z];if(y[0]==="face"){F+=t(y[1]);}else{if(y[0]==="cface"){if(v.type=="group"){F+=e(y[2]);}else{F+=e(y[1]);}}else{if(y[0]==="cface_idx"){if(v.type=="group"){F+=e(y[2]);}else{F+=e(y[1]);}}else{if(y[0]==="pic_id"){}else{if(y[0]==="image"){}else{if(y[0]==="offpic"){var w=EQQ.Model.ChatMsg.getSendPicUrlByFilePath(y[1]);if(w!=""){F+=q(w);}}else{if(y[0]==="rffile"){F+='<div class="msgFileBox">您拒绝接收"'+i.encodeHtmlSimple(y[1])+'",文件传输失败.</div>';}else{if(y[0]==="agfile"){F+='<div class="msgFileBox">您同意了接收文件"'+i.encodeHtmlSimple(y[1])+'".</div>';}else{if(y[0]==="sendfile"){F+='<div class="msgFileBox">您发送文件"'+i.encodeHtmlSimple(y[1])+'"给对方.</div>';}else{if(y[0]==="transtimeout"){F+='<div class="msgFileBox">接收文件"'+i.encodeHtmlSimple(y[1])+'"超时,文件传输失败.</div>';}else{if(y[0]==="refusedbyclient"){F+='<div class="msgFileBox">对方取消了接收文件"'+i.encodeHtmlSimple(y[1])+'",文件传输失败.</div>';}else{if(y[0]==="transok"){F+='<div class="msgFileBox">文件"'+i.encodeHtmlSimple(y[1])+'"传输成功.</div>';}else{if(y[0]==="transerror"){F+='<div class="msgFileBox">对方取消了接收文件"'+i.encodeHtmlSimple(y[1])+'"或传输错误,文件传输失败.</div>';}else{if(!g.isArray(y)){if(g.browser.ie){y=y.replace(/\r/ig,"[br/]");}else{y=y.replace(/\r|\n/ig,"[br/]");}F+=h(i.encodeHtmlSimple(h(y,1)),2);}}}}}}}}}}}}}}}}else{var u=v.sender_uin||v.from_uin;var A=v.from_uin||0;var D=[];var E;var x;if(v.content[0][0]!=="font"){x=0;}else{x=1;}for(;x<v.content.length;x++){var y=v.content[x];if(y[0]==="face"){F+=t(y[1]);}else{if(y[0]==="cface"){D.push(y);if(v.type=="group"){F+=d(y[1],v.group_code,v.sender_uin);}else{F+=p(v.msg_id,y[1],u);}}else{if(y[0]==="cface_idx"){if(v.type=="group"){F+=k(v.msg_id,D[y[1]][1],v.group_code,v.time);}else{F+=p(v.msg_id,D[y[1]][1],u);}}else{if(y[0]==="pic_id"){E=y[1];}else{if(y[0]==="image"){F+=c(E,u,y[2],y[1]);}else{if(y[0]==="offpic"){if(y[1].success==1){F+=m(y[1].file_path,A);}else{F+=s();}}else{if(y[0]==="rfile"){var C=v.from_uin+"_"+y[2];var G=EQQ.Model.ChatMsg.getFilesList();F+='<div class="msgFileBox">对方给您发送文件:<br />';F+='<span class="icon_'+b(y[1])+'">&nbsp;</span>'+i.encodeHtmlSimple(y[1]);F+='<span class="fileAct">';if(G[C].isread){F+="&nbsp;[同意][拒绝]";}else{F+='&nbsp;<a id="agree_'+C+'" href="#">[同意]</a>';F+='&nbsp;<a id="refuse_'+C+'" href="#">[拒绝]</a>';}F+="</span>";F+="</div>";}else{if(y[0]==="rffile"){F+='<div class="msgFileBox">对方取消了接收文件"'+i.encodeHtmlSimple(y[1])+'",文件传输失败.</div>';}else{if(y[0]==="rtfile"){F+='<div class="msgFileBox">接收文件"'+i.encodeHtmlSimple(y[1])+'"超时,文件传输失败.</div>';}else{if(y[0]==="wrfile"){F+='<div class="msgFileBox">对方已同意接收"'+i.encodeHtmlSimple(y[1])+'",开始传输文件.</div>';}else{if(y[0]==="wrffile"){F+='<div class="msgFileBox">对方拒绝了接收文件"'+i.encodeHtmlSimple(y[1])+'",文件传输失败.</div>';}else{if(y[0]==="video"){F+=i.encodeHtmlSimple(y[1]);}else{if(g.browser.ie){y=y.replace(/\r/ig,"[br/]");}else{y=y.replace(/\r|\n/ig,"[br/]");}F+=h(i.encodeHtmlSimple(h(y,1)),2);}}}}}}}}}}}}}}F=F.replace(/\[br\/\]/g,"<br/>");return F;};var t=function(u){return'<img class="EQQ_faceImg" src="'+EQQ.CONST.SYSTEM_FACE_URL+EQQ.CONST.T_TRANSFER_TABLE[u]+'.gif" />';};var p=function(w,u,x,v){v=v||5;return'<img src="'+EQQ.CONST.CONN_SERVER_DOMAIN+"channel/get_cface?lcid="+w+"&guid="+u+"&to="+x+"&count="+v+"&time=1&clientid="+EQQ.RPCService.getClientId()+"&psessionid="+EQQ.getPsessionid()+'" id="_cface_'+(j++)+'" title="图片或自定义表情" />';};var k=function(x,u,v,w){var y=Math.round(new Date().getTime()/1000);return'<img src="'+EQQ.CONST.AVATAR_SERVER_DOMAIN+"cgi/svr/chatimg/get?pic="+u.name+"&gid="+v+"&time="+y+'" id="_cface_'+(j++)+'" title="图片或自定义表情" />';};var d=function(x,w,v){var u=x.server.toString().split(":");return'<img src="'+EQQ.CONST.CHAT_PIC_SERVER+"cgi-bin/get_group_pic?gid="+w+"&uin="+v+"&rip="+u[0]+"&rport="+u[1]+"&fid="+x.file_id+"&pic="+x.name+'" id="_cface_'+(j++)+'" title="图片或自定义表情" />';};var q=function(u){return'<img src="'+u+'" id="cface_'+(j++)+'" title="图片或自定义表情" />';};var c=function(x,w,y,u,v){return'<img src="'+EQQ.CONST.CONN_SERVER_DOMAIN+"channel/get_image?lcid="+x+"&guid={"+w+"}"+u+"."+v+"&to="+y+'&count=1&time=1" id="_cface_'+(j++)+"&psessionid="+EQQ.getPsessionid()+'" title="图片或自定义表情" />';};var e=function(u){return'<img src="'+EQQ.CONST.CONN_SERVER_DOMAIN2+"cgi-bin/webqq_app/?cmd=2&bd="+u+'" id="_cface_'+(j++)+'" title="图片或自定义表情" />';};var m=function(u,v){return'<img src="'+EQQ.CONST.CONN_SERVER_DOMAIN+"channel/get_offpic?file_path="+u+"&f_uin="+v+"&clientid="+EQQ.Model.ChatMsg.getClientidFromRpc()+"&psessionid="+EQQ.getPsessionid()+'" id="_cface_'+(j++)+'" title="图片或自定义表情" />';};var s=function(){return'<img src="style/images/img_error.gif" title="图片或自定义表情接收错误或不存在" />';};var r=function(v){var u=f(v);u=u.replace(/^(<br \/>|&nbsp;)+/ig,"");u=u.replace(/(<a([^>]+)>|<\/a>)/ig,"");u=u.replace(/<div class="msgFileBox">([\s\S]+?)<\/div>/ig,function(x){x=x.replace(/(<span([\s\S]+?)<\/span>)+?/ig,"");x=x.replace(/(:<br \/>)+?/ig,":");return x.replace(/(<div([^>]+?)>|<\/div>)+/ig,"");});var w=u.indexOf("<br />");if(w!=-1){u=u.substr(0,w);}u=u.replace(/(&nbsp;)+$/ig,"");u=u.replace(/<img.*?\/?>/ig,function(x){if(/class="EQQ_faceImg"/.test(x)){return x;}else{return'<img src="./style/images/image_icon.png" />';}});return u;};var h=function(v,u){if(u===2){var w=/\[url\][\s\S]+?\[\/url\]/g;v=v.replace(w,function(y){y=y.replace(/(\[url\]|\[\/url\])/g,"");var x=y.replace(/^www\./,function(z){return"http://"+z;});return'<a href="'+x+'" target="_blank"><span class="msgLink">'+y+"</span></a>";});}else{var w=/((([a-zA-Z0-9]{3,10})?:\/\/)|(www\.)){1}[\w\.\/\?=%&@:#;\*\$\[\]\(\){}'"\-]+([0-9a-zA-Z\/#])+?/g;v=v.replace(w,function(x){return"[url]"+x+"[/url]";});}return v;};var a=function(y){if(y[0]==="font"){var v=y[1].style;var x=g.string.encodeHtmlAttributeSimple(y[1].name+"");x=x.match(/宋体|黑体|隶书|微软雅黑|楷体_GB2312|幼圆|Arial Black|Arial|Verdana|Times New Roman/);if(x){x=x[0];}else{x="宋体";}var u=y[1].color.match(/([0-9a-f]{6})/);if(u){u=u[0];}else{u="000";}var w="color:#"+u+";font-family:"+x+";font-size:"+Number(y[1].size)+"pt;font-weight:"+(!!v[0]?"bold":"normal")+";font-style:"+(!!v[1]?"italic":"normal")+";text-decoration:"+(!!v[2]?"underline":"none")+";";return w;}else{return"";}};var b=function(w){if(typeof(w)=="undefined"||w==""){return;}var u=w.split("."),v=u[u.length-1].toLowerCase();switch(v){case"excel":case"xls":case"xlsx":v="excel";break;case"doc":case"docx":v="word";break;case"ppt":case"pptx":v="ppt";break;case"bmp":case"png":case"gif":case"jpeg":case"jpg":case"ico":v="pic";break;case"tga":case"tif":case"psd":case"tiff":v="pic";break;case"mov":case"avi":case"mpeg":case"mpg":case"ra":case"rm":case"rmvb":case"qt":case"asf":case"wmv":case"swf":case"flv":case"mp4":v="media";break;case"mp3":case"wav":case"mid":v="music";break;case"arj":case"rar":case"zip":case"jar":case"7z":case"tar":case"uc2":case"gz":case"lha":case"ace":case"tgz":v="rar-zip";break;case"txt":case"text":v="share-txt";break;case"pdf":v="pdf16";break;case"com":v="exe16";break;default:v="others";break;}return v;};this.translateFontStyle=a;this.translateChatMsg=f;this.trimChatMsg=r;this.Marquee=new g.Class({init:function(u){var v=this;this.speed=u.speed||40;this.stopTime=u.stopTime||3000;this.lineHeight=u.lineHeight||20;this.target=u.target;this.timer=null;this.lineTimer=null;this.intervaler=null;this.scrollHeight=this.lineHeight;this.isStop=false;this._onTimeRun=function(){v.scrollOneLine();};},scrollOneLine:function(){if(this.scrollHeight>0){this.scrollHeight--;var u=this.target.style.top.match(/-?\d+/);u=(!u)?0:parseInt(u[0]);this.target.style.top=(--u)+"px";this.lineTimer=setTimeout(this._onTimeRun,this.speed);}else{if(!this.isStop){this.update();}}},stop:function(){if(this.timer){clearTimeout(this.timer);}},stopAll:function(){this.stop();if(this.lineTimer){clearTimeout(this.lineTimer);}},reset:function(){this.target.style.top="0px";},update:function(){if(this.isStop){return;}if(this.timer){clearTimeout(this.timer);}this.scrollHeight=this.lineHeight;var v=this.target.style.top.match(/\d+/);var u=o.getScrollHeight(this.target);if(!!v&&!!u){v=parseInt(v[0]);if(v>=u){this.target.style.top=this.lineHeight+"px";this.scrollOneLine();return;}}this.timer=setTimeout(this._onTimeRun,this.stopTime);},walkOnLastLine:function(){this._onTimeRun();}});});Jet().$package("EQQ.RPCService",function(k){var v=this,e=this,s=k.dom,q=k.event,h=(new Date()).getTime(),d=0,x=0,r=String(k.random(0,99))+String((new Date()).getTime()%1000000),n=0,g=0,w=false,f=0;var i=EQQ.CONST.CONN_SERVER_DOMAINS[0];var p;var l=function(){var y=function(z){return z.replace(/r=|http:\/\/web2-b.qq.com\//g,"").replace(/,"/g,":").replace(/[{"}/]/g,"");};return function(C,z){if(arguments.length==2){return !z||arguments.callee(C);}else{var A=qqweb.portal.getUin();if(C.status){var B=[A,C.status,decodeURIComponent(C.data),C.uri].join(":");}else{C=C.o;var B=[A,C.responseText+":",decodeURIComponent(C.data),C.uri].join(":");}if(true||Math.random()<0.1){qqweb.rpcService.formSend("http://tj.qstatic.com/log",{method:"POST",data:{r:y(B)}});}}};};l=l();var b=function(){d++;k.out("onFail: "+d);if(d>4){d=0;q.notifyObservers(v,"FailCountOverMax");}};var u=function(){if(!w){x++;if(x>3){g++;c();x=0;}}};var j=function(){d=0;x=0;};var o=false;var t=[];var m=function(B,D){if(p){a(B,D);}else{t.push({url:B,option:D});if(o){return;}o=true;var A=document.body,E=s.node("div");var C='<iframe id="EQQ_ProxySendIframe" class="hiddenIframe" name="EQQ_ProxySendIframe" width="1" height="1" src="about:blank"></iframe>';E.innerHTML=C;A.appendChild(E);var z=s.id("EQQ_ProxySendIframe");var y=function(){var J=window.frames.EQQ_ProxySendIframe;p=J.ajax;w=false;for(var H=0;H<t.length;++H){var M=g%EQQ.CONST.CONN_PROXY_URLS.length;var G=t[H].url;if(G.indexOf(EQQ.CONST.CONN_SERVER_DOMAINS[M])==-1){G=G.replace(/http:\/\/.*.com\//,"");t[H].url=EQQ.CONST.CONN_SERVER_DOMAINS[M]+G;}var F=t[H].url;var I=t[H].option;try{a(F,I);}catch(L){k.out("eqq ajax代理出错："+F+" "+EQQ.CONST.CONN_PROXY_URL);if(!I.onError){return;}var K={};K.arguments=I.arguments||{};I.onError.call(I.context,K);}}};q.on(z,"load",y);z.setAttribute("src",EQQ.CONST.CONN_PROXY_URLS[0]);}};var c=function(){var y=s.id("EQQ_ProxySendIframe");var z=g%EQQ.CONST.CONN_PROXY_URLS.length;w=true;y.setAttribute("src",EQQ.CONST.CONN_PROXY_URLS[z]);i=EQQ.CONST.CONN_SERVER_DOMAINS[z];};var a=function(y,A){A=A||{};A.cacheTime=A.cacheTime||0;A.onSuccess=A.onSuccess||function(){};A.onError=A.onError||function(){};A.onTimeout=A.onTimeout||function(){};A.onComplete=A.onComplete||function(){};var z={method:A.method||"GET",enctype:A.enctype||"",data:A.data||{},arguments:A.arguments||{},context:A.context||null,timeout:A.timeout,onSuccess:function(F){var D={};var C=false;F.responseText=F.responseText||"-";try{D=k.json.parse(F.responseText);}catch(E){F.responseText=F.responseText+":bad-JSON-format:";C=true;}finally{D.arguments=A.arguments||{};D.o=F;A.onSuccess.call(A.context,D,C);}},onError:function(C){A.onError.call(A.context,C);},onTimeout:function(D){var C={};C.arguments=A.arguments||{};A.onTimeout.call(A.context,C);},onComplete:function(D){var C={};C.arguments=A.arguments||{};A.onComplete.call(A.context,C);}};z.data.clientid=r;z.data.psessionid=EQQ.getPsessionid();if(w){z.onError();return;}qqweb.portal.recoverCookie();if(z.method=="GET"){var B=k.string.toQueryString(z.data);if(A.cacheTime===0){if(B){B+="&t="+(new Date()).getTime();}else{B+="t="+(new Date()).getTime();}}if(B){y=y+"?"+B;}z.data=null;p(y,z);}else{z.contentType="application/x-www-form-urlencoded";if(y.indexOf("?")===-1){p(y,z);}else{p(y,z);}}};this._proxy=p;this.init=function(){};this.getClientId=function(){return r;};this.send=m;this.sendLogin=function(z){z.clientid=r;z.psessionid=EQQ.getPsessionid();var y=this.send(i+"channel/login",{context:this,method:"POST",data:"r="+encodeURIComponent(k.json.stringify(z)),onSuccess:this.sendLoginSuccess,onError:this.sendLoginError,onTimeout:this.sendLoginError});qqweb.portal.speedTest.sRTS(2,"start",(new Date()));};this.sendLoginSuccess=function(z,y){switch(z.retcode){case 0:f=1;q.notifyObservers(EQQ,"LoginSuccess",z.result);qqweb.portal.speedTest.sRTS(4,"start",(new Date()));qqweb.portal.speedTest.sRTS(5,"start",(new Date()));break;case 106:q.notifyObservers(EQQ,"UinNotInWhitelist",z.result);break;case 111:q.notifyObservers(EQQ,"UinInBlacklist",z.result);break;case 112:q.notifyObservers(EQQ,"Overload",z.result);break;case 100001:q.notifyObservers(EQQ,"PtwebqqFail",z.result);break;default:k.out("未知登录失败");q.notifyObservers(EQQ,"LoginFailure",z.result);k.out("[sendLogin] error: "+z.retcode);l(z,!y);break;}l(z,y);};this.sendLoginError=function(y){q.notifyObservers(EQQ,"LoginFailure",y);u();l(y);};this.sendLogout=function(z){var y=this.send(i+"channel/logout",{context:this,data:z,onSuccess:function(A){if(A.retcode===0||A.retcode===100){f=0;q.notifyObservers(this,"LogoutSuccess",A.result);k.out(":LogoutSuccess...");}else{k.out("[SendLogout] error: "+A.retcode);}}});};this.sendReLink=function(z){z.clientid=r;z.psessionid=EQQ.getPsessionid();var y=this.send(i+"channel/login",{context:this,method:"POST",data:"r="+encodeURIComponent(k.json.stringify(z)),onSuccess:this.sendReLinkSuccess,onError:this.sendReLinkError,onTimeout:this.sendReLinkError});};this.sendReLinkSuccess=function(z,y){switch(z.retcode){case 0:f=1;q.notifyObservers(EQQ,"ReLinkSuccess",z.result);break;default:k.out("未知登录失败");q.notifyObservers(EQQ,"ReLinkFailure",z.result);k.out("[sendLogin] error: "+z.retcode);l(z,!y);break;}l(z,y);};this.sendReLinkError=function(y){q.notifyObservers(EQQ,"ReLinkFailure",y);u();l(y);};this.sendGetOnlineBuddies=function(z){var y=this.send(i+"channel/get_online_buddies",{context:this,data:{},onSuccess:function(B,A){if(B.retcode===0){q.notifyObservers(this,"GetOnlineBuddiesSuccess",B.result);}else{l(B,!A);}l(B,A);},onError:function(A){l(A);}});};this.sendMsg=function(z){z.clientid=r;z.psessionid=EQQ.getPsessionid();var y=this.send(i+"channel/send_msg",{context:this,cacheTime:0,method:"POST",data:"r="+encodeURIComponent(k.json.stringify(z)),onSuccess:function(B,A){if(B.retcode===0){q.notifyObservers(this,"SendMsgSuccess",B.result);}else{k.out("[sendMsg] error: "+B.retcode+"-"+B.errmsg);q.notifyObservers(this,"SendMsgError",{uin:z.to,retcode:B.retcode,errmsg:B.errmsg});l(B,!A);}l(B,A);},onError:function(A){l(A);}});};this.sendGroupMsg=function(z){z.clientid=r;z.psessionid=EQQ.getPsessionid();var y=this.send(i+"channel/send_group_msg",{context:this,method:"POST",data:"r="+encodeURIComponent(k.json.stringify(z)),onSuccess:function(B,A){if(B.retcode===0){q.notifyObservers(this,"SendGroupMsgSuccess",B.result);}else{k.out("[sendGroupMsg] error: "+B.retcode+"-"+B.errmsg);q.notifyObservers(this,"SendMsgError",{uin:z.to,retcode:B.retcode,errmsg:B.errmsg});l(B,!A);}l(B,A);},onError:function(A){l(A);}});};this.sendPoll=function(z){z=z||{};var A=z.data||{};if(n<f){n++;var y=this.send(i+"channel/poll",{context:this,cacheTime:0,data:A,timeout:90000,onSuccess:this.sendPollSuccess,onError:this.sendPollError,onTimeout:this.sendPollTimeout});}};this.sendPollSuccess=function(A,y){var z=(new Date()).getTime();var C=z-h;h=z;n--;if(A.retcode===0||A.retcode===102){j();try{q.notifyObservers(this,"PollSuccess",A.result);}catch(B){k.out("PollSuccess, and js error!!!!!!!!!!!!!!!!!!!!!!!!");}q.notifyObservers(this,"PollComplete");}else{if(A.retcode===100){q.notifyObservers(this,"NotLogin");}else{q.notifyObservers(e,"PollComplete");b();}}l(A,y);};this.sendPollTimeout=function(z){var y=this;n--;q.notifyObservers(y,"PollComplete");b();};this.sendPollError=function(y){this.sendPollTimeout(y);l(y);};this.sendChangeStatus=function(A,y){A=A||{newstatus:"hidden"};var z=this.send(i+"channel/change_status",{context:this,data:A,onSuccess:function(C,B){if(C.retcode===0){q.notifyObservers(this,"ChangeStatusSuccess",C.result);}else{l(C,!B);}l(C,B);},onError:function(B){l(B);}});};this.sendGetSessionSignature=function(z){var y=this.send(i+"channel/get_session_sig",{context:this,data:{group_uin:z.group_uin,to_uin:z.to_uin},arguments:{group_uin:z.group_uin,to_uin:z.to_uin},onSuccess:function(B,A){if(B.retcode===0){q.notifyObservers(this,"GetSessionSignatureSuccess",B);}else{l(B,!A);}l(B,A);},onError:function(A){l(A);}});};this.sendGroupBuddyMsg=function(z){var y=this.send(i+"channel/send_session_msg",{context:this,data:z,onSuccess:function(B,A){if(B.retcode===0){q.notifyObservers(this,"SendMsgSuccess",B.result);}else{q.notifyObservers(this,"SendMsgError",{uin:z.to,retcode:B.retcode,errmsg:B.errmsg});l(B,!A);}l(B,A);},onError:function(A){l(A);}});};this.sendGetCustomFaceList=function(){qqweb.portal.recoverCookie();var y=k.http.loadScript(EQQ.CONST.CONN_SERVER_DOMAIN2+"cgi-bin/webqq_app/",{query:"cmd=1?t="+((new Date()).getTime()),onSuccess:function(z){if(typeof(custom_face)!=="undefined"){q.notifyObservers(v,"SendGetCustomFaceListSuccess",custom_face);}else{v.sendGetCustomFaceList();}}});};this.sendDeleteCustomFace=function(z){qqweb.portal.recoverCookie();var y=k.http.loadScript(EQQ.CONST.CONN_SERVER_DOMAIN2+"cgi-bin/webqq_app/",{query:"cmd=12&bd="+z.img,onSuccess:function(A){if(typeof(cface_delete_result)!=="undefined"){q.notifyObservers(v,"SendDeleteCustomFaceSuccess",z.callback||function(){});}else{}}});};this.sendGetGroupCustomFaceKey=function(z){var y=this.send(i+"channel/get_gface_sig",{context:this,arguments:z.arguments,onSuccess:function(B,A){if(B.retcode===0){q.notifyObservers(this,"SendGetGroupCustomFaceKeySuccess",B);}else{q.notifyObservers(this,"SendGetGroupCustomFaceKeyError",{uin:z.to,retcode:B.retcode,errmsg:B.errmsg});l(B,!A);}l(B,A);},onError:function(A){l(A);}});};this.sendGetGroupCustomFaceInfo=function(z){z.clientid=r;z.psessionid=EQQ.getPsessionid();var y=this.send(i+"channel/send_group_msg",{context:this,method:"POST",data:"r="+encodeURIComponent(k.json.stringify(z)),onSuccess:function(B,A){if(B.retcode===0){q.notifyObservers(this,"SendGetGroupCustomFaceInfoSuccess",B);}else{q.notifyObservers(this,"SendMsgError",{uin:z.to,retcode:B.retcode,errmsg:B.errmsg});l(B,!A);}l(B,A);},onError:function(A){l(A);}});};this.sendGetOfflinePicUrl=function(z){var y=this.send(i+"channel/apply_offline_pic_dl",{context:this,data:z,onSuccess:function(B,A){if(B.retcode===0){q.notifyObservers(this,"sendGetOfflinePicUrlSuccess",B);}else{q.notifyObservers(this,"getSendPicUrlError",B);k.out("[sendGetOfflinePicUrlError] error: ");l(B,!A);}l(B,A);},onError:function(A){l(A);}});};this.getClientid=function(){return r;};this.sendRefuseFile=function(z){var y=this.send(i+"channel/refuse_file",{context:this,data:z,onSuccess:function(A){}});};});Jet().$package("EQQ.Model.BuddyList",function(i){var t=this,s=i.event,p,w,u,f,j,l,o,c,v,k,n,g,h,r,e,a,d;var b=new i.Class({init:function(x){this.uin=x.uin;this.allow=x.allow;this.face=x.face;this.age=x.age;this.gender=x.gender;this.vip=x.vip||false;this.clientType=x.clientType||"10000";this.setAvatar(EQQ.getUserAvatar(this.uin));this.setNick(x.nick||x.uin);this.setState(x.state||EQQ.hash.onlineStatus.offline);this.setClassId(x.classId||0);},setAvatar:function(x){this.avatarUrl=x;s.notifyObservers(EQQ.Model.BuddyList,"AvatarChange",this);},getAvatar:function(){return EQQ.getUserAvatar(this.uin);},setNick:function(x){this.nick=i.string.toSingleLine(x);this.htmlNick=i.string.encodeHtmlSimple(this.nick);this.titleNick=(this.nick);this.updateNames();},setMarkName:function(x){this.markName=i.string.toSingleLine(x.toString());this.htmlMarkName=i.string.encodeHtmlSimple(this.markName.toString());this.titleMarkName=i.string.encodeHtmlAttributeSimple(this.markName.toString());this.updateNames();},updateNames:function(){this.updateShowName();this.updateAllName();s.notifyObservers(EQQ.Model.BuddyList,"UserNameChange",this);},updateShowName:function(){this.showName=this.markName||this.nick||this.uin.toString();this.htmlShowName=i.string.encodeHtmlSimple(this.showName.toString());this.titleShowName=i.string.encodeHtmlAttributeSimple(this.showName.toString());},updateAllName:function(){this.allName="";var x="";if(this.markName){x=this.markName+"("+this.nick+")";this.allName=this.markName+"("+this.nick+")<"+this.uin+">";}else{x=this.nick;this.allName=this.nick+"<"+this.uin+">";}this.htmlAllName=i.string.encodeHtmlSimple(this.allName);this.titleAllName=i.string.encodeHtmlAttributeSimple(x)+"<"+this.uin+">";},setClassId:function(x){this.classId=x;},setSignature:function(x){if(x!=undefined){this.signature=x;this.htmlSignature=i.string.encodeHtmlSimple(x);this.titleSignature=i.string.encodeHtmlAttributeSimple(x);}s.notifyObservers(EQQ.Model.BuddyList,"UserSignatureChange",this);},getSignature:function(){if(this.signature!=undefined){this.setSignature();}else{qqweb.rpcService.sendGetSignature(this.uin);}},setQQLevel:function(x){if(x!=undefined){this.level=x;}s.notifyObservers(EQQ.Model.BuddyList,"UserQQLevelChange",this);},getQQLevel:function(){if(this.level!=undefined){this.setQQLevel();}else{qqweb.rpcService.sendGetQQLevel(this.uin);}},setState:function(x){this.state=x;},getState:function(){return this.state;},setFace:function(x){this.face=x;},setGender:function(x){this.gender=x;},setAllow:function(x){this.allow=x;},setUsercard:function(x,y){this.usercard=this.usercard||{};this.usercard[x]={title:y,htmlAttribute:i.string.encodeHtmlAttributeSimple(y),html:i.string.encodeHtmlSimple(y)};s.notifyObservers(EQQ.Model.BuddyList,"UserCardChange",this.usercard);},getUsercard:function(x){this.usercard=this.usercard||{};return this.usercard[x];}});var m=new i.Class({init:function(x){this.gid=x.gid;this.code=x.code;this.mask=x.mask;this.preMask=this.mask;this.setName(x.name);this.setType(x.type);this.isLoadInfo=false;this.hasManageAuthority=false;this.uin2members={};this.level=0;},setMask:function(x){this.preMask=this.mask;this.mask=x;s.notifyObservers(EQQ.Model.BuddyList,"SingleGroupMaskChange",this);},setName:function(x){this.name=i.string.toSingleLine(x);this.htmlName=i.string.encodeHtmlSimple(x);this.titleName=i.string.encodeHtmlAttributeSimple(x);this.updateNames();},setMarkName:function(x){this.markName=i.string.toSingleLine(x);this.htmlMarkName=i.string.encodeHtmlSimple(x);this.titleMarkName=i.string.encodeHtmlAttributeSimple(x);this.updateNames();},updateNames:function(){this.updateShowName();this.updateAllName();s.notifyObservers(EQQ.Model.BuddyList,"GroupNameChange",this);},updateShowName:function(){this.showName=this.markName||this.name||String(this.code);this.htmlShowName=i.string.encodeHtmlSimple(this.showName);this.titleShowName=i.string.encodeHtmlAttributeSimple(this.showName);},updateAllName:function(){var x="";this.allName="";if(this.markName){x=this.markName+"("+this.name+")";this.allName=this.markName+"("+this.name+")<"+this.code+">";}else{x=this.name;this.allName=this.name+"<"+this.code+">";}this.htmlAllName=i.string.encodeHtmlSimple(this.allName);this.titleAllName=i.string.encodeHtmlAttributeSimple(x)+"<"+this.code+">";},type2text:{commonGroup:"普通群",seniorGroup:"高级群",superGroup:"超级群",expireSuperGroup:"过期的超级群",enterpriseGroup:"企业群",forbiddenGroup:"禁用"},setType:function(x){this.type=x;this.typeText=this.type2text[x]||"其他类型群";this.htmlTypeText=i.string.encodeHtmlSimple(this.typeText);this.titleTypeText=i.string.encodeHtmlAttributeSimple(this.typeText);},setLevel:function(x){this.level=x||0;},setAnnouncement:function(x){if(x){if(this.announcement&&this.htmlAnnouncement&&this.titleAnnouncement){}else{this.announcement=x;this.htmlAnnouncement=i.string.encodeHtmlSimple(x);this.titleAnnouncement=i.string.encodeHtmlAttributeSimple(x);}}s.notifyObservers(t,"GroupAnnouncementChange",this);},updateMembers:function(x,y){if(x){this.members=x;this.onlineMemberCount=y;this.uin2members[x.uin]=x;}s.notifyObservers(t,"GroupMembersChange",this);},updateMemberState:function(F){var C=F.stats;var z=this.members;var B=0;var E={};var D=[];for(B=0;B<C.length;B++){E[C[B].uin]=C[B].stat;}var y=z.length;for(B=0;B<y;B++){var A=z[B].info;var x=A.uin;E[x]=E[x]||20;if(A.gstate!=E[x]){if(x!=p){D.push({uin:x,stat:E[x],oldStat:A.gstate});A.gstate=E[x];}}}s.notifyObservers(t,"GroupMemberStateChange",{t:this,arg:D});}});var q={onGetUserInfoSuccess:function(B){var x=B.result;if(x){var A=B.arguments.uin;var y=t.getUserByUin(A);if(y){y.setNick(x.nick);y.setFace(x.face);y.setGender(x.gender);y.setAllow(x.allow);}else{var z={uin:B.arguments.uin,allow:x.allow,nick:x.nick,face:x.face,gender:x.gender};y=t.createUser(z);t.addStranger(y);}s.notifyObservers(t,"GetUserInfoSuccess",y);}},onGetUserInfoError:function(x){},onGetBuddySignatureSuccess:function(A){var x=A.result;var y;if(x.length==0){y="";}else{y=x[0].lnick;}var z=t.getUserByUin(A.arguments.uin);if(z){z.setSignature(y);}s.notifyObservers(t,"GetBuddySignatureSuccess",z);},onChangeGroupMaskSuccess:function(x){if(x.uin==t.getSelfUin()){d=x.mask;s.notifyObservers(t,"GroupMaskChange",d);}else{var y=t.getGroupByGid(x.uin);y.setMask(x.mask);}},onGetQQLevelSuccess:function(y){var z=y.result.level;var x=t.getUserByUin(y.arguments.uin);if(x){x.setQQLevel(z);}},onGetGroupMaskConfigSuccess:function(y){for(var x in y){var z=parseInt(y[x]);if(x==="global"){d=z;s.notifyObservers(t,"GroupMaskChange",d);}else{}}},onGetOnlineBuddiesSuccess:function(x){t.setAllBuddyState(x);},onGetSessionSignatureSuccess:function(x){t.setGroupBuddySessionSignature(x);},onBuddyStatusChange:function(x){t.setState(x.uin,x.status,x.client_type);},onGetSelfSignatureSuccess:function(x){t.setSelfSignature(x);},onGetBuddyListSuccess:function(x){var z=x.categories||[];var y=false;for(var A=0;A<z.length;A++){if(z[A].index==0){y=true;}}if(!y){z.unshift({index:0,name:"我的好友"});}t.isBuddyList=true;t.setBuddyClass(x);t.setBuddyList(x);EQQ.RPCService.sendGetOnlineBuddies();},GetBuddyListError:function(x){s.notifyObservers(EQQ,"LoginFailure",x);},onGetGroupListSuccess:function(x){t.isGroupList=true;var D=x.gmasklist||[];var z=0;for(var A=0;A<D.length;A++){var B=D[A];if(B.gid===1000){z=B.mask;}else{for(var y=0;y<x.gnamelist.length;y++){var C=x.gnamelist[y];if(C.gid===B.gid){x.gnamelist[y].mask=B.mask;break;}}}}t.setGroupList(x.gnamelist||x);t.setGroupMask(z);},GetGroupListError:function(x){s.notifyObservers(EQQ,"LoginFailure",x);},onGetGroupInfoSuccess:function(x){t.setGroupInfo(x);},onGetRecentListSuccess:function(x){t.setRecentList(x);},onPollSuccess:function(x){if(x){for(var y=0;y<x.length;y++){var z=x[y];switch(z.poll_type){case"buddies_status_change":q.onBuddyStatusChange(z.value);break;}}}},onLoginSuccess:function(x){var y=t.getSelfUin();t.setState(y,x.status,"QQWeb");EQQ.index=x.index;EQQ.port=x.port;},onAddANewBuddy:function(z){var B=z.tuin;var y=z.gid;var x=z.newstate;var A=z.markname;qqweb.rpcService.sendGetUserInfo(B,function(H){if(H.retcode===0){var C=H.result;var G=H.arguments.uin;var D=t.getUserByUin(G);if(D){D.setNick(C.nick);D.setFace(C.face);D.setGender(C.gender);D.setClassId(y);t.addBuddy(D);}else{var F={uin:G,allow:C.allow,nick:C.nick,face:C.face,gender:C.gender,classId:y};D=t.createUser(F);t.addBuddy(D);}var E=EQQ.Model.BuddyList.getClassById(y);E.count=E.count+1;s.notifyObservers(EQQ.Model.BuddyList,"AddBuddy",{user:D,newstate:x,markname:A});}else{}});}};this.init=function(){w=[];u={};f=[];j={};l=[];o={};c=[];v={};k=[];n={};o={};g=[];h=[];e={},a={};s.addObserver(qqweb.rpcService,"GetUserInfoSuccess",q.onGetUserInfoSuccess);s.addObserver(qqweb.rpcService,"GetUserInfoError",q.onGetUserInfoError);s.addObserver(qqweb.rpcService,"GetGroupInfoSuccess",q.onGetGroupInfoSuccess);s.addObserver(qqweb.rpcService,"GetQQLevelSuccess",q.onGetQQLevelSuccess);s.addObserver(qqweb.rpcService,"GetBuddySignatureSuccess",q.onGetBuddySignatureSuccess);s.addObserver(EQQ,"LoginSuccess",q.onLoginSuccess);s.addObserver(EQQ.RPCService,"GetOnlineBuddiesSuccess",q.onGetOnlineBuddiesSuccess);s.addObserver(EQQ.RPCService,"GetSelfSignatureSuccess",q.onGetSelfSignatureSuccess);s.addObserver(EQQ.RPCService,"GetSessionSignatureSuccess",q.onGetSessionSignatureSuccess);s.addObserver(EQQ.RPCService,"PollSuccess",q.onPollSuccess);s.addObserver(t,"AddANewBuddy",q.onAddANewBuddy);s.addObserver(t,"BuddyStatusChange",q.onBuddyStatusChange);};this.reset=function(){p=0;w=[];u={};f=[];j={};l=[];o={};c=[];v={};k=[];n={};o={};g=[];h=[];e={},a={};this.setSelf(qqweb.portal.self);};this.sendGetBuddyList=function(x){x=x||{};x.vfwebqq=EQQ.vfwebqq;return EQQ.Extend.cgi_module(EQQ.BASE_CONST.API_SERVER_URL+"get_user_friends",{context:this,method:"POST",param:x,callback:function(y){if(y.retcode===0){q.onGetBuddyListSuccess(y.result);}else{q.GetBuddyListError(y);}},errback:function(y){q.GetBuddyListError(y);}});};this.sendGetGroupList=function(x){x=x||{};x.vfwebqq=EQQ.vfwebqq;return EQQ.Extend.cgi_module(EQQ.BASE_CONST.API_SERVER_URL+"get_group_name_list_mask",{context:this,method:"POST",param:x,callback:function(y){if(y.retcode===0){q.onGetGroupListSuccess(y.result);}else{q.GetGroupListError(y);}},errback:function(y){q.GetGroupListError(y);}});};this.sendGetRecentList=function(x){x=x||{};x.vfwebqq=EQQ.vfwebqq;return EQQ.Extend.cgi_module(EQQ.BASE_CONST.API_SERVER_URL+"get_recent_contact",{context:this,method:"POST",param:x,callback:function(y){if(y.retcode===0){q.onGetRecentListSuccess(y.result);}else{}},errback:function(y){}});};this.getUserSignature=function(y){var x=this.getUserByUin(y);if(x){x.getSignature();}};this.sendGetQQLevel=function(y){var x=this.getUserByUin(y);if(x){x.getQQLevel();}};this.setSelf=function(x){var z={uin:x.uin,allow:x.allow,nick:x.nick,face:x.face,age:x.age,gender:x.gender,vip:x.vip};var y=this.createUser(z);this.setSelfUin(x.uin);var A=EQQ.getDefaultState();this.setState(x.uin,A,"QQWeb");s.notifyObservers(this,"SelfInfoChange",this.getSelf());};this.getSelf=function(){return this.getUserByUin(this.getSelfUin());};this.getSelfState=function(){var x=this.getSelf();if(x){return x.state;}};this.setSelfUin=function(x){p=x||0;};this.getSelfUin=function(){return p;};this.setSelfSignature=function(x){this.getUserByUin(this.getSelfUin()).setSignature(x);s.notifyObservers(this,"SelfSignatureChange",this.getSelf());};this.sendChangeStatus=function(x){EQQ.RPCService.sendChangeStatus({newstatus:x});};this.sendChangeGroupMask=function(A){var z=A.type==="global"?A.mask:d;var B={cAll:z,idx:EQQ.index,port:EQQ.port};for(var x=0;x<h.length;x++){var y=h[x];if(A.type==="single"&&A.uin===y.gid){B[y.gid]=A.mask;}else{B[y.gid]=y.mask;}}qqweb.rpcService.sendSetConfig({onSuccess:function(){q.onChangeGroupMaskSuccess({uin:A.uin,mask:A.mask});},context:this,data:{retype:1,app:"EQQ",itemlist:'{"groupmask":'+i.json.stringify(B)+"}"}});};this.setBuddyClass=function(x){w=x.categories;for(var y=0;y<w.length;y++){var z=w[y];z.caculateName=z.name;z.htmlName=i.string.encodeHtmlSimple(z.name);z.titleName=i.string.encodeHtmlAttributeSimple(z.name);z.count=0;z.onlineCount=0;z.list={callme:[],online:[],away:[],busy:[],silent:[],offline:[]};u[z.index]=z;}s.notifyObservers(this,"BuddyClassChange",this.getClassList());};this.getClassList=function(){return w;};this.setAllBuddyState=function(x){g=[];for(var z=0;z<x.length;z++){var y=x[z];this.setState(y.uin,y.status,y.client_type);}s.notifyObservers(this,"AllOnlineBuddyReady",this.getOnlineBuddy());s.notifyObservers(this,"AllClassOnlineBuddyReady",this.getClassList());};this.setState=function(A,y,x){var E=this.getUserByUin(A);if(E){var B=E.state;E.setState(y);E.clientType=x;if(A==this.getSelfUin()){s.notifyObservers(this,"SelfStateChange",this.getSelfState());}else{if(E.classId===EQQ.hash.userClassType.stranger){}else{if(E.classId===EQQ.hash.userClassType.balck){}else{var C=this.getClassByUin(E.uin);C.list[E.state].unshift(E);var G=C.list[B];for(var D=0;D<G.length;D++){if(G[D].uin==A){G.splice(D,1);}}var z=EQQ.hash.onlineStatus.offline;if(B==z||y==z){C.onlineCount=C.count-C.list[z].length;if(y==z){for(var F=0;F<g.length;F++){if(g[F].uin==A){g.splice(F,1);}}}else{g.push({uin:A,state:y,clientType:x});}s.notifyObservers(this,"OnlineBuddyChange",A);}s.notifyObservers(this,"BuddyStateChange",A);}}}}};this.getState=function(y){var x=this.getUserByUin(y);if(x){return x.getState();}else{return null;}};this.getOnlineBuddy=function(){return g;};this.addUser=function(x){if(j[x.uin]){}else{j[x.uin]=x;f.push(x);}return x;};this.addBuddy=function(x){if(o[x.uin]){}else{x.type="buddy";o[x.uin]=x;l.push(x);}return x;};this.createUser=function(y){var x=new b(y);this.addUser(x);return x;};this.addStranger=function(x){if(v[x.uin]){}else{x.type="stranger";v[x.uin]=x;c.push(x);}return x;};this.addBlack=function(x){if(n[x.uin]){}else{x.type="black";n[x.uin]=x;k.push(x);}return x;};this.getStrangerList=function(){return c;};this.setBuddyList=function(F){l=[];var E=F.friends;var B=this.getSelfUin();for(var C=0;C<E.length;C++){if(E[C].uin!=B){var y=F.info[C];var D={uin:y.uin,allow:y.allow,nick:y.nick,face:y.face,age:y.age,gender:y.gender,vip:y.vip,classId:(this.getClassById(E[C].categories))?E[C].categories:0};var A=this.createUser(D);this.addBuddy(A);}}var x=F.marknames;if(x){for(var C=0;C<x.length;C++){var A=this.getUserByUin(x[C].uin);if(A){A.setMarkName(x[C].markname);}}}for(var C=0;C<l.length;C++){if(l[C].uin!=this.getSelfUin()){var z=this.getClassById(l[C].classId);if(!z.list[l[C].state]){z.list[l[C].state]=[];}z.list[l[C].state].push(l[C]);z.count++;}}s.notifyObservers(this,"BuddyListChange",this.getBuddyList());};this.getBuddyList=function(){return l;};this.addNewBuddy=function(){};this.searchBuddy=function(z,B){z=String(z).toLowerCase();var x=[];var y=[];if(z.length>0){for(var C=0;C<l.length;C++){var A=l[C];if(String(A.uin).indexOf(z)>-1||(String(A.nick).toLowerCase().indexOf(z)>-1&&String(A.nick)!="undefined")||(String(A.markName).toLowerCase().indexOf(z)>-1&&String(A.markName)!="undefined")){if(String(A.uin)==z||String(A.nick).toLowerCase()==z||String(A.markName).toLowerCase()==z){y.push(A);}else{x.push(A);}}if(x.length+y.length>=B){break;}}}Array.prototype.push.apply(y,x);return y;};this.isUser=function(x){return(i.array.indexOf(f,x)!==-1);};this.isBuddy=function(x){return o[x];};this.getBuddyByUin=function(x){return o[x];};this.isStranger=function(x){return v[x];};this.isBlack=function(x){return n[x];};this.getUserByUin=function(x){if(j){return j[x];}else{}};this.getClassIdByUin=function(x){return j[x].classId;};this.getClassByUin=function(x){var y=this.getClassIdByUin(x);return this.getClassById(y);};this.getClassById=function(x){return u[x];};this.addGroup=function(x){if(a[x.code]){}else{a[x.code]=e[x.gid]=x;h.push(x);}return x;};this.setGroupList=function(x){h=[];for(var z=0;z<x.length;z++){var y=x[z];var B="commonGroup";if(y.flag&16){B="seniorGroup";}else{if(y.flag&33554432){B="superGroup";}else{if(y.flag&2){B="forbiddenGroup";}else{if(y.flag&256){B="enterpriseGroup";}else{if(y.flag&67108864){B="expireSuperGroup";}}}}}var A={gid:y.gid,code:y.code,type:B,name:y.name,mask:y.mask||"0"};var C=new m(A);this.addGroup(C);}s.notifyObservers(this,"GroupListChange",this.getGroupList());};this.setGroupMask=function(x){d=x;s.notifyObservers(this,"GroupMaskChange",d);};this.getGroupMask=function(){return d;};this.getGroupList=function(){return h;};this.setRecentList=function(x){r=x.contents;s.notifyObservers(this,"RecentListChange",this.getRecentList());};this.getRecentList=function(){return r;};this.setGroupInfo=function(G){var F=G.ginfo;var x=G.minfo;var S=G.stats;var A=G.cards||[];var E=this.getGroupByCode(F.code);E.setLevel(F.level);var J=this.getSelfUin();E.setAnnouncement(F.memo||" ");var N=F.members;var Q=[];var C=false;var P=0;for(var M=0;M<N.length;M++){var L="common";if(N[M].mflag&1){L="manager";if(N[M].muin===J){C=true;}}else{if(N[M].mflag&2){L="manager2";if(N[M].muin===J){C=true;}}}if(N[M].muin==F.owner){L="master";if(N[M].muin===J){C=true;}}var y=N[M].muin;var R=x[M].nick;var D=x[M].nick;if(D==""){D=String(y);}var B=S[M].stat;if(B!=20){P++;}var H=R+"<"+y+">";var O=R+"<"+y+">";for(var K=0;K<A.length;K++){if(A[K].muin==y){D=A[K].card;break;}}var U=this.getUserByUin(N[M].muin);if(U){var z=qqweb.util.code2state(B);if(U.uin!=J){U.setState(z);U.gstate=B;}if(U.type==="groupBuddy"||U.uin===J){var T=(D?D:U.showName);U.setUsercard(F.code,T);}else{D=D===R?U.showName:D;}}else{var I={uin:y,nick:R,state:qqweb.util.code2state(B)};U=this.createUser(I);U.type="groupBuddy";U.group=E;U.gstate=B;}var T=(D?D:U.showName);U.setUsercard(F.code,T);Q[M]={uin:y,flag:L,gcode:F.code,nick:R,htmlNick:i.string.encodeHtmlSimple(R),titleNick:(R),showName:H,htmlShowName:i.string.encodeHtmlSimple(H),titleShowName:i.string.encodeHtmlAttributeSimple(H),allName:O,htmlAllName:i.string.encodeHtmlSimple(O),titleAllName:O,usercard:i.string.encodeHtmlSimple(D)};Q[M].info=U;E.uin2members[y]=Q[M];}E.isLoadInfo=true;E.hasManageAuthority=C;E.updateMembers(Q,P);s.notifyObservers(this,"GroupInfoChange",E);};this.setMemberState=function(x){var y=this.getGroupByCode(x.gcode);y.updateMemberState(x);};this.sendGetGroupInfo=function(y){var x=qqweb.rpcService.send(qqweb.CONST.API_SERVER_URL+"get_group_info_ext",{context:t,data:y,arguments:y,onSuccess:function(z){if(z.retcode===0){t.setGroupInfo(z.result);}else{i.out("获取群最新信息失败");}},onError:function(z){i.out("获取群最新信息失败");}});};this.sendGetGroupNewestState=function(y){var x=qqweb.rpcService.send(qqweb.CONST.API_SERVER_URL+"get_group_member_stat",{context:t,data:y,arguments:y,onSuccess:function(z){if(z.retcode===0){t.onGetGroupNewestStateSuc(z.result);}else{i.out("获取群最新信息失败");}},onError:function(z){i.out("获取群最新信息失败");}});};this.onGetGroupNewestStateSuc=function(x){this.setMemberState(x);};this.getGroupByCode=function(x){return a[x];};this.getGroupByGid=function(x){return e[x];};this.getGroupInfo=function(x){var y=this.getGroupByCode(x);if(y.isLoadInfo){y.updateMembers();y.setAnnouncement();s.notifyObservers(this,"GroupInfoChange",y);return y;}else{this.sendGetGroupInfo({gcode:x});}};this.sendGetSessionSignature=function(z){var x=this.getUserByUin(z);var y=x.group.gid;EQQ.RPCService.sendGetSessionSignature({group_uin:y,to_uin:z});};this.setGroupBuddySessionSignature=function(z){var y=z.arguments.to_uin;var x=this.getUserByUin(y);if(z.result.verify_sig.type===0&&z.result.group_sig.type===0){x.chatSession=z.result;s.notifyObservers(this,"GroupBuddySessionSignatureChange",x.uin);}};this.sendGetUserInfo=function(x){qqweb.rpcService.sendGetUserInfo(x);};this.isGroupPrompt=function(x){var y=this.getGroupByGid(x);d=parseInt(d);switch(d){case 0:switch(parseInt(y.mask)){case 0:return true;break;case 1:return false;break;case 2:return false;break;}break;case 1:return true;break;case 2:return false;break;case 3:return false;break;}};});Jet().$package("EQQ.Model.ChatMsg",function(j){var r=this,q=j.event,f={},s=[],d={},c=[],l={},u=null,p={},i={},g=[],b={},k=0,o,a=0,h;o=(new Date()).getTime();o=(o-o%1000)/1000;o=o%10000*10000;var n=function(){k++;return o+k;};var m=function(v){if(j.isNumber(v)){v=v*1000;}var t=new Date(v);return j.date.format(t,"YYYY-MM-DD hh:mm:ss");};this.init=function(){f={},s=[],d={},c=[],l={},u=null,p={},i={},g=[],b={},k=0,a=0,h=null;q.addObserver(EQQ.RPCService,"SendMsg",j.bind(this.onSendMsgSuccess,this));q.addObserver(EQQ.RPCService,"PollSuccess",j.bind(this.onPollSuccess,this));q.addObserver(EQQ.RPCService,"SendMsgError",j.bind(this.onSendMsgError,this));q.addObserver(EQQ.RPCService,"SendGetGroupCustomFaceKeySuccess",j.bind(this.onSendGetGroupCustomFaceKeySuccess,this));q.addObserver(EQQ.RPCService,"sendGetOfflinePicUrlSuccess",j.bind(this.onGetOfflinePicUrlSuccess,this));q.addObserver(EQQ.RPCService,"getSendPicUrlError",j.bind(this.onSetSendPicUrlError,this));};this.setGroupCustomFaceKey=function(t){a=j.now();h={key:t.gface_key,signature:t.gface_sig};};this.getGroupCustomFaceKey=function(){return h;};this.isGroupCustomFaceKeyTimeout=function(){return(j.now()-a)>1000*60*60*60*2;};this.sendGetGroupCustomFaceKey=function(t){EQQ.RPCService.sendGetGroupCustomFaceKey({arguments:{msg:t}});};this.onSendGetGroupCustomFaceKeySuccess=function(t){var v=t.arguments.msg;this.setGroupCustomFaceKey(t.result);this.sendGetGroupCustomFaceInfo(v);};this.sendGetGroupCustomFaceInfo=function(A){var x=this.getGroupCustomFaceKey();for(var w=0;w<A.content.length;w++){var z=A.content[w];if(z[0]==="face"){z[1]=EQQ.CONST.TRANSFER_TABLE[z[1]];}}EQQ.RPCService.sendGetGroupCustomFaceInfo({group_uin:A.to,group_code:EQQ.Model.BuddyList.getGroupByGid(A.to).code,key:x.key,sig:x.signature,content:j.json.stringify(A.content)});var y=n();var t=EQQ.Model.BuddyList.getSelf();var v={type:A.type,from_uin:0,sender_uin:t.uin,sender:t,time:m(new Date()),content:A.content,msg_id:y,group_code:EQQ.Model.BuddyList.getGroupByGid(A.to).code};q.notifyObservers(this,"GroupMessageListChange",{gid:A.to,msgList:[v]});};this.callbackSendPic=function(v){if(v.filesize>(1*1024*1024)){v.retcode="100";v.maxFileSize="1MB";q.notifyObservers(this,"uploadSendPicError",v);}else{if(v.retcode!=0){q.notifyObservers(this,"uploadSendPicError",v);}else{p[v.filepath]=v;var t=EQQ.Model.BuddyList.getSelf();EQQ.RPCService.sendGetOfflinePicUrl({f_uin:t.uin,file_path:v.filepath,clientid:r.getClientidFromRpc()});}}};this.onGetOfflinePicUrlSuccess=function(t){p[t.result.file_path].fileurl=t.result.url;if(p[t.result.file_path]){t.fileid=p[t.result.file_path].fileid;}q.notifyObservers(this,"GetSendPicUrlSuccess",t);};this.onSetSendPicUrlError=function(t){if(p[t.result.file_path]){t.fileid=p[t.result.file_path].fileid;}q.notifyObservers(this,"getSendPicUrlError",t);};this.getSendPicUrlByFilePath=function(t){if(typeof(p[t])=="undefined"){return"";}else{return p[t].fileurl;}};this.callbackSendPicGroup=function(v){if(v.ret===0){q.notifyObservers(this,"getSendPicGroupSuccess",v.msg);}else{if(v.ret===4){var w=/[A-Fa-f0-9]{32}\.[A-Za-z]{3}/;var t=v.msg.match(w);if(!t){q.notifyObservers(this,"sendPicGroupError",v);}else{v.msg=t[0];q.notifyObservers(this,"getSendPicGroupSuccess",v.msg);}}else{q.notifyObservers(this,"sendPicGroupError",v);}}};this.sendMsg=function(C){var v=n();var y="";var E="";var w;var x={};C=C||{};C.type=C.type||"single";var D=typeof(C.attach)!="undefined"&&C.attach?C.attach:"";var F=EQQ.Model.BuddyList.getSelf();for(var B=0;B<C.content.length;B++){var A=C.content[B];if(A[0]==="face"){A[1]=EQQ.CONST.TRANSFER_TABLE[A[1]];}}E=j.json.stringify(C.content);if(C.type==="group"){x={group_uin:C.to,content:E,msg_id:v};EQQ.RPCService.sendGroupMsg(x);w={type:C.type,from_uin:0,sender_uin:F.uin,sender:F,time:m(new Date()),content:C.content,msg_id:v,group_code:EQQ.Model.BuddyList.getGroupByGid(C.to).code};q.notifyObservers(this,"GroupMessageListChange",{gid:C.to,msgList:[w]});}else{var t=C.to;var z=EQQ.Model.BuddyList.getUserByUin(t);if(z.type==="groupBuddy"){x={to:C.to,verify_sig:(z.chatSession.verify_sig.value),group_sig:(z.chatSession.group_sig.value),face:C.face,content:E,msg_id:v};EQQ.RPCService.sendGroupBuddyMsg(x);}else{x={to:C.to,face:C.face,content:E,msg_id:v};EQQ.RPCService.sendMsg(x);}w={type:C.type,from_uin:0,sender_uin:F.uin,sender:F,time:m(new Date()),content:C.content,msg_id:v,attach:D};q.notifyObservers(this,"MessageListChange",{uin:C.to,msgList:[w]});}if(f[C.to]){f[C.to].msgList.push(w);}else{f[C.to]={last:0,msgList:[w]};}};this.addMsgToList=function(v){var t=EQQ.Model.BuddyList.getSelf();var w=n();var x={type:v.type,from_uin:v.from_uin,sender_uin:t.uin,sender:t,time:m(new Date()),content:v.content,msg_id:w,attach:typeof(v.attach)!="undefined"&&v.attach?v.attach:""};q.notifyObservers(this,"MessageListChange",{uin:v.to,msgList:[x]});if(f[v.to]){f[v.to].msgList.push(x);}else{f[v.to]={last:0,msgList:[x]};}};this.onSendMsgSuccess=function(t){if(t=="ok"){}else{}};this.onSendMsgError=function(t){q.notifyObservers(this,"SendMsgError",t);};this.getMsgHistory=function(t){if(f[t]){q.notifyObservers(this,"MessageListChange",{uin:t,msgList:f[t].msgList});}};this.getGroupMsgHistory=function(t){if(f[t]){q.notifyObservers(this,"GroupMessageListChange",{gid:t,msgList:f[t].msgList});}};this.clearChatLog=function(t){if(f[t]){f[t]={last:0,msgList:[]};}};this.receiveMsg=function(D){var v=D.from_uin,C=false,A=0;var B=typeof(D.attach)!="undefined"&&D.attach?D.attach:"";var x={type:"single",from_uin:v,sender_uin:v,sender:EQQ.Model.BuddyList.getUserByUin(v),msg_id:D.msg_id,content:(D.content),time:m(D.time),attach:B};if(f[v]){var z=f[v].msgList;var w=z.length;for(var y=0;y<w;y++){if(z[y].msg_id==x.msg_id){C=true;break;}}if(!C){z.push(x);A++;}b[v]=x.msg_id;}else{f[v]={last:0,msgList:[]};f[v].msgList.push(x);A++;b[v]=x.msg_id;}var t={last:0,msgList:[]};if(A>0){for(var y=0;y<A;y++){t.msgList.push(f[v].msgList[f[v].msgList.length-(A-y)]);}}f[v].last=0;q.notifyObservers(this,"MessageListChange",{uin:v,msgList:t.msgList});q.notifyObservers(EQQ,"MessageReceive",{uin:v,msgList:t.msgList});};this.receiveSystemMsg=function(w){var v;switch(w.type){case"added_buddy_sig":case"added_buddy_nosig":v="添加您为好友";break;case"verify_pass_add":v="接受了您的请求，并添加您为好友";var t={uin:w.from_uin,status:qqweb.util.code2state(w.stat),client_type:w.client_type};q.notifyObservers(EQQ.Model.BuddyList,"AddANewBuddy",{tuin:w.from_uin,gid:w.group_id,newstate:t});break;case"verify_pass":v="接受了您的请求";var t={uin:w.from_uin,status:qqweb.util.code2state(w.stat),client_type:w.client_type};q.notifyObservers(EQQ.Model.BuddyList,"AddANewBuddy",{tuin:w.from_uin,gid:0,newstate:t});break;case"verify_required":v="请求添加您为好友，附加信息("+(w.msg||"无")+")";break;case"verify_rejected":v="拒绝了您的请求，附加信息("+(w.msg||"无")+")";break;default:v=w.type;}var x={type:"system",sender:{htmlShowName:String(w.from_uin)},from_uin:w.from_uin,content:v,msg_id:w.seq,opt:{uin:w.from_uin,nick:w.from_uin,allow:w.allow,type:w.type,msg:w.msg,gid:w.group_id}};q.notifyObservers(EQQ,"MessageReceive",{msgList:[x]});};this.receiveGroupMsg=function(D){var A=D.from_uin,C=false,B=0,x;var v={type:"group",from_uin:A,sender_uin:D.send_uin,sender:EQQ.Model.BuddyList.getUserByUin(D.send_uin),msg_id:D.msg_id,content:D.content,group_code:EQQ.Model.BuddyList.getGroupByGid(A).code,time:m(D.time)};if(f[A]){var t=f[A].msgList.length;for(var y=0;y<t;y++){var z=f[A].msgList[y];if(v.sender_uin==z.sender_uin&&z.msg_id==v.msg_id){C=true;j.out("发现重复群消息，msg_id："+y);break;}}if(!C){f[A].msgList.push(v);B++;}b[A]=v.msg_id;}else{f[A]={last:0,msgList:[]};f[A].msgList.push(v);B++;b[A]=v.msg_id;}x=f[A].msgList;var t=x.length;var w=[];if(B>0){for(var y=B;y>0;y--){w.push(x[t-y]);}}f[A].last=0;q.notifyObservers(this,"GroupMessageListChange",{gid:A,msgList:w});q.notifyObservers(EQQ,"MessageReceive",{gid:A,msgList:w});};this.addMessageBoxUserList=function(v){var t=d[v.from_uin];if(t){j.array.remove(s,t);}else{q.notifyObservers(this,"flexStartJump",v.from_uin);}d[v.from_uin]=v;s.push(v);q.notifyObservers(this,"MessageBoxUserListChange",this.getMessageBoxUserList());};this.getMessageBoxUserList=function(){return s;};this.removeMessageBoxUserList=function(v){var t=d[v];if(t){j.array.remove(s,t);}delete d[v];q.notifyObservers(this,"flexStopJump",v);q.notifyObservers(this,"MessageBoxUserListChange",this.getMessageBoxUserList());};this.addMessageBoxGroupList=function(v){var t=l[v.from_uin];if(t){j.array.remove(c,t);}l[v.from_uin]=v;c.push(v);q.notifyObservers(this,"MessageBoxGroupListChange",this.getMessageBoxGroupList());};this.getMessageBoxGroupList=function(){return c;};this.removeMessageBoxGroupList=function(v){var t=l[v];if(t){j.array.remove(c,t);}delete l[v];q.notifyObservers(this,"MessageBoxGroupListChange",this.getMessageBoxGroupList());};this.onPollSuccess=function(t){if(t){for(var w=t.length-1;w>=0;w--){var A=t[w];switch(A.poll_type){case"message":var z=A.value;var y=z.from_uin;var x=EQQ.Model.BuddyList.isBuddy(y);if(z.msg_type===9){if(x){this.addMessageBoxUserList(z);this.receiveMsg(z);}else{this.receiveStrangerMsg(z);}}else{if(z.msg_type===10){if(x){this.receiveStrangerMsg(z);}else{}}else{if(z.msg_type===31||z.msg_type===140){this.receiveStrangerMsg(z);}}}break;case"group_message":var z=A.value;this.addMessageBoxGroupList(z);this.receiveGroupMsg(z);break;case"kick_message":j.out("踢线通知："+A.value);var z=A.value;var v="您的帐号在另一地点登录，您已被迫下线。如有疑问，请登录:safe.qq.com了解更多。";if(z.show_reason!==0){v=z.reason;}q.notifyObservers(EQQ,"SelfOffline",v);break;case"file_message":j.out("接收文件通知"+A.value);this.receiveFile(A.value);break;case"system_message":j.out("收到系统消息"+A.value);this.receiveSystemMsg(A.value);q.notifyObservers(EQQ,"SystemMessageRecive",A.value);break;case"filesrv_transfer":j.out("收到文件传输消息"+A.value);this.receiveTransferMsg(A.value);break;case"tips":j.out("收到tips消息"+A.value);this.receiveTipsMsg(A.value);break;}}}};this.receiveStrangerMsg=function(x){var w=x.from_uin;var y=EQQ.Model.BuddyList.isStranger(w);if(y){}if(EQQ.Model.BuddyList.isBuddy(w)){}else{var y=EQQ.Model.BuddyList.isStranger(w);if(y){}else{var v={uin:w};var t=EQQ.Model.BuddyList.createUser(v);EQQ.Model.BuddyList.addUser(t);EQQ.Model.BuddyList.addStranger(t);t.setClassId(EQQ.hash.userClassType.stranger);EQQ.Model.BuddyList.setState(t.uin,"online","10000");q.notifyObservers(this,"NewStranger",t);}}this.addMessageBoxUserList(x);this.receiveMsg(x);j.out("receiveStrangerMsg");};this.receiveGroupBuddyMsg=function(x){var w=x.from_uin;var y=EQQ.Model.BuddyList.isStranger(w);if(y){}else{var v={uin:w};var t=EQQ.Model.BuddyList.createUser(v);EQQ.Model.BuddyList.addUser(t);EQQ.Model.BuddyList.addStranger(t);t.type="groupBuddy";t.group=EQQ.Model.BuddyList.getGroupByGid(x.gid);t.setClassId(EQQ.hash.userClassType.stranger);EQQ.Model.BuddyList.setState(t.uin,"online","unknown");q.notifyObservers(this,"NewStranger",t);EQQ.Model.BuddyList.sendGetUserInfo(w);}this.addMessageBoxUserList(x);this.receiveMsg(x);j.out("receiveGroupBuddyMsg, finish");};this.getMessagePointer=function(t){return b[t]||0;};this.getCustomFaceList=function(){return u;};this.getSendPicList=function(){return p;};this.loadCustomFaceList=function(){q.addObserver(EQQ.RPCService,"SendGetCustomFaceListSuccess",e);EQQ.RPCService.sendGetCustomFaceList();};var e=function(t){u=j.array.bubbleSort(t.data,function(w,v){if(w&&v){return w[1]-v[1];}});q.notifyObservers(r,"GetCustomFaceListSuccess",u);q.removeObserver(EQQ.RPCService,"SendGetCustomFaceListSuccess",e);};this.deleteCustomFace=function(t){EQQ.RPCService.sendDeleteCustomFace(t);};this.getClientidFromRpc=function(){return EQQ.RPCService.getClientid();};this.sendFile=function(x){var w=[["sendfile",x.filename]];var t={type:"sendfile",name:x.filename,from_uin:x.to_uin,time:(new Date().getTime()),isread:true,session_id:x.lcid};var v=x.to_uin+"_"+x.lcid;i[v]=t;var y={type:"single",from_uin:0,to:x.to_uin,content:w,attach:t};r.addMsgToList(y);};this.receiveFile=function(y){if(y.mode==="recv"){var x=[["rfile",y.name,y.session_id]];y.content=x;y.attach={type:"rfile",name:y.name,from_uin:y.from_uin,time:y.time,isread:false,session_id:y.session_id,msg_type:y.msg_type};var v=y.from_uin+"_"+y.session_id;if(!i[v]){i[v]=y.attach;this.fileMsgToJumpUserList(y);this.receiveMsg(y);}else{i[v]=y.attach;}}else{if(y.mode==="refuse"){if(y.type===161){return;}if(y.cancel_type==2){g[y.session_id]=true;var w=parseInt(y.session_id,10).toString(2);if(w.length>=12){w=w.substr(w.length-12,12);y.session_id=parseInt(w,2).toString(10);}}var v=y.from_uin+"_"+y.session_id;var t=i[v];if(typeof(t)=="undefined"){return false;}if(t.isFinished){return false;}else{i[v].isFinished=true;}var x=[["rffile",t.name]];t.type="rffile";if(y.cancel_type==2){x=[["wrffile",t.name]];t.type="wrffile";}else{if(y.cancel_type==3){x=[["rtfile",t.name]];t.type="rtfile";}}y.content=x;y.attach=t;this.fileMsgToJumpUserList(y);this.receiveMsg(y);if(y.cancel_type!=2){q.notifyObservers(this,"fromCancenFile",v);}}else{if(y.mode==="send_ack"){var w=parseInt(y.session_id,10).toString(2);if(w.length<12){return false;}w=w.substr(w.length-12,12);y.session_id=parseInt(w,2).toString(10);var v=y.from_uin+"_"+y.session_id;var t=i[v];var x=[["wrfile",t.name,t.session_id]];y.content=x;y.attach={type:"wrfile",name:t.name,from_uin:t.from_uin,time:y.time,session_id:y.session_id};this.fileMsgToJumpUserList(y);this.receiveMsg(y);}else{if(y.type===161){var x=[["video","好友发起了视频或音频会话邀请，由于WebQQ目前暂不支持该功能，已自动拒绝好友的邀请。"]];y.content=x;y.attach={type:"video"};this.fileMsgToJumpUserList(y);this.receiveMsg(y);}else{}}}}};this.agreeReceiveFile=function(t){var v=[["agfile",t.name,t.session_id]];t.type="agfile";var w={type:"single",from_uin:0,to:t.from_uin,content:v,attach:t};r.addMsgToList(w);};this.refuseReceiveFile=function(t){var w=[["rffile",t.name,t.session_id]];t.type="rffile";var y={type:"single",from_uin:0,to:t.from_uin,content:w,attach:t};r.addMsgToList(y);var v=t.from_uin+"_"+t.session_id;i[v].isFinished=true;var x=r.getClientidFromRpc();EQQ.RPCService.sendRefuseFile({to:t.from_uin,lcid:t.session_id,clientid:x});};this.getFilesList=function(){return i;};this.fileMsgToJumpUserList=function(y){if(y.cancel_type&&y.cancel_type==2){this.addMessageBoxUserList(y);return true;}if(typeof(y.msg_type)==="undefined"&&!y.msg_type){var v=y.from_uin+"_"+y.session_id;var t=i[v];if(typeof(t.msg_type)==="undefined"&&!t.msg_type){return false;}y.msg_type=t.msg_type;}var x=y.from_uin;var w=EQQ.Model.BuddyList.isBuddy(x);if(y.msg_type===9){if(w){this.addMessageBoxUserList(y);}else{this.receiveStrangerFileMsg(y);}}else{if(y.msg_type===10){if(w){this.receiveStrangerFileMsg(y);}else{}}else{if(y.msg_type===31){this.receiveGroupBuddyFileMsg(y);}}}};this.receiveStrangerFileMsg=function(x){var w=x.from_uin;var y=EQQ.Model.BuddyList.isStranger(w);if(y){}else{var v={uin:w};var t=EQQ.Model.BuddyList.createUser(v);EQQ.Model.BuddyList.addUser(t);EQQ.Model.BuddyList.addStranger(t);t.setClassId(EQQ.hash.userClassType.stranger);EQQ.Model.BuddyList.setState(t.uin,"online","unknown");q.notifyObservers(this,"NewStranger",t);}this.addMessageBoxUserList(x);j.out("receiveStrangerFileMsg");};this.receiveGroupBuddyFileMsg=function(x){var w=x.from_uin;var y=EQQ.Model.BuddyList.isStranger(w);if(y){}else{var v={uin:w};var t=EQQ.Model.BuddyList.createUser(v);EQQ.Model.BuddyList.addUser(t);EQQ.Model.BuddyList.addStranger(t);t.type="groupBuddy";t.setClassId(EQQ.hash.userClassType.stranger);EQQ.Model.BuddyList.setState(t.uin,"online","unknown");q.notifyObservers(this,"NewStranger",t);EQQ.Model.BuddyList.sendGetUserInfo(w);}this.addMessageBoxUserList(x);j.out("receiveGroupBuddyFileMsg, finish");};this.receiveTransferMsg=function(z){var x=z.file_infos[0];if(x.file_name==""){return;}var y="";var t="";if(x.file_status==51){y=[["transtimeout",x.file_name,z.lc_id]];t={type:"transtimeout",name:x.file_name,isread:true};}else{if(x.file_status==50){y=[["transerror",x.file_name,z.lc_id]];t={type:"transerror",name:x.file_name,isread:true};}else{if(x.file_status==53){y=[["refusedbyclient",x.file_name,z.lc_id]];t={type:"refusedbyclient",name:x.file_name,isread:true};}else{if(x.file_status==0){y=[["transok",x.file_name,z.lc_id]];t={type:"transok",name:x.file_name,isread:true};}else{if(x.file_status==10){return false;}else{return false;}}}}}var v=z.from_uin+"_"+z.lc_id;var w=i[v]||{};if(w.isFinished||(typeof(g[z.session_id])!="undefined"&&g[z.session_id]===true)){return false;}else{w.isFinished=true;}var A={type:"single",from_uin:0,to:z.to_uin,content:y,attach:t};r.addMsgToList(A);};this.receiveTipsMsg=function(w){var t=w.url||"";if(t.indexOf("run=mySignature")===-1){return false;}var v=w.txt3.replace("\r\n",":");w.content=v;w.type="mysigntips";var x={type:"mysigntips",sender:{htmlShowName:String(w.from_uin)},from_uin:w.from_uin,allow:1,content:v,msg_id:w.msg_id,opt:{uin:w.from_uin,nick:w.from_uin,msg_id:w.msg_id,type:"mysigntips"}};w.aMag=x;q.notifyObservers(EQQ,"MessageReceive",{msgList:[x]});};});Jet().$package("EQQ.View.MainPanel",function(n){var L=this,G=n.dom,E=n.event,x=n.string,e=false,k=false,P=false,q=false,ad=false,g=false,ac={},aa=[],a=[],ae={},H=0,ab=38,F=40,O=13,d,b=160,w=50,z=20,K="0",p=qqweb.layout.getPanel("desktop").body,B=null,m,S,r,R,W=[],u=false;EQQ.avatarMouseoverTimer=null;var v=function(){if(B){clearTimeout(B);}L.show();};var af=function(){if(B){clearTimeout(B);}B=setTimeout(function(){L.hide();B=null;},30);};var y=function(){var J=this.getAttribute("state");L.setSelfState(J);};var am=function(){G.setStyle(this,"backgroundColor","#cbe7fc");};var t=function(){G.setStyle(this,"backgroundColor","transparent");};var ah=function(){G.removeClass(L.EQQ_MyState,"hover");};var Y=function(){G.addClass(L.EQQ_MyState,"hover");};var o=function(){};var V=function(J){L.toggleStatePanel(J);};var c=V;var A=function(ao){ao.stopPropagation();var J=G.getClientXY(L.EQQ_MyState);J[1]=J[1]+16;c(J);};var al=function(ao){var J=this.getAttribute("classIndex");L.toggleClass(J);};var D=function(){G.setStyle(this,"backgroundColor","#cbe7fc");};var M=function(){G.setStyle(this,"backgroundColor","transparent");};var Z=function(){var J=this.getAttribute("uin");if(EQQ.avatarMouseoverTimer){clearTimeout(EQQ.avatarMouseoverTimer);EQQ.avatarMouseoverTimer=null;}var ao=G.getClientXY(this);ao[0]=ao[0]-218;ao[1]=ao[1]-5;L.showMiniCardPanel(J,ao);E.notifyObservers(L,"AvatarMouseover",J);};var j=function(){EQQ.avatarMouseoverTimer=window.setTimeout(Q,500);};var Q=function(){L.hideMiniCardPanel();};var U=function(){if(EQQ.avatarMouseoverTimer){clearTimeout(EQQ.avatarMouseoverTimer);EQQ.avatarMouseoverTimer=null;}};var I=function(){EQQ.avatarMouseoverTimer=window.setTimeout(Q,500);};var s=function(){qqweb.portal.runApp("userDetails",L.miniCardPanel.uin);};var f=function(){var ao=L.miniCardPanel.uin;var ap=G.id("miniCard_buddyOption_tabBody");if(G.getStyle(ap,"display")=="none"){var J='				<div class="miniCard_buddyOption_angle">^</div>				<div class="miniCard_buddyOption_Content">				确定删除此好友？ 确定 取消				</div>			';ap.innerHTML=J;G.setStyle(ap,"display","block");}else{G.setStyle(ap,"display","none");}};var X=function(){var J=L.miniCardPanel.uin;};var h=function(){var J=L.miniCardPanel.uin;};var an=function(J){J.stopPropagation();};var ag=function(ao){ao.preventDefault();ao.stopPropagation();var J=this.getAttribute("uin");E.notifyObservers(L,"StartChat",J);};var aj=function(){var J=this.getAttribute("code");E.notifyObservers(L,"StartGroupChat",J);};this.init=function(){W=[];e=false,k=false,P=false,q=false,ad=false,g=false,ac={},aa=[],a=[],ae={},H=0,B=null,m=null,S=null,r=null,R=null,ifFlexReady=false,u=false;E.notifyObservers(L,"AddPObservers");E.addObserver(EQQ.window,"resize",n.bind(this.onEqqResize,this));E.addObserver(EQQ.window,"dragEnd",ak);E.on(window,"resize",n.bind(this.onWindowResize,this));E.addObserver(qqweb.layout,"SideBarPinUp",n.bind(this.onWindowResize,this));E.addObserver(qqweb.layout,"SideBarPinDown",n.bind(this.onWindowResize,this));this.EQQ_Container=G.id("EQQ_Container");this.EQQ_MainPanel=G.id("EQQ_MainPanel");this.EQQ_MyPanel=G.id("EQQ_MyPanel");this.EQQ_MyAvatar=G.id("EQQ_MyAvatar");this.EQQ_MyNick=G.id("EQQ_MyNick");this.EQQ_MyState=G.id("EQQ_MyState");this.EQQ_MyStateShow=G.id("EQQ_MyStateShow");this.EQQ_MyState.title="更改在线状态";E.on(this.EQQ_MyState,"click",A);this.EQQ_MySignature=G.id("EQQ_MySignature");this.EQQ_YellowTips=G.id("EQQ_YellowTips");E.on(this.EQQ_YellowTips,"click",this.onYellowTipsClick);this.EQQ_LoginSuccess=G.id("EQQ_LoginSuccess");this.EQQ_SearchBar=G.id("EQQ_SearchBar");this.EQQ_SearchBox=G.id("EQQ_SearchBox");this.EQQ_SearchButton=G.id("EQQ_SearchButton");this.EQQ_SearchResultPanel=G.id("EQQ_SearchResultPanel");E.on(this.EQQ_SearchBox,"mouseover",this.onSearchBoxMouseover);E.on(this.EQQ_SearchBox,"mouseout",this.onSearchBoxMouseout);E.on(this.EQQ_SearchBox,"focus",this.onSearchBoxFocus);E.on(this.EQQ_SearchBox,"blur",this.onSearchBoxBlur);E.on(this.EQQ_SearchBox,"keyup",this.onSearchBoxKeyup);E.on(this.EQQ_SearchBox,"keydown",this.onSearchBoxKeydown);E.on(this.EQQ_SearchBox,"click",n.bind(this.startSearch,this));E.on(this.EQQ_SearchButton,"click",n.bind(function(){if(m){L.hideSearchResult();E.notifyObservers(L,"StartChat",m.uin);}},this));this.EQQ_Logining=G.id("EQQ_Logining");this.EQQ_Logining_feedback=G.id("EQQ_Logining_feedback");this.EQQ_ReLoginPanel=G.id("EQQ_ReLoginPanel");this.EQQ_ReLoginButton=G.id("EQQ_ReLoginButton");E.on(this.EQQ_ReLoginButton,"click",n.bind(this.onReLoginButtonClick,this));this.EQQ_TabBuddyList=G.id("EQQ_TabBuddyList");this.EQQ_TabGroupList=G.id("EQQ_TabGroupList");this.EQQ_TabRecentList=G.id("EQQ_TabRecentList");this.EQQ_ListContainer=G.id("EQQ_ListContainer");this.EQQ_buddyListPanel=G.id("EQQ_buddyListPanel");if(n.platform.iPad){new n.ui.TouchScroller(this.EQQ_buddyListPanel);}this.EQQ_buddyList=G.id("EQQ_buddyList");E.on(this.EQQ_buddyList,"mousedown",an);E.on(this.EQQ_buddyListPanel,"scroll",ai);this.EQQ_createGroupButton=G.id("EQQ_createGroupButton");this.EQQ_searchGroupButton=G.id("EQQ_searchGroupButton");E.on(this.EQQ_createGroupButton,"click",qqweb.util.observer.openInWebBrowser);E.on(this.EQQ_createGroupButton,"click",function(){pgvSendClick({hottag:"WEB2QQ.QQPANEL.QUN.CREATE"});});E.on(this.EQQ_searchGroupButton,"click",qqweb.util.observer.openInWebBrowser);E.on(this.EQQ_searchGroupButton,"click",function(){pgvSendClick({hottag:"WEB2QQ.QQPANEL.QUN.QUNSEEK"});});this.EQQ_ListBottom_maskButton=G.id("EQQ_ListBottom_maskButton");E.on(this.EQQ_ListBottom_maskButton,"click",T);this.EQQ_groupListPanel=G.id("EQQ_groupListPanel");this.EQQ_groupListInner=G.id("EQQ_groupListInner");if(n.platform.iPad){new n.ui.TouchScroller(this.EQQ_groupListInner.parentNode);}E.on(this.EQQ_groupListInner,"mousedown",an);this.EQQ_recentListPanel=G.id("EQQ_recentListPanel");if(n.platform.iPad){new n.ui.TouchScroller(this.EQQ_recentListPanel);}this.EQQ_recentList=G.id("EQQ_recentList");E.on(this.EQQ_recentList,"mousedown",an);this.EQQ_findBuddy=G.id("EQQ_findBuddy");this.EQQ_buddyManage=G.id("EQQ_buddyManage");E.on(this.EQQ_findBuddy,"click",function(J){J.preventDefault();pgvSendClick({hottag:"WEB2QQ.QQPANEL.CONTACTS.SEEK"});qqweb.portal.runApp("buddyFinder",{});});E.on(this.EQQ_buddyManage,"click",function(J){J.preventDefault();pgvSendClick({hottag:"WEB2QQ.QQPANEL.CONTACTS.MANAGE"});qqweb.portal.runApp("5",{});});this.mainTab=new n.ui.Tab();this.mainTab.add({trigger:this.EQQ_TabBuddyList,sheet:this.EQQ_buddyListPanel});this.mainTab.add({trigger:this.EQQ_TabGroupList,sheet:this.EQQ_groupListPanel});this.mainTab.add({trigger:this.EQQ_TabRecentList,sheet:this.EQQ_recentListPanel});this.mainTab.config.triggerEvent="click";this.mainTab.config.slideEnabled=false;this.mainTab.init();E.addObserver(this.mainTab,"show",function(ao){var J=this.indexOf(ao);switch(J){case 0:pgvSendClick({hottag:"WEB2QQ.QQPANEL.CONTACTS.CONTACTSLIST"});break;case 1:pgvSendClick({hottag:"WEB2QQ.QQPANEL.QUN.QUNLIST"});break;case 2:pgvSendClick({hottag:"WEB2QQ.QQPANEL.RECENT.RECENTLIST"});break;}});this.onWindowResize();G.show(this.EQQ_MyState);};this.createStatePanelDom=function(){var ao=G.node("ul",{id:"EQQ_StatePanel","class":"EQQ_statePanel"});p.appendChild(ao);this.statePanel=new qqweb.layout.PopupBox({noCatchMouseUp:true,container:ao,html:'					<li class="EQQ_statePanel_li" id="EQQ_SetOnline" state="online"><div class="EQQ_stateSelect_icon EQQ_online"></div><div class="EQQ_stateSelect_text">我在线上</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetAway" state="away"><div class="EQQ_stateSelect_icon EQQ_away"></div><div class="EQQ_stateSelect_text">离开</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetHidden" state="hidden"><div class="EQQ_stateSelect_icon EQQ_hidden"></div><div class="EQQ_stateSelect_text">隐身</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetOffline" state="offline"><div class="EQQ_stateSelect_icon EQQ_offline"></div><div class="EQQ_stateSelect_text">离线</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetCallme" state="callme"><div class="EQQ_stateSelect_icon EQQ_callme"></div><div class="EQQ_stateSelect_text">Q我吧</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetBusy" state="busy"><div class="EQQ_stateSelect_icon EQQ_busy"></div><div class="EQQ_stateSelect_text">忙碌</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetSilent" state="silent"><div class="EQQ_stateSelect_icon EQQ_silent"></div><div class="EQQ_stateSelect_text">请勿打扰</div></li>'});E.addObserver(this.statePanel,"hide",ah);E.addObserver(this.statePanel,"show",Y);this.EQQ_SetOnline=G.id("EQQ_SetOnline");this.EQQ_SetCallme=G.id("EQQ_SetCallme");this.EQQ_SetAway=G.id("EQQ_SetAway");this.EQQ_SetBusy=G.id("EQQ_SetBusy");this.EQQ_SetSilent=G.id("EQQ_SetSilent");this.EQQ_SetHidden=G.id("EQQ_SetHidden");this.EQQ_SetOffline=G.id("EQQ_SetOffline");var J=[this.EQQ_SetOnline,this.EQQ_SetCallme,this.EQQ_SetAway,this.EQQ_SetBusy,this.EQQ_SetSilent,this.EQQ_SetHidden,this.EQQ_SetOffline];n.array.forEach(J,function(ar,aq,ap){E.on(ar,"mouseover",am);});n.array.forEach(J,function(ar,aq,ap){E.on(ar,"mouseout",t);});n.array.forEach(J,function(ar,aq,ap){E.on(ar,"click",y);});};this.createGroupMaskPanelDom=function(){var J=G.node("div",{"class":"groupMaskPanel"});p.appendChild(J);L.groupMaskPanel=new qqweb.layout.PopupBox({container:J,html:' <a id="GroupMask_Costom" state="0" class="simpleMenuItem" href="###"><div class="selectedIcon"></div>使用群自身的消息设置</a>					<a id="GroupMask_Prompt" state="1" class="simpleMenuItem" href="###"><div class="selectedIcon"></div>所有群接收并提示消息</a>					<a id="GroupMask_NoPrompt" state="2" class="simpleMenuItem" href="###"><div class="selectedIcon"></div>所有群接收不提示消息</a>					<a id="GroupMask_Mask" state="3" class="simpleMenuItem" href="###"><div class="selectedIcon"></div>所有群完全阻止群消息</a>'});this.costomDom=G.id("GroupMask_Costom");this.promptDom=G.id("GroupMask_Prompt");this.noPromptDom=G.id("GroupMask_NoPrompt");this.maskDom=G.id("GroupMask_Mask");var ao=[this.costomDom,this.promptDom,this.noPromptDom,this.maskDom];n.array.forEach(ao,function(ar,aq,ap){E.on(ar,"click",i);});this.setGroupMaskState(K);};var i=function(ao){ao.preventDefault();var J=this.getAttribute("state");K=J;L.setGroupMaskState(K);E.notifyObservers(L,"SetGroupMaskState",J);switch(J){case"0":pgvSendClick({hottag:"WEB2QQ.QQPANEL.MESSAGESETTING.QUNSELF"});break;case"1":pgvSendClick({hottag:"WEB2QQ.QQPANEL.MESSAGESETTING.WIDTHALERTS"});break;case"2":pgvSendClick({hottag:"WEB2QQ.QQPANEL.MESSAGESETTING.WIDTHOUTALERTS"});break;case"3":pgvSendClick({hottag:"WEB2QQ.QQPANEL.MESSAGESETTING.BLOCK"});break;}};this.setGroupMaskState=function(J){G.removeClass(this.costomDom,"simpleMenuItemSelected");G.removeClass(this.promptDom,"simpleMenuItemSelected");G.removeClass(this.noPromptDom,"simpleMenuItemSelected");G.removeClass(this.maskDom,"simpleMenuItemSelected");J=parseInt(J);switch(J){case 0:G.addClass(this.costomDom,"simpleMenuItemSelected");break;case 1:G.addClass(this.promptDom,"simpleMenuItemSelected");break;case 2:G.addClass(this.noPromptDom,"simpleMenuItemSelected");break;case 3:G.addClass(this.maskDom,"simpleMenuItemSelected");break;}};this.setGroupListMaskState=function(ao,aq){var J=G.id("EQQ_GroupList_State_"+ao);var ap=G.id("EQQ_RecentList_State_"+ao);if(!aq){if(J){G.addClass(J,"EQQ_GroupMask_State");}if(ap){G.addClass(ap,"EQQ_GroupMask_State");}}else{if(J){G.removeClass(J,"EQQ_GroupMask_State");}if(ap){G.removeClass(ap,"EQQ_GroupMask_State");}}};var T=function(ao){ao.stopPropagation();var J=G.getClientXY(L.EQQ_ListBottom_maskButton);L.toggleGroupMaskStatePanel(J);};this.toggleGroupMaskStatePanel=function(J){if(this.groupMaskPanel&&this.groupMaskPanel.isShow()){this.hideGroupMaskStatePanel();}else{this.showGroupMaskStatePanel(J);}};this.showGroupMaskStatePanel=function(ar){if(this.groupMaskPanel){}else{this.createGroupMaskPanelDom();}if(ar){var aq=this.groupMaskPanel.getWidth();var ao=this.groupMaskPanel.getHeight();var at=qqweb.layout.getClientWidth();var ap=qqweb.layout.getClientHeight();var J=ar[0],au=ar[1]-100;if(J<2){J=2;}if(au<2){au=2;}if(J>at-aq-2){J=at-aq-2;}if(au>ap-ao-2){au=ap-ao-2;}this.groupMaskPanel.setXY(J,au);}this.groupMaskPanel.show();};this.hideGroupMaskStatePanel=function(){if(this.groupMaskPanel){this.groupMaskPanel.hide();}};this.createMiniCardPanelDom=function(){var ax=G.node("div",{id:"miniCard","class":"panel_1"});ax.innerHTML='			<div class="panel_1_outer">				<div class="panel_1_inner">					<div class="panel_1_container">						<div id="panel_1_center" class="panel_1 panel_1_center"></div>						<div id="panel_1_t" class="panel_1 panel_1_t"></div>						<div id="panel_1_rt" class="panel_1 panel_1_rt"></div>						<div id="panel_1_r" class="panel_1 panel_1_r"></div>						<div id="panel_1_rb" class="panel_1 panel_1_rb"></div>						<div id="panel_1_b" class="panel_1 panel_1_b"></div>						<div id="panel_1_lb" class="panel_1 panel_1_lb"></div>						<div id="panel_1_l" class="panel_1 panel_1_l"></div>						<div id="panel_1_lt" class="panel_1 panel_1_lt"></div>					</div>					<div id="miniCardBody" class="panel_1_content">						<img id="miniCard_avatar" class="miniCard_avatar" />						<div class="miniCard_name">							<div id="miniCard_name_inner" class="miniCard_name_inner"></div>						</div>						<div id="miniCard_signature" class="miniCard_signature">							<div id="miniCard_signature_inner" class="miniCard_signature_inner"></div>						</div>						<div id="miniCard_clientType_innerWrapper" class ="miniCard_clientType_innerWrapper"><div class ="miniCard_clientTypeIcon"></div><div id="miniCard_clientType_inner" class="miniCard_clientType_inner"></div></div>						<div id="miniCard_level" class="miniCard_level">我是等级</div>						<div id="miniCard_quickLink" class="miniCard_quickLink">							<a id="miniCard_qzone" class="miniCard_qzone" type="qzone" title="访问QQ空间" hidefocus target="_blank" href="###"></a>							<a id="miniCard_qmail" class="miniCard_qmail" type="qmail" title="发送邮件" hidefocus target="_blank" href="###"></a>						</div>						<div id="miniCard_buddyOption_tabHead" class="buddyOption_tabHead">							<div id="miniCard_userDetails" class="buddyOption_tabHead_div">详细资料</div>						</div>						<div id="miniCard_buddyOption_tabBody" class="buddyOption_tabBody">						</div>					</div>				</div>			</div>';p.appendChild(ax);var at=G.id("miniCard_avatar");var ay=G.id("miniCard_name_inner");var av=G.id("miniCard_signature");var J=G.id("miniCard_signature_inner");var au=G.id("miniCard_clientType_inner");var aw=G.id("miniCard_clientType_innerWrapper");var ar=G.id("miniCard_level");var ao=G.id("miniCard_qzone");var ap=G.id("miniCard_qmail");var aq=G.id("miniCard_userDetails");E.on(ax,"mouseover",U);E.on(ax,"mouseout",I);E.on(aq,"click",s);E.on(ap,"click",qqweb.util.observer.openInWebBrowser);this.miniCardPanel=new qqweb.layout.Panel({container:ax,body:G.id("miniCardBody"),html:""});this.miniCardPanel.setInfo=function(az){this.uin=az.uin;at.src=EQQ.getUserDefaultAvatar();at.src=az.avatarUrl;ay.innerHTML=az.htmlAllName;ay.title=(az.allName);J.innerHTML="";ar.innerHTML="";ao.href=EQQ.getQzoneUrl(az.uin);ap.href=EQQ.getSendMailUrl(az.uin);if(az.clientType=="1"||az.clientType=="10000"||az.type=="stranger"||!az.clientType){aw.className="miniCard_clientType_innerWrapper";av.style.display="block";}else{aw.className="miniCard_clientType_"+EQQ.hash.clientType[az.clientType||"10000"];au.innerHTML=EQQ.hash.clientTypeText[az.clientType||"10000"]+"登录中";av.style.display="none";}E.notifyObservers(L,"MiniCardShow",az);};this.miniCardPanel.setSignature=function(az){J.innerHTML=az.htmlSignature;J.title=(az.signature);};this.miniCardPanel.setClientType=function(az){if(this.uin==az.uin){if(az.clientType=="1"){aw.className="miniCard_clientType_"+EQQ.hash.clientType[az.clientType||"10000"];au.innerHTML=EQQ.hash.clientTypeText[az.clientType||"10000"]+"登录中";av.style.display="none";}else{aw.className="miniCard_clientType_innerWrapper";av.style.display="block";}}};this.miniCardPanel.setQQLevel=function(aA){var aG=aA.level;var aB=parseInt(aG/64),aE=parseInt((aG%64)/16),az=parseInt(((aG%64)%16)/4),aF=((aG%64)%16)%4,aD="";for(var aC=0;aC<aB;aC++){aD+='<div class="miniCard_level_div qqLevel_queen"></div>';}for(var aC=0;aC<aE;aC++){aD+='<div class="miniCard_level_div qqLevel_sun"></div>';}for(var aC=0;aC<az;aC++){aD+='<div class="miniCard_level_div qqLevel_moon"></div>';}for(var aC=0;aC<aF;aC++){aD+='<div class="miniCard_level_div qqLevel_star"></div>';}ar.innerHTML=aD;ar.title="等级: "+aG;};};this.showMiniCardPanel=function(J,aw){if(this.miniCardPanel){}else{this.createMiniCardPanelDom();}if(aw){var ao=this.miniCardPanel.getWidth()+10;var av=this.miniCardPanel.getHeight()+10;var au=qqweb.layout.getClientWidth();var aq=qqweb.layout.getClientHeight();var at=aw[0],ar=aw[1];if(at<2){at=2;}if(ar<2){ar=2;}if(at>au-ao-2){at=au-ao-2;}if(ar>aq-av-2){ar=aq-av-2;}this.miniCardPanel.setXY(at,ar);}var ap=EQQ.Model.BuddyList.getUserByUin(J);this.miniCardPanel.setInfo(ap,J);this.miniCardPanel.show();};this.hideMiniCardPanel=function(){if(this.miniCardPanel){var J=G.id("miniCard_buddyOption_tabBody");G.setStyle(J,"display","none");this.miniCardPanel.hide();}};this.setNoneFlashStyle=function(){G.addClass(this.EQQ_buddyList,"EQQ_buddyList_noneFlash");};this.createDom=function(ao){var J=G.node("div",{id:"EQQ_MainPanel"});J.innerHTML='				<div class="EQQ_title">					<div id="EQQ_PinDownButton" class="EQQ_PinDownButton" title="钉住/收起">钉住/收起</div>					<div id="EQQ_CloseButton" class="EQQ_CloseButton" title="隐藏好友列表">最小化</div>					<div id="EQQ_MinButton" class="EQQ_MinButton" title="设置">设置</div>					<a class="EQQ_FeedbackButton2" href="http://support.qq.com/portal/discuss_pdt/420_1.html" target="_blank">反馈</a>					<div id="EQQ_SettingButton" class="EQQ_settingButton" title="设置WebQQ">						<div class="EQQ_settingButtonIcon">下</div>						<div>设置</div>					</div>					<div class="EQQ_titleText" href="#" target="_blank" title="联系人">联系人</div>					<div class="EQQ_betaText" title="1.0.10.12"></div>				</div>				<div id="EQQ_YellowTips" class="EQQ_YellowTips">					<div id="EQQ_YellowTips_CloseButton" class="EQQ_YellowTips_CloseButton" title="关闭提示">X</div>					<a class="EQQ_YellowTips_Link" href="http://survey.qq.com/cgi-bin/submitsurvey?id=2473&qpage=1&page=1&rm=dnN4k1bBG" target="_blank">邀请参与WebQQ用户调查</a>				</div>				<div id="EQQ_LoginSuccess">					<div id="EQQ_SearchBar" class="EQQ_SearchBar">						<input id="EQQ_SearchBox" class="EQQ_SearchBox" name="" type="text" value="搜索好友..." title="搜索好友..." />						<div id="EQQ_SearchButton" class="EQQ_SearchButton" title="搜索...">搜索按钮</div>					</div>					<div id="EQQ_SearchResultPanel" class="EQQ_SearchResultPanel-1">						<div class="EQQ_SearchResultItem" title="">Kevity1(666666)</div>						<div class="EQQ_SearchResultItemHover" title="">Kevity2(666666)</div>						<div class="EQQ_SearchResultItem" title="">Kevity3(66666)</div>					</div>					<ul class="EQQ_tab">						<li id="EQQ_TabBuddyList" class="EQQ_tabBuddyList" title="联系人"><div class="EQQ_tabBuddyList_icon"></div></li>						<li id="EQQ_TabGroupList" class="EQQ_tabGroupList" title="群列表"><div class="EQQ_tabGroupList_icon"></div></li>						<li id="EQQ_TabRecentList" class="EQQ_tabRecentList" title="最近联系人"><div class="EQQ_tabRecentList_icon"></div></li>					</ul>					<div id="EQQ_ListContainer">						<div id="EQQ_buddyListPanel" class="EQQ_buddyListPanel">							<div id="EQQ_buddyList" class="EQQ_buddyList">							</div>							<div class="EQQ_ListBottom">								<a href="" id="EQQ_findBuddy" class="searchBuddy" target="_blank"><div class="searchBuddy_div"></div>查找</a>								<a href="" id="EQQ_buddyManage" class="buddy_manage_icon" target="_blank"><div class="buddy_manage_icon_div"></div>管理</a>							</div>						</div>						<div id="EQQ_groupListPanel" class="EQQ_groupListPanel"><div class="EQQ_groupListOuter"><div id="EQQ_groupListInner" class="EQQ_groupListInner"></div></div>							<div class="EQQ_ListBottom">								<a id="EQQ_createGroupButton" class="createGroup" href="http://qun.qq.com/air/create" target="_blank" title="创建群"><div class="createGroup_div"></div>创建</a>								<a id="EQQ_searchGroupButton" class="searchGroup" href="http://qun.qq.com/air/search" target="_blank" title="查找群"><div class="searchGroup_div"></div>查找</a>								<div id="EQQ_ListBottom_maskButton"><div></div>群屏蔽</div>							</div>						</div>						<div id="EQQ_recentListPanel" class="EQQ_recentListPanel"><div id="EQQ_recentList" class="EQQ_recentList"></div></div>					</div>				</div>				<div style="height:1000px;width:1000px;">					<div id="EQQ_Logining">发起连接...</div>				</div>				<div id="EQQ_Logining_feedback"><a href="http://support.qq.com/write.shtml?guest=1&fid=513" target="_blank">					<span class="warnning_yellow">&nbsp;</span>反馈登录建议</a></div>				<div id="EQQ_ReLoginPanel">					登录失败，<span id="EQQ_ReLoginButton">重试</span>				</div>';ao.innerHTML="";ao.appendChild(J);G.setClass(J,"EQQ_mainPanel");};this.onYellowTipsClick=function(){L.hideYellowTips();E.notifyObservers(L,"CloseYellowTipsFinish");};this.showYellowTips=function(){b=b+z;this.onWindowResize();G.show(this.EQQ_YellowTips);};this.hideYellowTips=function(){G.hide(this.EQQ_YellowTips);b=b-z;this.onWindowResize();};this.onEqqResize=function(aq){var J=5;var ao=aq.height;var ap=ao-w;if(ap<J){ap=J;}G.setStyle(this.EQQ_ListContainer,"height",(ap-J)+"px");G.setStyle(this.EQQ_buddyListPanel,"height",(ap-J-25)+"px");C();};this.onWindowResize=function(J){};this.onSearchBoxMouseover=function(){G.setClass(this,"EQQ_SearchBoxHover");};this.onSearchBoxMouseout=function(){G.setClass(this,"EQQ_SearchBox");};this.onSearchBoxFocus=function(){E.off(L.EQQ_SearchBox,"mouseover",L.onSearchBoxMouseover);E.off(L.EQQ_SearchBox,"mouseout",L.onSearchBoxMouseout);G.setClass(this,"EQQ_SearchBoxFocus");L.clearSearchBox(this);this.select();L.startSearch();};this.onSearchBoxBlur=function(){E.on(L.EQQ_SearchBox,"mouseover",L.onSearchBoxMouseover);E.on(L.EQQ_SearchBox,"mouseout",L.onSearchBoxMouseout);G.setClass(this,"EQQ_SearchBox");L.resetSearchBox(this);};this.resetSearchBox=function(J){if(J.value==""){J.value="搜索好友...";}};this.clearSearchBox=function(J){if(n.string.trim(J.value)=="搜索好友..."){J.value="";}};this.onSearchButtonClick=function(){L.startSearch();};this.onSearchBoxKeyup=function(J){if(!L.EQQ_SearchBox.value){L.hideSearchResult();return;}if(J.keyCode!=ab&&J.keyCode!=F){L.startSearch();}};this.onSearchBoxKeydown=function(ao){switch(ao.keyCode){case O:if(m){ao.preventDefault();L.hideSearchResult();E.notifyObservers(L,"StartChat",m.uin);}break;case ab:if(H>0){var J=G.id("EQQ_SearchResultItem_"+m.uin);G.setStyle(J,"backgroundColor","transparent");H--;m=S[H];J=G.id("EQQ_SearchResultItem_"+m.uin);if(J){G.setStyle(J,"backgroundColor","#cbe7fc");}}break;case F:if(H<S.length-1){var J=G.id("EQQ_SearchResultItem_"+m.uin);G.setStyle(J,"backgroundColor","transparent");H++;m=S[H];J=G.id("EQQ_SearchResultItem_"+m.uin);if(J){G.setStyle(J,"backgroundColor","#cbe7fc");}}break;default:break;}};this.startSearch=function(){this.clearSearchBox(this.EQQ_SearchBox);var J=this.EQQ_SearchBox.value;E.notifyObservers(this,"Search",J);};this.showSearchResult=function(J){if(this.EQQ_SearchBox.value){S=J;var ar=G.getRelativeXY(this.EQQ_SearchBox,this.EQQ_MainPanel);G.setStyle(this.EQQ_SearchResultPanel,"left",ar[0]+"px");G.setStyle(this.EQQ_SearchResultPanel,"top",(ar[1]+26)+"px");G.show(this.EQQ_SearchResultPanel);this.EQQ_SearchResultPanel.innerHTML="";if(J.length==0){H=null;m=null;this.EQQ_SearchResultPanel.innerHTML='<div class="EQQ_SearchResultNo">没有找到相关好友</div>';}else{H=0;m=J[0];for(var ap=0;ap<J.length;ap++){var ao=J[ap];var aq=G.node("div");G.setClass(aq,"EQQ_SearchResultItem");aq.id="EQQ_SearchResultItem_"+ao.uin;aq.setAttribute("uin",ao.uin);aq.innerHTML=ao.htmlAllName;aq.title=(ao.allName);this.EQQ_SearchResultPanel.appendChild(aq);if(ap==0){G.setStyle(aq,"backgroundColor","#cbe7fc");}E.on(aq,"mouseover",this.onSearchResultMouseover);E.on(aq,"mouseout",this.onSearchResultMouseout);E.on(aq,"mousedown",this.onSearchResultClick);}}E.on(document,"mousedown",n.bind(this.hideSearchResult,this));}};this.hideSearchResult=function(){G.hide(this.EQQ_SearchResultPanel);E.off(document,"mousedown");};this.onSearchResultMouseover=function(){G.setStyle(this,"backgroundColor","#cbe7fc");};this.onSearchResultMouseout=function(){G.setStyle(this,"backgroundColor","transparent");};this.onSearchResultClick=function(){var J=this.getAttribute("uin");L.hideSearchResult();E.notifyObservers(L,"StartChat",J);};this.show=function(){G.show(this.EQQ_MainPanel);};this.hide=function(){G.hide(this.EQQ_MainPanel);};this.updateSelfInfoChange=function(J){this.EQQ_MyAvatar.src=EQQ.getUserAvatar(J.uin);this.EQQ_MyAvatar.title="修改资料";this.EQQ_MyNick.innerHTML=J.htmlShowName;this.EQQ_MyNick.title=(J.showName+"<"+J.uin+">");};this.updateSelfStateChange=function(J){G.setClass(this.EQQ_MyStateShow,"EQQ_myStateShow EQQ_"+J);if(J==="offline"){G.addClass(this.EQQ_MyAvatar,"EQQ_myAvatar_offline");}else{G.removeClass(this.EQQ_MyAvatar,"EQQ_myAvatar_offline");}};this.updateSelfSignatureChange=function(J){if(J.signature){this.EQQ_MySignature.innerHTML=J.htmlSignature;this.EQQ_MySignature.title=(J.signature);}else{this.EQQ_MySignature.innerHTML="有个性，没签名";this.EQQ_MySignature.title="有个性，没签名";}};this.createBuddyClass=function(ao){d=ao;this.addOnlineBuddyClass();for(var J=0;J<ao.length;J++){this.addBuddyClass(ao[J]);}this.addStrangerBuddyClass();this.addBlackListBuddyClass();};this.addOnlineBuddyClass=function(){var J={};J.index=EQQ.hash.userClassType.online;J.name="在线好友";J.htmlName=n.string.toHtml(J.name);J.titleName=n.string.encodeHtmlSimple(J.name);J.count=0;J.onlineCount=0;J.list={callme:[],online:[],away:[],busy:[],silent:[],offline:[]};this.addBuddyClass(J);};this.addStrangerBuddyClass=function(){var J={};J.index=EQQ.hash.userClassType.stranger;J.name="陌生人";J.htmlName=n.string.toHtml(J.name);J.titleName=n.string.encodeHtmlSimple(J.name);J.count=0;J.onlineCount=0;J.list={callme:[],online:[],away:[],busy:[],silent:[],offline:[]};this.addBuddyClass(J);};this.addBlackListBuddyClass=function(){var J={};J.index=EQQ.hash.userClassType.blacklist;J.name="黑名单";J.htmlName=n.string.toHtml(J.name);J.titleName=n.string.encodeHtmlSimple(J.name);J.count=0;J.onlineCount=0;J.list={callme:[],online:[],away:[],busy:[],silent:[],offline:[]};this.addBuddyClass(J);};var ak=function(au){var ao=au.width;var J=W.length;for(;(--J)>=0;){var ar=W[J].el=W[J].el||G.id("EQQ_Class_"+W[J].index+"_className");var at=W[J].len;var aq=W[J].html;var ap=W[J].html_short;if(ao<=200){ar.innerHTML=ap;}else{if(ao>at+20){ar.innerHTML=aq;}}}};this.addBuddyClass=function(ao,at){var av,aw,ap;av=G.node("div",{id:"EQQ_listClassHead_"+ao.index,classIndex:ao.index});if(ao.index==EQQ.hash.userClassType.online){aw='					<div class="EQQ_listClassHeadIcon">icon</div>					<div class="EQQ_ClassList_RightContainer" title="<%=titleName%>">						<div class="EQQ_Class_className" id="EQQ_Class_<%=index%>_className"><%=cut_htmlName%></div>[<span id="EQQ_Class_<%=index%>_OnlineCounter"><%=onlineCount%></span>]					</div>				';}else{aw='					<div class="EQQ_listClassHeadIcon">icon</div>					<div class="EQQ_ClassList_RightContainer" title="<%=titleName%>">						<div class="EQQ_Class_className" id="EQQ_Class_<%=index%>_className"><%=cut_htmlName%>&nbsp;</div>[<span id="EQQ_Class_<%=index%>_OnlineCounter"><%=onlineCount%></span>/<span id="EQQ_Class_<%=index%>_Counter"><%=count%></span>]					</div>				';}ao.cut_htmlName=ao.htmlName;if(ao.caculateName){var ax="["+ao.onlineCount+"/"+(ao.count||1)+"]";var au=ao.caculateName+ax;var J=x.getCharWidth(au,12);if(J>120){var ar={index:ao.index,len:J,html:ao.cut_htmlName};ao.cut_htmlName='<div class="mainpanel_limit_class_width_outer"><div class="mainpanel_limit_class_width_inner">'+ao.htmlName+"</div></div>...";ar.html_short=ao.cut_htmlName;W.push(ar);}}ap=n.string.template(aw,ao);av.innerHTML=ap;if(at){this.EQQ_buddyList.insertBefore(av,at);}else{this.EQQ_buddyList.appendChild(av);}E.on(av,"click",al);var aq=G.node("div",{id:"EQQ_listClassBody_"+ao.index,"class":"EQQ_listClassBody"});aw='				<div id="EQQ_Class_<%=index%>_callme" class="EQQ_callmeBuddy"></div>				<div id="EQQ_Class_<%=index%>_online" class="EQQ_onlineBuddy"></div>				<div id="EQQ_Class_<%=index%>_busy" class="EQQ_busyBuddy"></div>				<div id="EQQ_Class_<%=index%>_away" class="EQQ_awayBuddy"></div>				<div id="EQQ_Class_<%=index%>_silent" class="EQQ_silentBuddy"></div>				<div id="EQQ_Class_<%=index%>_offline" class="EQQ_offlineBuddy"></div>			';ap=n.string.template(aw,ao);aq.innerHTML=ap;this.EQQ_buddyList.insertBefore(aq,av.nextSibling);this.collapsedClass(ao.index);};this.hideLogin=function(){G.hide(this.EQQ_Logining);G.hide(this.EQQ_Logining_feedback);G.hide(this.EQQ_ReLoginPanel);G.show(this.EQQ_LoginSuccess);G.setStyle(this.EQQ_LoginSuccess,"height","100%");var J={height:EQQ.window.getBodySize().height,width:EQQ.window.getBodySize().width};this.onEqqResize(J);ak(J);};this.showLogin=function(){this.EQQ_Logining.innerHTML="发起连接...";G.show(this.EQQ_Logining);G.show(this.EQQ_Logining_feedback);G.hide(this.EQQ_ReLoginPanel);G.hide(this.EQQ_LoginSuccess);G.setStyle(this.EQQ_LoginSuccess,"height","0px");};this.showPullData=function(){this.EQQ_Logining.innerHTML="拉取数据...";};this.clearBuddyList=function(){this.EQQ_buddyList.innerHTML="";};this.createBuddyList=function(J){n.timedChunk(J,this.addBuddy,this,false,function(){E.notifyObservers(L,"BuddyListReady");});};this.getClassExpandFlag=function(J){return ac[J];};this.setClassExpandFlag=function(ao,J){return ac[ao]=J;};this.getClassAvatarLoadFlag=function(J){return ae[J];};this.setClassAvatarLoadFlag=function(ao,J){return ae[ao]=J;};this.toggleClass=function(J){if(ac[J]){this.collapsedClass(J);}else{this.expandClass(J);}};this.collapsedClass=function(ao){var J=G.id("EQQ_listClassHead_"+ao),ap=G.id("EQQ_listClassBody_"+ao);if(ao==EQQ.hash.userClassType.online){G.setClass(J,"EQQ_onlineClassHeadCollapsed");G.removeClass(J,"expand_online");}else{G.setClass(J,"EQQ_listClassHeadCollapsed");G.removeClass(J,"expand");}G.setStyle(ap,"height","0");this.setClassExpandFlag(ao,false);};this.expandClass=function(ao){var J=G.id("EQQ_listClassHead_"+ao),ap=G.id("EQQ_listClassBody_"+ao);if(ao==EQQ.hash.userClassType.online){G.setClass(J,"EQQ_onlineClassHeadExpand");G.addClass(J,"expand_online");}else{G.setClass(J,"EQQ_listClassHeadExpand");G.addClass(J,"expand");}G.setStyle(ap,"height","auto");this.setClassExpandFlag(ao,true);n.out("index: "+ao);N();};var N=function(){l(L.EQQ_buddyListPanel);};var ai=function(J){C();};var C=function(J){if(ai.timer){window.clearTimeout(ai.timer);ai.timer=null;}ai.timer=window.setTimeout(N,500);};var l=function(aq){var ay=parseInt(G.getStyle(aq,"height"),10);var ap=aq.scrollTop;var aw=G.getXY(aq)[1];for(var at=0;at<a.length;){var ar=a[at];var J=ar.imgEl;var ao=ar.uin;var au=ar.classId;var av=G.getXY(J)[1];var ax=av-aw;n.out("imgTop1:"+ax+"y2:"+av);if(L.getClassExpandFlag(au)&&J&&ax>0&&ax<ay){n.out("checkAndLoadAvatar & loadAvatar containerHeight: "+ay+", imgTop2:"+ax);J.src=EQQ.getUserAvatar(ar.uin);a.splice(at,1);}else{at++;}}};this.addBuddy=function(ap){if(ap){var ar='					<div class="EQQ_BuddyList_ClientType" uin="<%=uin%>" id="EQQ_BuddyList_ClientType_Title_<%=uin%>" title="'+EQQ.hash.clientTypeText[ap.clientType||"PC"]+'">						<div id="EQQ_BuddyList_ClientType_<%=uin%>" class="EQQ_BuddyList_ClientType_'+EQQ.hash.clientType[ap.clientType||"10000"]+'"></div>					</div>					<div id="EQQ_BuddyList_AvatarContainer_<%=uin%>" class="EQQ_BuddyList_AvatarContainer" uin="<%=uin%>" title="'+EQQ.hash.onlineStatusText[ap.state]+'">						<img id="EQQ_BuddyList_Avatar_<%=uin%>" class="EQQ_BuddyList_Avatar" src="'+EQQ.CONST.EQQ_SERVER_URL+'style/images/avatar_default_20_20.gif" />						<div class="EQQ_BuddyList_State"></div>					</div>					<div id="EQQ_BuddyList_RightContainer_<%=uin%>" class="EQQ_BuddyList_RightContainer" title="<%=titleAllName%> - '+EQQ.hash.onlineStatusText[ap.state]+'">						<div id="EQQ_BuddyList_Nick_<%=uin%>" class="EQQ_BuddyList_Nick"><%=htmlShowName%></div>					</div>				';var aq=n.string.template(ar,ap);var J=G.id("EQQ_Class_"+ap.classId+"_"+ap.state);G.show(J);var au=G.node("div",{id:"EQQ_Buddy_"+ap.uin,"class":"EQQ_BuddyList_Buddy",uin:ap.uin});au.innerHTML=aq;J.appendChild(au);E.on(au,"mouseover",D);E.on(au,"mouseout",M);E.on(au,"click",ag);var ao=G.id("EQQ_BuddyList_AvatarContainer_"+ap.uin);E.on(ao,"mouseover",Z);E.on(ao,"mouseout",j);var at=G.id("EQQ_BuddyList_Avatar_"+ap.uin);if(this.getClassExpandFlag(ap.classId)){n.out("addBuddy & loadAvatar");at.src=EQQ.getUserAvatar(ap.uin);}else{a.push({uin:ap.uin,imgEl:at,classId:ap.classId});}}};this.addOnlineBuddy=function(ap){if(ap){var av=EQQ.hash.clientTypeText[ap.clientType||"pc"]==="PC"?"":EQQ.hash.clientTypeText[ap.clientType||"pc"];var ar='					<div class="EQQ_BuddyList_ClientType" uin="<%=uin%>" id="EQQ_OnlineBuddyList_ClientType_Title_<%=uin%>" title="'+EQQ.hash.clientTypeText[ap.clientType]+'">						<div id="EQQ_OnlineBuddyList_ClientType_<%=uin%>" class="EQQ_BuddyList_ClientType_'+EQQ.hash.clientType[ap.clientType||"10000"]+'"></div>					</div>					<div id="EQQ_OnlineBuddyList_AvatarContainer_<%=uin%>" class="EQQ_BuddyList_AvatarContainer" uin="<%=uin%>" title="'+EQQ.hash.onlineStatusText[ap.state]+'">						<img id="EQQ_OnlineBuddyList_Avatar_<%=uin%>" class="EQQ_BuddyList_Avatar" src="'+EQQ.CONST.EQQ_SERVER_URL+'style/images/avatar_default_20_20.gif" />						<div class="EQQ_BuddyList_State"></div>					</div>					<div class="EQQ_BuddyList_RightContainer" title="<%=titleAllName%> - '+av+EQQ.hash.onlineStatusText[ap.state]+'">						<div class="EQQ_BuddyList_Nick"><%=htmlShowName%></div>					</div>				';var aq=n.string.template(ar,ap);var J=G.id("EQQ_Class_"+EQQ.hash.userClassType.online+"_"+ap.state);G.setStyle(J,"display","block");var au=G.node("div",{id:"EQQ_OnlineBuddy_"+ap.uin,uin:ap.uin});au.innerHTML=aq;J.appendChild(au);E.on(au,"mouseover",D);E.on(au,"mouseout",M);E.on(au,"click",ag);G.addClass(au,"EQQ_BuddyList_Buddy");var ao=G.id("EQQ_OnlineBuddyList_AvatarContainer_"+ap.uin);E.on(ao,"mouseover",Z);E.on(ao,"mouseout",j);var at=G.id("EQQ_OnlineBuddyList_Avatar_"+ap.uin);if(this.getClassExpandFlag(EQQ.hash.userClassType.online)){n.out("addOnlineBuddy & loadAvatar");at.src=EQQ.getUserAvatar(ap.uin);}else{a.push({uin:ap.uin,imgEl:at,classId:EQQ.hash.userClassType.online});}}};this.removeOnlineBuddy=function(J){var ap=G.id("EQQ_OnlineBuddy_"+J.uin);if(ap){E.off(ap);if(ap.parentNode){var ao=ap.parentNode;ao.removeChild(ap);}}};this.updateOnlineBuddyClass=function(ao){var J=ao.length;G.id("EQQ_Class_"+EQQ.hash.userClassType.online+"_OnlineCounter").innerHTML=J;};this.jumpUp=function(ao){P=true;for(var J=0;J<ao.length;J++){var ap=G.id("EQQ_Buddy_"+ao[J]);if(ap){G.addClass(ap,"EQQ_jumpUpInBuddyList");}}};this.jumpDown=function(ao){P=false;for(var J=0;J<ao.length;J++){var ap=G.id("EQQ_Buddy_"+ao[J]);if(ap){G.removeClass(ap,"EQQ_jumpUpInBuddyList");}}};this.jumpAvatar=function(J){if(P){this.jumpDown(J);}else{this.jumpUp(J);}};this.flickerClassHide=function(ap){g=true;for(var ao=0;ao<ap.length;ao++){var J=G.id("EQQ_listClassHead_"+ap[ao]);G.addClass(J,"EQQ_flickerHideInBuddyList");}};this.flickerClassShow=function(ap){g=false;for(var ao=0;ao<ap.length;ao++){var J=G.id("EQQ_listClassHead_"+ap[ao]);G.removeClass(J,"EQQ_flickerHideInBuddyList");}};this.flickerClass=function(J){if(g){this.flickerClassShow(J);}else{this.flickerClassHide(J);}};this.groupJumpUp=function(ao){q=true;for(var J=0;J<ao.length;J++){var ap=G.id("EQQ_Group_"+ao[J]);if(ap){G.addClass(ap,"EQQ_jumpUpInGroupList");}}};this.groupJumpDown=function(ao){q=false;for(var J=0;J<ao.length;J++){var ap=G.id("EQQ_Group_"+ao[J]);if(ap){G.removeClass(ap,"EQQ_jumpUpInGroupList");}}};this.groupJumpAvatar=function(J){if(q){this.groupJumpDown(J);}else{this.groupJumpUp(J);}};this.recentJumpUp=function(ao){ad=true;for(var J=0;J<ao.length;J++){var ap=G.id("EQQ_Recent_"+ao[J]);if(ap){G.addClass(ap,"EQQ_jumpUpInBuddyList");G.addClass(ap,"EQQ_jumpUpInGroupList");}}};this.recentJumpDown=function(ao){ad=false;for(var J=0;J<ao.length;J++){var ap=G.id("EQQ_Recent_"+ao[J]);if(ap){G.removeClass(ap,"EQQ_jumpUpInBuddyList");G.removeClass(ap,"EQQ_jumpUpInGroupList");}}};this.recentJumpAvatar=function(J){if(ad){this.recentJumpDown(J);}else{this.recentJumpUp(J);}};this.moveBuddy=function(aq){var av=G.id("EQQ_Buddy_"+aq.uin);var au=G.id("EQQ_Class_"+aq.classId+"_"+aq.state);if(au&&av){G.setStyle(au,"display","block");var at=av.parentNode;au.insertBefore(av,au.firstChild);var ao=G.id("EQQ_BuddyList_AvatarContainer_"+aq.uin);var ar=G.id("EQQ_BuddyList_RightContainer_"+aq.uin);var ap=G.id("EQQ_RecentList_AvatarContainer_"+aq.uin);var J=G.id("EQQ_RecentList_RightContainer_"+aq.uin);if(ao){ao.title=EQQ.hash.onlineStatusText[aq.state];}if(ar){ar.title=(aq.allName+" - "+EQQ.hash.onlineStatusText[aq.state]);}if(ap){ap.title=EQQ.hash.onlineStatusText[aq.state];}if(J){J.title=(aq.allName+" - "+EQQ.hash.onlineStatusText[aq.state]);}if(at.childNodes.length==0){G.setStyle(at,"display","none");}}};this.moveOnlineBuddy=function(J){var aq=G.id("EQQ_OnlineBuddy_"+J.uin);var ap=G.id("EQQ_Class_"+EQQ.hash.userClassType.online+"_"+J.state);if(ap&&aq){G.setStyle(ap,"display","block");var ao=aq.parentNode;ap.insertBefore(aq,ap.firstChild);if(ao.childNodes.length==0){G.setStyle(ao,"display","none");}}};this.updateClientType=function(ao){var aq=EQQ.hash.clientType[ao.clientType];var ap=EQQ.hash.clientTypeText[ao.clientType||"PC"];var J=G.id("EQQ_BuddyList_ClientType_"+ao.uin)||{};var ar=G.id("EQQ_BuddyList_ClientType_Title_"+ao.uin)||{};J.className="EQQ_BuddyList_ClientType_"+aq;ar.title=ap;J=G.id("EQQ_OnlineBuddyList_ClientType_"+ao.uin)||{};ar=G.id("EQQ_OnlineBuddyList_ClientType_Title_"+ao.uin)||{};J.className="EQQ_BuddyList_ClientType_"+aq;ar.title=ap;};this.updateBuddyClassOnlineBuddy=function(J){G.id("EQQ_Class_"+J.index+"_OnlineCounter").innerHTML=J.onlineCount;};this.updateRecentState=function(ao){var ar=G.id("EQQ_Recent_"+ao.uin);if(ar){ar.className="";G.addClass(ar,"EQQ_BuddyList_Buddy");G.addClass(ar,"EQQ_"+EQQ.hash.onlineStatus[ao.state]+"Buddy");var aq=EQQ.hash.clientType[ao.clientType];var ap=EQQ.hash.clientTypeText[ao.clientType||"PC"];var J=G.id("EQQ_RecentList_ClientType_"+ao.uin)||{};var at=G.id("EQQ_RecentList_ClientType_Title_"+ao.uin)||{};J.className="EQQ_BuddyList_ClientType_"+aq;at.title=ap;}};this.updateBuddyClassCount=function(J){G.id("EQQ_Class_"+J.index+"_Counter").innerHTML=J.count;};this.updateStrangerClassOnlineCount=function(ao){var J=G.id("EQQ_Class_"+EQQ.hash.userClassType.stranger+"_OnlineCounter");J.innerHTML=ao;};this.updateStrangerClassCount=function(ao){var J=ao.length;G.id("EQQ_Class_"+EQQ.hash.userClassType.stranger+"_Counter").innerHTML=J;};this.setUserName=function(J){var ao=J.uin;var aq=G.id("EQQ_BuddyList_Nick_"+ao);var ap=G.id("EQQ_BuddyList_RightContainer_"+ao);if(aq&&ap){aq.innerHTML=J.htmlShowName;ap.title=(J.allName);}};this.setGroupMask=function(J){K=J;switch(J){case"0":case 0:G.id("EQQ_ListBottom_maskButton").className="accept";G.id("EQQ_ListBottom_maskButton").childNodes[0].className="accept_div";break;case"1":case 1:G.id("EQQ_ListBottom_maskButton").className="accept";G.id("EQQ_ListBottom_maskButton").childNodes[0].className="accept_div";break;case"2":case 2:G.id("EQQ_ListBottom_maskButton").className="mask";G.id("EQQ_ListBottom_maskButton").childNodes[0].className="mask_div";break;case"3":case 3:G.id("EQQ_ListBottom_maskButton").className="mask";G.id("EQQ_ListBottom_maskButton").childNodes[0].className="mask_div";break;}};this.showReLoginPanel=function(){G.hide(this.EQQ_Logining);G.hide(this.EQQ_Logining_feedback);G.show(this.EQQ_ReLoginPanel);G.hide(this.EQQ_LoginSuccess);};this.onReLoginButtonClick=function(){G.show(this.EQQ_Logining);G.show(this.EQQ_Logining_feedback);G.hide(this.EQQ_ReLoginPanel);G.hide(this.EQQ_LoginSuccess);E.notifyObservers(this,"ReLogin");};this.createGroupList=function(J){this.EQQ_groupListInner.innerHTML="";for(var ao=0;ao<J.length;ao++){this.addGroup(J[ao]);}};this.addGroup=function(ap){var J='				<div class="EQQ_GroupList_AvatarContainer" title="">					<img id="EQQ_GroupList_Avatar_'+ap.gid+'" class="EQQ_GroupList_Avatar" src="'+EQQ.getGroupAvatar(ap.code)+'" />					<div class="EQQ_GroupList_State" id="EQQ_GroupList_State_'+ap.gid+'" title="群屏蔽"></div>				</div>				<div class="EQQ_GroupList_RightContainer" title="<%=titleAllName%> - <%=titleTypeText%>">					<div class="EQQ_GroupList_Name"><%=htmlShowName%></div>				</div>			';var ao=n.string.template(J,ap);var aq=G.node("div",{id:"EQQ_Group_"+ap.gid,code:ap.code});aq.innerHTML=ao;this.EQQ_groupListInner.appendChild(aq);E.on(aq,"mouseover",D);E.on(aq,"mouseout",M);E.on(aq,"click",aj);G.addClass(aq,"EQQ_GroupList_Group");};this.createRecentList=function(ao){this.EQQ_recentList.innerHTML="";for(var J=0;J<ao.length;J++){this.addRecent(ao[J]);}};this.addRecent=function(ax){if(ax.content){if(ax.type==0){var aq=ax.content;var ar='						<div class="EQQ_RecentList_ClientType" uin="<%=uin%>" id="EQQ_BuddyList_ClientType_Title_<%=uin%>" title="'+EQQ.hash.clientTypeText[aq.clientType||"PC"]+'">							<div id="EQQ_RecentList_ClientType_<%=uin%>" class="EQQ_BuddyList_ClientType_'+EQQ.hash.clientType[aq.clientType||"10000"]+'"></div>						</div>						<div id="EQQ_RecentList_AvatarContainer_<%=uin%>" class="EQQ_BuddyList_AvatarContainer" uin="<%=uin%>" title="'+EQQ.hash.onlineStatusText[aq.state]+'">							<img id="EQQ_RecentList_Avatar_<%=uin%>" class="EQQ_BuddyList_Avatar" src="'+EQQ.CONST.EQQ_SERVER_URL+'style/images/avatar_default_20_20.gif" />							<div class="EQQ_BuddyList_State"></div>						</div>						<div id="EQQ_RecentList_RightContainer_<%=uin%>" class="EQQ_BuddyList_RightContainer" title="<%=titleAllName%> - '+EQQ.hash.onlineStatusText[aq.state]+'">							<div id="EQQ_BuddyList_Nick_<%=uin%>" class="EQQ_BuddyList_Nick"><%=htmlShowName%></div>						</div>					';var ap=n.string.template(ar,aq);var aw=G.node("div",{id:"EQQ_Recent_"+aq.uin,uin:aq.uin});aw.innerHTML=ap;this.EQQ_recentList.insertBefore(aw,this.EQQ_recentList.firstChild);E.on(aw,"mouseover",D);E.on(aw,"mouseout",M);E.on(aw,"click",ag);var au=G.id("EQQ_RecentList_AvatarContainer_"+aq.uin);E.on(au,"mouseover",Z);E.on(au,"mouseout",j);G.addClass(aw,"EQQ_BuddyList_Buddy");G.addClass(aw,"EQQ_"+EQQ.hash.onlineStatus[aq.state]+"Buddy");var J=G.id("EQQ_RecentList_Avatar_"+aq.uin);if(aq.uin&&J){J.src=EQQ.getUserAvatar(aq.uin);}}else{var at=ax.content;var av='					<div class="EQQ_GroupList_AvatarContainer" title="">						<img id="EQQ_GroupList_Avatar_'+at.gid+'" class="EQQ_GroupList_Avatar" src="'+EQQ.getGroupAvatar(at.code)+'" />						<div class="EQQ_GroupList_State" id="EQQ_RecentList_State_'+at.gid+'" title="群屏蔽"></div>					</div>					<div class="EQQ_GroupList_RightContainer" title="<%=titleAllName%> - <%=titleTypeText%>">						<div class="EQQ_GroupList_Name"><%=htmlShowName%></div>					</div>				';var ap=n.string.template(av,at);var ao=G.node("div",{id:"EQQ_Recent_"+at.gid,code:at.code});ao.innerHTML=ap;this.EQQ_recentList.insertBefore(ao,this.EQQ_recentList.firstChild);E.on(ao,"mouseover",D);E.on(ao,"mouseout",M);E.on(ao,"click",aj);G.addClass(ao,"EQQ_GroupList_Group");}}};this.updateRecentByBuddy=function(J){var ao=G.id("EQQ_Recent_"+J.uin);if(ao){this.EQQ_recentList.insertBefore(ao,this.EQQ_recentList.firstChild);}else{this.addRecent({type:0,content:J});}};this.updateRecentByGroup=function(J){var ao=G.id("EQQ_Recent_"+J.gid);if(ao){this.EQQ_recentList.insertBefore(ao,this.EQQ_recentList.firstChild);}else{this.addRecent({type:1,content:J});}};this.setMode=function(J){switch(J){case"master":c=V;G.removeClass(this.EQQ_MyState,"EQQ_DisableMyStateSelect");this.EQQ_MyState.title="更改在线状态";break;case"slave":c=o;G.addClass(this.EQQ_MyState,"EQQ_DisableMyStateSelect");this.EQQ_MyState.title="WebQQ现在处于辅模式，请从客户端QQ修改您的在线状态。";break;}};this.toggleStatePanel=function(J){if(this.statePanel&&this.statePanel.isShow()){this.hideStatePanel();}else{this.showStatePanel(J);}};this.showStatePanel=function(ar){if(this.statePanel){}else{this.createStatePanelDom();}if(ar){var aq=this.statePanel.getWidth();var ao=this.statePanel.getHeight();var at=qqweb.layout.getClientWidth();var ap=qqweb.layout.getClientHeight();var J=ar[0],au=ar[1];if(J<2){J=2;}if(au<2){au=2;}if(J>at-aq-2){J=at-aq-2;}if(au>ap-ao-2){au=ap-ao-2;}this.statePanel.setXY(J,au);}this.statePanel.setTopZIndex();this.statePanel.show();};this.hideStatePanel=function(){if(this.statePanel){this.statePanel.hide();}};this.setSelfState=function(J){E.notifyObservers(this,"SelfStateChange",J);this.updateSelfStateChange(J);};});Jet().$package("EQQ.View.MainPanelFlex",function(l){var K=this,F=l.dom,D=l.event,w=l.string,e=false,i=false,O=false,o=false,aa=false,f=false,Z={},X=[],a=[],ab={},G=0,Y=38,E=40,N=13,d,b=160,v=50,y=20,I="0",n=qqweb.layout.getPanel("desktop").body,A=null,k=null,R=null,p=null,Q=null,u=false,s=false;EQQ.avatarMouseoverTimer=null;var t=function(){if(A){clearTimeout(A);}K.show();};var ac=function(){if(A){clearTimeout(A);}A=setTimeout(function(){K.hide();A=null;},500);};var x=function(){var J=this.getAttribute("state");K.setSelfState(J);};var ai=function(){F.setStyle(this,"backgroundColor","#cbe7fc");};var r=function(){F.setStyle(this,"backgroundColor","transparent");};var ae=function(){F.removeClass(K.EQQ_MyState,"hover");};var V=function(){F.addClass(K.EQQ_MyState,"hover");};var m=function(){};var U=function(J){K.toggleStatePanel(J);};var c=U;var z=function(ak){ak.stopPropagation();var J=F.getClientXY(K.EQQ_MyState);J[1]=J[1]+16;c(J);};var ah=function(ak){var J=this.getAttribute("classIndex");K.toggleClass(J);};var C=function(){var J=this;if(p){clearTimeout(p);}p=setTimeout(function(){if(Q){F.setStyle(Q,"backgroundColor","transparent");}F.setStyle(J,"backgroundColor","#cbe7fc");Q=J;},100);};var L=function(){};var W=function(){var J=this.getAttribute("uin");if(EQQ.avatarMouseoverTimer){clearTimeout(EQQ.avatarMouseoverTimer);EQQ.avatarMouseoverTimer=null;}var ak=F.getClientXY(this);ak[0]=ak[0]-218;ak[1]=ak[1]-5;K.showMiniCardPanel(J,ak);D.notifyObservers(K,"AvatarMouseover",J);};var h=function(){EQQ.avatarMouseoverTimer=window.setTimeout(P,500);};this.onAvatarMouseover=function(J,ak){if(J&&ak){if(EQQ.avatarMouseoverTimer){clearTimeout(EQQ.avatarMouseoverTimer);EQQ.avatarMouseoverTimer=null;}var al=F.getClientXY(K.EQQ_buddyList);al[0]=al[0]-218;al[1]=al[1]+ak.y;K.showMiniCardPanel(J,al);D.notifyObservers(K,"AvatarMouseover",J);}};this.onFlexException=function(){var J=window.frames.iframe_fflist;K.flex=J.document.getElementById("fflist");u=true;D.notifyObservers(EQQ,"LoginFailure",{});};this.buddyListReady=function(){var J=window.frames.iframe_fflist;K.flex=J.document.getElementById("fflist");u=true;D.notifyObservers(K,"BuddyListReady");};this.onAvatarMouseout=function(){EQQ.avatarMouseoverTimer=window.setTimeout(P,500);};var P=function(){K.hideMiniCardPanel();};var T=function(){if(EQQ.avatarMouseoverTimer){clearTimeout(EQQ.avatarMouseoverTimer);EQQ.avatarMouseoverTimer=null;}};var H=function(){EQQ.avatarMouseoverTimer=window.setTimeout(P,500);};var q=function(){qqweb.portal.runApp("userDetails",K.miniCardPanel.uin);};var aj=function(J){J.stopPropagation();};this.onBuddyListClick=function(J){D.notifyObservers(K,"StartChat",J);};var ad=function(ak){ak.preventDefault();ak.stopPropagation();var J=this.getAttribute("uin");D.notifyObservers(K,"StartChat",J);};var ag=function(){var J=this.getAttribute("code");D.notifyObservers(K,"StartGroupChat",J);};this.init=function(){e=false,i=false,O=false,o=false,aa=false,f=false,Z={},X=[],a=[],ab={},G=0,A=null,k=null,R=null,p=null,Q=null,u=false,s=false;D.on(window,"resize",l.bind(this.onWindowResize,this));D.addObserver(EQQ.window,"resize",l.bind(this.onEqqResize,this));D.addObserver(qqweb.layout,"SideBarPinUp",l.bind(this.onWindowResize,this));D.addObserver(qqweb.layout,"SideBarPinDown",l.bind(this.onWindowResize,this));this.EQQ_Container=F.id("EQQ_Container");this.EQQ_MainPanel=F.id("EQQ_MainPanel");this.EQQ_MyPanel=F.id("EQQ_MyPanel");this.EQQ_MyAvatar=F.id("EQQ_MyAvatar");this.EQQ_MyNick=F.id("EQQ_MyNick");this.EQQ_MyState=F.id("EQQ_MyState");this.EQQ_MyStateShow=F.id("EQQ_MyStateShow");this.EQQ_MyState.title="更改在线状态";D.on(this.EQQ_MyState,"click",z);F.show(this.EQQ_MyState);this.EQQ_MySignature=F.id("EQQ_MySignature");this.EQQ_YellowTips=F.id("EQQ_YellowTips");D.on(this.EQQ_YellowTips,"click",this.onYellowTipsClick);this.EQQ_LoginSuccess=F.id("EQQ_LoginSuccess");this.EQQ_SearchBar=F.id("EQQ_SearchBar");this.EQQ_SearchBox=F.id("EQQ_SearchBox");this.EQQ_SearchButton=F.id("EQQ_SearchButton");this.EQQ_SearchResultPanel=F.id("EQQ_SearchResultPanel");this.EQQ_SearchResultPanel_iframeWrap=F.id("EQQ_SearchResultPanel_iframeWrap");D.on(this.EQQ_SearchBox,"mouseover",this.onSearchBoxMouseover);D.on(this.EQQ_SearchBox,"mouseout",this.onSearchBoxMouseout);D.on(this.EQQ_SearchBox,"focus",this.onSearchBoxFocus);D.on(this.EQQ_SearchBox,"blur",this.onSearchBoxBlur);D.on(this.EQQ_SearchBox,"keyup",this.onSearchBoxKeyup);D.on(this.EQQ_SearchBox,"keydown",this.onSearchBoxKeydown);D.on(this.EQQ_SearchBox,"click",l.bind(this.startSearch,this));D.on(this.EQQ_SearchButton,"click",l.bind(function(){if(k){K.hideSearchResult();D.notifyObservers(K,"StartChat",k.uin);}},this));this.EQQ_Logining=F.id("EQQ_Logining");this.EQQ_Logining_feedback=F.id("EQQ_Logining_feedback");this.EQQ_ReLoginPanel=F.id("EQQ_ReLoginPanel");this.EQQ_ReLoginButton=F.id("EQQ_ReLoginButton");D.on(this.EQQ_ReLoginButton,"click",l.bind(this.onReLoginButtonClick,this));this.EQQ_TabBuddyList=F.id("EQQ_TabBuddyList");this.EQQ_TabGroupList=F.id("EQQ_TabGroupList");this.EQQ_TabRecentList=F.id("EQQ_TabRecentList");this.EQQ_ListContainer=F.id("EQQ_ListContainer");this.EQQ_buddyListPanel=F.id("EQQ_buddyListPanel");this.EQQ_buddyList=F.id("EQQ_buddyList");D.on(this.EQQ_buddyList,"mousedown",aj);this.EQQ_createGroupButton=F.id("EQQ_createGroupButton");this.EQQ_searchGroupButton=F.id("EQQ_searchGroupButton");D.on(this.EQQ_createGroupButton,"click",qqweb.util.observer.openInWebBrowser);D.on(this.EQQ_createGroupButton,"click",function(){pgvSendClick({hottag:"WEB2QQ.QQPANEL.QUN.CREATE"});});D.on(this.EQQ_searchGroupButton,"click",qqweb.util.observer.openInWebBrowser);D.on(this.EQQ_searchGroupButton,"click",function(){pgvSendClick({hottag:"WEB2QQ.QQPANEL.QUN.QUNSEEK"});});this.EQQ_ListBottom_maskButton=F.id("EQQ_ListBottom_maskButton");D.on(this.EQQ_ListBottom_maskButton,"click",S);this.EQQ_groupListPanel=F.id("EQQ_groupListPanel");this.EQQ_groupListInner=F.id("EQQ_groupListInner");D.on(this.EQQ_groupListInner,"mousedown",aj);this.EQQ_recentListPanel=F.id("EQQ_recentListPanel");this.EQQ_recentList=F.id("EQQ_recentList");D.on(this.EQQ_recentList,"mousedown",aj);this.EQQ_findBuddy=F.id("EQQ_findBuddy");this.EQQ_buddyManage=F.id("EQQ_buddyManage");D.on(this.EQQ_findBuddy,"click",function(J){J.preventDefault();pgvSendClick({hottag:"WEB2QQ.QQPANEL.CONTACTS.SEEK"});qqweb.portal.runApp("buddyFinder",{});});D.on(this.EQQ_buddyManage,"click",function(J){J.preventDefault();pgvSendClick({hottag:"WEB2QQ.QQPANEL.CONTACTS.MANAGE"});qqweb.portal.runApp("5",{});});this.mainTab=new l.ui.Tab();this.mainTab.add({trigger:this.EQQ_TabBuddyList,sheet:this.EQQ_buddyListPanel});this.mainTab.add({trigger:this.EQQ_TabGroupList,sheet:this.EQQ_groupListPanel});this.mainTab.add({trigger:this.EQQ_TabRecentList,sheet:this.EQQ_recentListPanel});this.mainTab.config.triggerEvent="click";this.mainTab.config.slideEnabled=false;this.mainTab.init();D.addObserver(this.mainTab,"show",function(ak){var J=this.indexOf(ak);switch(J){case 0:pgvSendClick({hottag:"WEB2QQ.QQPANEL.CONTACTS.CONTACTSLIST"});break;case 1:pgvSendClick({hottag:"WEB2QQ.QQPANEL.QUN.QUNLIST"});break;case 2:pgvSendClick({hottag:"WEB2QQ.QQPANEL.RECENT.RECENTLIST"});break;}});this.onWindowResize();};this.createStatePanelDom=function(){var ak=F.node("ul",{id:"EQQ_StatePanel","class":"EQQ_statePanel"});n.appendChild(ak);this.statePanel=new qqweb.layout.PopupBox({noCatchMouseUp:true,container:ak,html:'					<li class="EQQ_statePanel_li" id="EQQ_SetOnline" state="online"><div class="EQQ_stateSelect_icon EQQ_online"></div><div class="EQQ_stateSelect_text">我在线上</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetAway" state="away"><div class="EQQ_stateSelect_icon EQQ_away"></div><div class="EQQ_stateSelect_text">离开</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetHidden" state="hidden"><div class="EQQ_stateSelect_icon EQQ_hidden"></div><div class="EQQ_stateSelect_text">隐身</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetOffline" state="offline"><div class="EQQ_stateSelect_icon EQQ_offline"></div><div class="EQQ_stateSelect_text">离线</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetCallme" state="callme"><div class="EQQ_stateSelect_icon EQQ_callme"></div><div class="EQQ_stateSelect_text">Q我吧</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetBusy" state="busy"><div class="EQQ_stateSelect_icon EQQ_busy"></div><div class="EQQ_stateSelect_text">忙碌</div></li>					<li class="EQQ_statePanel_li" id="EQQ_SetSilent" state="silent"><div class="EQQ_stateSelect_icon EQQ_silent"></div><div class="EQQ_stateSelect_text">请勿打扰</div></li>'});D.addObserver(this.statePanel,"hide",ae);D.addObserver(this.statePanel,"show",V);this.EQQ_SetOnline=F.id("EQQ_SetOnline");this.EQQ_SetCallme=F.id("EQQ_SetCallme");this.EQQ_SetAway=F.id("EQQ_SetAway");this.EQQ_SetBusy=F.id("EQQ_SetBusy");this.EQQ_SetSilent=F.id("EQQ_SetSilent");this.EQQ_SetHidden=F.id("EQQ_SetHidden");this.EQQ_SetOffline=F.id("EQQ_SetOffline");var J=[this.EQQ_SetOnline,this.EQQ_SetCallme,this.EQQ_SetAway,this.EQQ_SetBusy,this.EQQ_SetSilent,this.EQQ_SetHidden,this.EQQ_SetOffline];l.array.forEach(J,function(an,am,al){D.on(an,"mouseover",ai);});l.array.forEach(J,function(an,am,al){D.on(an,"mouseout",r);});l.array.forEach(J,function(an,am,al){D.on(an,"click",x);});};this.createGroupMaskPanelDom=function(){var J=F.node("div",{"class":"groupMaskPanel"});n.appendChild(J);K.groupMaskPanel=new qqweb.layout.PopupBox({container:J,html:' <a id="GroupMask_Costom" state="0" class="simpleMenuItem" href="###"><div class="selectedIcon"></div>使用群自身的消息设置</a>					<a id="GroupMask_Prompt" state="1" class="simpleMenuItem" href="###"><div class="selectedIcon"></div>所有群接收并提示消息</a>					<a id="GroupMask_NoPrompt" state="2" class="simpleMenuItem" href="###"><div class="selectedIcon"></div>所有群接收不提示消息</a>					<a id="GroupMask_Mask" state="3" class="simpleMenuItem" href="###"><div class="selectedIcon"></div>所有群完全阻止群消息</a>'});this.costomDom=F.id("GroupMask_Costom");this.promptDom=F.id("GroupMask_Prompt");this.noPromptDom=F.id("GroupMask_NoPrompt");this.maskDom=F.id("GroupMask_Mask");var ak=[this.costomDom,this.promptDom,this.noPromptDom,this.maskDom];l.array.forEach(ak,function(an,am,al){D.on(an,"click",g);});this.setGroupMaskState(I);};var g=function(ak){ak.preventDefault();var J=this.getAttribute("state");I=J;K.setGroupMaskState(I);D.notifyObservers(K,"SetGroupMaskState",J);switch(J){case"0":pgvSendClick({hottag:"WEB2QQ.QQPANEL.MESSAGESETTING.QUNSELF"});break;case"1":pgvSendClick({hottag:"WEB2QQ.QQPANEL.MESSAGESETTING.WIDTHALERTS"});break;case"2":pgvSendClick({hottag:"WEB2QQ.QQPANEL.MESSAGESETTING.WIDTHOUTALERTS"});break;case"3":pgvSendClick({hottag:"WEB2QQ.QQPANEL.MESSAGESETTING.BLOCK"});break;}};this.setGroupMaskState=function(J){F.removeClass(this.costomDom,"simpleMenuItemSelected");F.removeClass(this.promptDom,"simpleMenuItemSelected");F.removeClass(this.noPromptDom,"simpleMenuItemSelected");F.removeClass(this.maskDom,"simpleMenuItemSelected");J=parseInt(J);switch(J){case 0:F.addClass(this.costomDom,"simpleMenuItemSelected");break;case 1:F.addClass(this.promptDom,"simpleMenuItemSelected");break;case 2:F.addClass(this.noPromptDom,"simpleMenuItemSelected");break;case 3:F.addClass(this.maskDom,"simpleMenuItemSelected");break;}};this.setGroupListMaskState=function(ak,am){var J=F.id("EQQ_GroupList_State_"+ak);var al=F.id("EQQ_RecentList_State_"+ak);if(!am){if(J){F.addClass(J,"EQQ_GroupMask_State");}if(al){F.addClass(al,"EQQ_GroupMask_State");}}else{if(J){F.removeClass(J,"EQQ_GroupMask_State");}if(al){F.removeClass(al,"EQQ_GroupMask_State");}}};var S=function(ak){ak.stopPropagation();var J=F.getClientXY(K.EQQ_ListBottom_maskButton);K.toggleGroupMaskStatePanel(J);};this.toggleGroupMaskStatePanel=function(J){if(this.groupMaskPanel&&this.groupMaskPanel.isShow()){this.hideGroupMaskStatePanel();}else{this.showGroupMaskStatePanel(J);}};this.showGroupMaskStatePanel=function(an){if(this.groupMaskPanel){}else{this.createGroupMaskPanelDom();}if(an){var am=this.groupMaskPanel.getWidth();var ak=this.groupMaskPanel.getHeight();var ao=qqweb.layout.getClientWidth();var al=qqweb.layout.getClientHeight();var J=an[0],ap=an[1]-100;if(J<2){J=2;}if(ap<2){ap=2;}if(J>ao-am-2){J=ao-am-2;}if(ap>al-ak-2){ap=al-ak-2;}this.groupMaskPanel.setXY(J,ap);}this.groupMaskPanel.show();};this.hideGroupMaskStatePanel=function(){if(this.groupMaskPanel){this.groupMaskPanel.hide();}};this.createMiniCardPanelDom=function(){var at=F.node("div",{id:"miniCard","class":"panel_1"});at.innerHTML='			<div class="panel_1_outer">				<div class="panel_1_inner">					<div class="panel_1_container">						<div id="panel_1_center" class="panel_1 panel_1_center"></div>						<div id="panel_1_t" class="panel_1 panel_1_t"></div>						<div id="panel_1_rt" class="panel_1 panel_1_rt"></div>						<div id="panel_1_r" class="panel_1 panel_1_r"></div>						<div id="panel_1_rb" class="panel_1 panel_1_rb"></div>						<div id="panel_1_b" class="panel_1 panel_1_b"></div>						<div id="panel_1_lb" class="panel_1 panel_1_lb"></div>						<div id="panel_1_l" class="panel_1 panel_1_l"></div>						<div id="panel_1_lt" class="panel_1 panel_1_lt"></div>					</div>					<div id="miniCardBody" class="panel_1_content">						<img id="miniCard_avatar" class="miniCard_avatar" />						<div class="miniCard_name">							<div id="miniCard_name_inner" class="miniCard_name_inner"></div>						</div>						<div id="miniCard_signature" class="miniCard_signature">							<div id="miniCard_signature_inner" class="miniCard_signature_inner"></div>						</div>						<div id="miniCard_clientType_innerWrapper" class ="miniCard_clientType_innerWrapper"><div class ="miniCard_clientTypeIcon"></div><div id="miniCard_clientType_inner" class="miniCard_clientType_inner"></div></div>						<div id="miniCard_level" class="miniCard_level">我是等级</div>						<div id="miniCard_quickLink" class="miniCard_quickLink">							<a id="miniCard_qzone" class="miniCard_qzone" type="qzone" title="访问QQ空间" hidefocus target="_blank" href="###"></a>							<a id="miniCard_qmail" class="miniCard_qmail" type="qmail" title="发送邮件" hidefocus target="_blank" href="###"></a>						</div>						<div id="miniCard_buddyOption_tabHead" class="buddyOption_tabHead">							<div id="miniCard_userDetails" class="buddyOption_tabHead_div">详细资料</div>						</div>						<div id="miniCard_buddyOption_tabBody" class="buddyOption_tabBody">						</div>					</div>				</div>			</div>';n.appendChild(at);var ao=F.id("miniCard_avatar");var au=F.id("miniCard_name_inner");var aq=F.id("miniCard_signature");var J=F.id("miniCard_signature_inner");var ap=F.id("miniCard_clientType_inner");var ar=F.id("miniCard_clientType_innerWrapper");var an=F.id("miniCard_level");var ak=F.id("miniCard_qzone");var al=F.id("miniCard_qmail");var am=F.id("miniCard_userDetails");D.on(at,"mouseover",T);D.on(at,"mouseout",H);D.on(am,"click",q);D.on(al,"click",qqweb.util.observer.openInWebBrowser);this.miniCardPanel=new qqweb.layout.Panel({container:at,body:F.id("miniCardBody"),html:""});this.miniCardPanel.setInfo=function(av){this.uin=av.uin;ao.src=EQQ.getUserDefaultAvatar();ao.src=av.avatarUrl;au.innerHTML=av.htmlAllName;au.title=(av.allName);J.innerHTML="";an.innerHTML="";ak.href=EQQ.getQzoneUrl(av.uin);al.href=EQQ.getSendMailUrl(av.uin);if(av.clientType=="1"||av.clientType=="10000"||av.type=="stranger"||!av.clientType){ar.className="miniCard_clientType_innerWrapper";aq.style.display="block";}else{ar.className="miniCard_clientType_"+EQQ.hash.clientType[av.clientType||"10000"];ap.innerHTML=EQQ.hash.clientTypeText[av.clientType||"10000"]+"登录中";aq.style.display="none";}D.notifyObservers(K,"MiniCardShow",av);};this.miniCardPanel.setSignature=function(av){J.innerHTML=av.htmlSignature;J.title=(av.signature);};this.miniCardPanel.setClientType=function(av){if(this.uin==av.uin){if(av.type=="stranger"){}else{if(av.clientType=="1"){ar.className="miniCard_clientType_"+EQQ.hash.clientType[av.clientType||"10000"];ap.innerHTML=EQQ.hash.clientTypeText[av.clientType||"10000"]+"登录中";aq.style.display="none";}else{ar.className="miniCard_clientType_innerWrapper";aq.style.display="block";}}}};this.miniCardPanel.setQQLevel=function(aw){var aC=aw.level;var ax=parseInt(aC/64),aA=parseInt((aC%64)/16),av=parseInt(((aC%64)%16)/4),aB=((aC%64)%16)%4,az="";for(var ay=0;ay<ax;ay++){az+='<div class="miniCard_level_div qqLevel_queen"></div>';}for(var ay=0;ay<aA;ay++){az+='<div class="miniCard_level_div qqLevel_sun"></div>';}for(var ay=0;ay<av;ay++){az+='<div class="miniCard_level_div qqLevel_moon"></div>';}for(var ay=0;ay<aB;ay++){az+='<div class="miniCard_level_div qqLevel_star"></div>';}an.innerHTML=az;an.title="等级: "+aC;};};this.showMiniCardPanel=function(J,ar){if(this.miniCardPanel){}else{this.createMiniCardPanelDom();}if(ar){var ak=this.miniCardPanel.getWidth()+10;var aq=this.miniCardPanel.getHeight()+10;var ap=qqweb.layout.getClientWidth();var am=qqweb.layout.getClientHeight();var ao=ar[0],an=ar[1];if(ao<2){ao=2;}if(an<2){an=2;}if(ao>ap-ak-2){ao=ap-ak-2;}if(an>am-aq-2){an=am-aq-2;}this.miniCardPanel.setXY(ao,an);}var al=EQQ.Model.BuddyList.getUserByUin(J);this.miniCardPanel.setInfo(al);this.miniCardPanel.show();};this.hideMiniCardPanel=function(){if(this.miniCardPanel){this.miniCardPanel.hide();}};this.createDom=function(ak){var J=F.node("div",{id:"EQQ_MainPanel"});J.innerHTML='				<div class="EQQ_title">					<div id="EQQ_PinDownButton" class="EQQ_PinDownButton" title="钉住/收起">钉住/收起</div>					<div id="EQQ_CloseButton" class="EQQ_CloseButton" title="隐藏好友列表">最小化</div>					<div id="EQQ_MinButton" class="EQQ_MinButton" title="设置">设置</div>					<a class="EQQ_FeedbackButton2" href="http://support.qq.com/portal/discuss_pdt/420_1.html" target="_blank">反馈</a>					<div id="EQQ_SettingButton" class="EQQ_settingButton" title="设置WebQQ">						<div class="EQQ_settingButtonIcon">下</div>						<div>设置</div>					</div>					<div class="EQQ_titleText" href="#" target="_blank" title="联系人">联系人</div>					<div class="EQQ_betaText" title="1.0.10.12"></div>				</div>				<div id="EQQ_YellowTips" class="EQQ_YellowTips">					<div id="EQQ_YellowTips_CloseButton" class="EQQ_YellowTips_CloseButton" title="关闭提示">X</div>					<a class="EQQ_YellowTips_Link" href="http://survey.qq.com/cgi-bin/submitsurvey?id=2473&qpage=1&page=1&rm=dnN4k1bBG" target="_blank">邀请参与WebQQ用户调查</a>				</div>				<div id="EQQ_LoginSuccess">					<div id="EQQ_SearchBar" class="EQQ_SearchBar">						<input id="EQQ_SearchBox" class="EQQ_SearchBox" name="" type="text" value="搜索好友..." title="搜索好友..." />						<div id="EQQ_SearchButton" class="EQQ_SearchButton" title="搜索...">搜索按钮</div>					</div>          <div id="EQQ_SearchResultPanel_iframeWrap" class="EQQ_SearchResultPanel_iframeWrap">  					<div id="EQQ_SearchResultPanel" class="EQQ_SearchResultPanel">  						<div class="EQQ_SearchResultItem" title="">Kevity1(666666)</div>  						<div class="EQQ_SearchResultItemHover" title="">Kevity2(666666)</div>  						<div class="EQQ_SearchResultItem" title="">Kevity3(66666)</div>  					</div>            <iframe class="EQQ_SearchResultPanel_iframe"></iframe>  				</div>					<ul class="EQQ_tab">						<li id="EQQ_TabBuddyList" class="EQQ_tabBuddyList" title="联系人"><div class="EQQ_tabBuddyList_icon"></div></li>						<li id="EQQ_TabGroupList" class="EQQ_tabGroupList" title="群列表"><div class="EQQ_tabGroupList_icon"></div></li>						<li id="EQQ_TabRecentList" class="EQQ_tabRecentList" title="最近联系人"><div class="EQQ_tabRecentList_icon"></div></li>					</ul>					<div id="EQQ_ListContainer">						<div id="EQQ_buddyListPanel" class="EQQ_buddyListPanel">							<div id="EQQ_buddyList" class="EQQ_buddyList"><iframe id="iframe_fflist" width="100%" height="100%"  border="0" frameborder="0" style="border:0;overflow:hidden;" allowtransparency="true" src="/module/eqq/swf/fflist.html?t=20101022001"></iframe>							</div>							<div class="EQQ_ListBottom">								<a href="" id="EQQ_findBuddy" class="searchBuddy" target="_blank"><div class="searchBuddy_div"></div>查找</a>								<a href="" id="EQQ_buddyManage" class="buddy_manage_icon" target="_blank"><div class="buddy_manage_icon_div"></div>管理</a>							</div>						</div>						<div id="EQQ_groupListPanel" class="EQQ_groupListPanel"><div class="EQQ_groupListOuter"><div id="EQQ_groupListInner" class="EQQ_groupListInner"></div></div>							<div class="EQQ_ListBottom">								<a id="EQQ_createGroupButton" class="createGroup" href="http://qun.qq.com/air/create" target="_blank" title="创建群"><div class="createGroup_div"></div>创建</a>								<a id="EQQ_searchGroupButton" class="searchGroup" href="http://qun.qq.com/air/search" target="_blank" title="查找群"><div class="searchGroup_div"></div>查找</a>								<div id="EQQ_ListBottom_maskButton"><div></div>群屏蔽</div>							</div>						</div>						<div id="EQQ_recentListPanel" class="EQQ_recentListPanel"><div id="EQQ_recentList" class="EQQ_recentList"></div></div>					</div>				</div>				<div style="height:1000px;width:1000px;">					<div id="EQQ_Logining">发起连接...</div>				</div>				<div id="EQQ_Logining_feedback"><a href="http://support.qq.com/write.shtml?guest=1&fid=513" target="_blank">					<span class="warnning_yellow">&nbsp;</span>反馈登录建议</a></div>				<div id="EQQ_ReLoginPanel">					登录失败，<span id="EQQ_ReLoginButton">重试</span>				</div>';ak.innerHTML="";ak.appendChild(J);F.setClass(J,"EQQ_mainPanel");};this.onYellowTipsClick=function(){K.hideYellowTips();D.notifyObservers(K,"CloseYellowTipsFinish");};this.showYellowTips=function(){b=b+y;this.onWindowResize();F.show(this.EQQ_YellowTips);};this.hideYellowTips=function(){F.hide(this.EQQ_YellowTips);b=b-y;this.onWindowResize();};this.onEqqResize=function(am){var J=5;var ak=am.height;var al=ak-v;if(al<J){al=J;}F.setStyle(this.EQQ_ListContainer,"height",(al-J)+"px");F.setStyle(this.EQQ_buddyListPanel,"height",(al-J-25)+"px");B();};this.onWindowResize=function(J){};this.onSearchBoxMouseover=function(){F.setClass(this,"EQQ_SearchBoxHover");};this.onSearchBoxMouseout=function(){F.setClass(this,"EQQ_SearchBox");};this.onSearchBoxFocus=function(){D.off(K.EQQ_SearchBox,"mouseover",K.onSearchBoxMouseover);D.off(K.EQQ_SearchBox,"mouseout",K.onSearchBoxMouseout);F.setClass(this,"EQQ_SearchBoxFocus");K.clearSearchBox(this);this.select();K.startSearch();};this.onSearchBoxBlur=function(){D.on(K.EQQ_SearchBox,"mouseover",K.onSearchBoxMouseover);D.on(K.EQQ_SearchBox,"mouseout",K.onSearchBoxMouseout);F.setClass(this,"EQQ_SearchBox");K.resetSearchBox(this);K.hideSearchResult();};this.resetSearchBox=function(J){if(J.value==""){J.value="搜索好友...";}};this.clearSearchBox=function(J){if(l.string.trim(J.value)=="搜索好友..."){J.value="";}};this.onSearchButtonClick=function(){K.startSearch();};this.onSearchBoxKeyup=function(J){if(!K.EQQ_SearchBox.value){K.hideSearchResult();return;}if(J.keyCode!=Y&&J.keyCode!=E){K.startSearch();}};this.onSearchBoxKeydown=function(ak){switch(ak.keyCode){case N:if(k){ak.preventDefault();K.hideSearchResult();D.notifyObservers(K,"StartChat",k.uin);}break;case Y:if(G>0){var J=F.id("EQQ_SearchResultItem_"+k.uin);F.setStyle(J,"backgroundColor","transparent");G--;k=R[G];J=F.id("EQQ_SearchResultItem_"+k.uin);if(J){F.setStyle(J,"backgroundColor","#cbe7fc");}}break;case E:if(G<R.length-1){var J=F.id("EQQ_SearchResultItem_"+k.uin);F.setStyle(J,"backgroundColor","transparent");G++;k=R[G];J=F.id("EQQ_SearchResultItem_"+k.uin);if(J){F.setStyle(J,"backgroundColor","#cbe7fc");}}break;default:break;}};this.startSearch=function(){this.clearSearchBox(this.EQQ_SearchBox);var J=this.EQQ_SearchBox.value;D.notifyObservers(this,"Search",J);};this.showSearchResult=function(J){if(this.EQQ_SearchBox.value){R=J;var an=F.getRelativeXY(this.EQQ_SearchBox,this.EQQ_MainPanel);F.setStyle(this.EQQ_SearchResultPanel_iframeWrap,"left",an[0]+"px");F.setStyle(this.EQQ_SearchResultPanel_iframeWrap,"top",(an[1]+26)+"px");F.show(this.EQQ_SearchResultPanel);F.show(this.EQQ_SearchResultPanel_iframeWrap);this.EQQ_SearchResultPanel.innerHTML="";if(J.length==0){G=null;k=null;this.EQQ_SearchResultPanel.innerHTML='<div class="EQQ_SearchResultNo">没有找到相关好友</div>';}else{G=0;k=J[0];for(var al=0;al<J.length;al++){var ak=J[al];var am=F.node("div");F.setClass(am,"EQQ_SearchResultItem");am.id="EQQ_SearchResultItem_"+ak.uin;am.setAttribute("uin",ak.uin);am.innerHTML=ak.htmlAllName;am.title=(ak.allName);this.EQQ_SearchResultPanel.appendChild(am);if(al==0){F.setStyle(am,"backgroundColor","#cbe7fc");}D.on(am,"mouseover",this.onSearchResultMouseover);D.on(am,"mouseout",this.onSearchResultMouseout);D.on(am,"mousedown",this.onSearchResultClick);}}D.on(document,"mousedown",l.bind(this.hideSearchResult,this));}};this.hideSearchResult=function(){F.hide(this.EQQ_SearchResultPanel_iframeWrap);D.off(document,"mousedown");};this.onSearchResultMouseover=function(){F.setStyle(this,"backgroundColor","#cbe7fc");};this.onSearchResultMouseout=function(){F.setStyle(this,"backgroundColor","transparent");};this.onSearchResultClick=function(){var J=this.getAttribute("uin");K.hideSearchResult();D.notifyObservers(K,"StartChat",J);};this.show=function(){F.show(this.EQQ_MainPanel);};this.hide=function(){F.hide(this.EQQ_MainPanel);};this.updateSelfInfoChange=function(J){this.EQQ_MyAvatar.src=EQQ.getUserAvatar(J.uin);this.EQQ_MyAvatar.title="修改资料";this.EQQ_MyNick.innerHTML=J.htmlShowName;this.EQQ_MyNick.title=(J.showName+"<"+J.uin+">");};this.updateSelfStateChange=function(J){F.setClass(this.EQQ_MyStateShow,"EQQ_myStateShow EQQ_"+J);if(J==="offline"){F.addClass(this.EQQ_MyAvatar,"EQQ_myAvatar_offline");}else{F.removeClass(this.EQQ_MyAvatar,"EQQ_myAvatar_offline");}};this.updateSelfSignatureChange=function(J){if(J.signature){this.EQQ_MySignature.innerHTML=J.htmlSignature;this.EQQ_MySignature.title=(J.signature);}else{this.EQQ_MySignature.innerHTML="有个性，没签名";this.EQQ_MySignature.title="有个性，没签名";}};this.createBuddyClass=function(J){};this.addOnlineBuddyClass=function(){var J={};J.index=EQQ.hash.userClassType.online;J.name="在线好友";J.htmlName=l.string.toHtml(J.name);J.titleName=l.string.encodeHtmlSimple(J.name);J.count=0;J.onlineCount=0;J.list={callme:[],online:[],away:[],busy:[],silent:[],offline:[]};this.addBuddyClass(J);};this.addStrangerBuddyClass=function(){var J={};J.index=EQQ.hash.userClassType.stranger;J.name="陌生人";J.htmlName=l.string.toHtml(J.name);J.titleName=l.string.encodeHtmlSimple(J.name);J.count=0;J.onlineCount=0;J.list={callme:[],online:[],away:[],busy:[],silent:[],offline:[]};this.addBuddyClass(J);};this.addBlackListBuddyClass=function(){var J={};J.index=EQQ.hash.userClassType.blacklist;J.name="黑名单";J.htmlName=l.string.toHtml(J.name);J.titleName=l.string.encodeHtmlSimple(J.name);J.count=0;J.onlineCount=0;J.list={callme:[],online:[],away:[],busy:[],silent:[],offline:[]};this.addBuddyClass(J);};this.addBuddyClass=function(an,al){var J,am,ak;J=F.node("div",{id:"EQQ_listClassHead_"+an.index,classIndex:an.index});if(an.index==EQQ.hash.userClassType.online){am='					<div class="EQQ_listClassHeadIcon">icon</div>					<div class="EQQ_ClassList_RightContainer" title="<%=titleName%>">						<%=htmlName%>[<span id="EQQ_Class_<%=index%>_OnlineCounter"><%=onlineCount%></span>]					</div>				';}else{am='					<div class="EQQ_listClassHeadIcon">icon</div>					<div class="EQQ_ClassList_RightContainer" title="<%=titleName%>">						<%=htmlName%>&nbsp;[<span id="EQQ_Class_<%=index%>_OnlineCounter"><%=onlineCount%></span>/<span id="EQQ_Class_<%=index%>_Counter"><%=count%></span>]					</div>				';}ak=l.string.template(am,an);J.innerHTML=ak;if(al){this.EQQ_buddyList.insertBefore(J,al);}else{this.EQQ_buddyList.appendChild(J);}D.on(J,"click",ah);var ao=F.node("div",{id:"EQQ_listClassBody_"+an.index,"class":"EQQ_listClassBody"});am='				<div id="EQQ_Class_<%=index%>_callme" class="EQQ_callmeBuddy"></div>				<div id="EQQ_Class_<%=index%>_online" class="EQQ_onlineBuddy"></div>				<div id="EQQ_Class_<%=index%>_busy" class="EQQ_busyBuddy"></div>				<div id="EQQ_Class_<%=index%>_away" class="EQQ_awayBuddy"></div>				<div id="EQQ_Class_<%=index%>_silent" class="EQQ_silentBuddy"></div>				<div id="EQQ_Class_<%=index%>_offline" class="EQQ_offlineBuddy"></div>			';ak=l.string.template(am,an);ao.innerHTML=ak;this.EQQ_buddyList.insertBefore(ao,J.nextSibling);this.collapsedClass(an.index);};this.hideLogin=function(){F.hide(this.EQQ_Logining);F.hide(this.EQQ_Logining_feedback);F.hide(this.EQQ_ReLoginPanel);F.show(this.EQQ_LoginSuccess);F.setStyle(this.EQQ_LoginSuccess,"height","100%");var J={height:EQQ.window.getBodySize().height,width:EQQ.window.getBodySize().width};this.onEqqResize(J);};this.showLogin=function(){this.EQQ_Logining.innerHTML="发起连接...";F.show(this.EQQ_Logining);F.show(this.EQQ_Logining_feedback);F.hide(this.EQQ_ReLoginPanel);F.hide(this.EQQ_LoginSuccess);F.setStyle(this.EQQ_LoginSuccess,"height","0px");};this.showPullData=function(){};this.clearBuddyList=function(){if(u){this.flex.clearBuddyList();}};this.createBuddyList=function(J){};this.getClassExpandFlag=function(J){return Z[J];};this.setClassExpandFlag=function(ak,J){return Z[ak]=J;};this.getClassAvatarLoadFlag=function(J){return ab[J];};this.setClassAvatarLoadFlag=function(ak,J){return ab[ak]=J;};this.toggleClass=function(J){if(Z[J]){this.collapsedClass(J);}else{this.expandClass(J);}};this.collapsedClass=function(ak){var J=F.id("EQQ_listClassHead_"+ak),al=F.id("EQQ_listClassBody_"+ak);if(ak==EQQ.hash.userClassType.online){F.setClass(J,"EQQ_onlineClassHeadCollapsed");}else{F.setClass(J,"EQQ_listClassHeadCollapsed");}F.setStyle(al,"height","0");this.setClassExpandFlag(ak,false);};this.expandClass=function(ak){var J=F.id("EQQ_listClassHead_"+ak),al=F.id("EQQ_listClassBody_"+ak);if(ak==EQQ.hash.userClassType.online){F.setClass(J,"EQQ_onlineClassHeadExpand");}else{F.setClass(J,"EQQ_listClassHeadExpand");}F.setStyle(al,"height","auto");this.setClassExpandFlag(ak,true);l.out("index: "+ak);M();};var M=function(){j(K.EQQ_buddyListPanel);};var af=function(J){B();};var B=function(J){if(af.timer){window.clearTimeout(af.timer);af.timer=null;}af.timer=window.setTimeout(M,500);};var j=function(am){var au=parseInt(F.getStyle(am,"height"),10);var al=am.scrollTop;var ar=F.getXY(am)[1];for(var ao=0;ao<a.length;){var an=a[ao];var J=an.imgEl;var ak=an.uin;var ap=an.classId;var aq=F.getXY(J)[1];var at=aq-ar;l.out("imgTop1:"+at+"y2:"+aq);if(K.getClassExpandFlag(ap)&&J&&at>0&&at<au){l.out("checkAndLoadAvatar & loadAvatar containerHeight: "+au+", imgTop2:"+at);J.src=EQQ.getUserAvatar(an.uin);a.splice(ao,1);}else{ao++;}}};this.onBuddyStateChange=function(J){if(u){this.flex.onBuddyStateChange(J);}};this.onOnlineBuddyChange=function(J){if(u){this.flex.onOnlineBuddyChange(J);}};this.addBuddy=function(ak){var J={classId:ak.classId,uin:ak.uin,clientType:ak.clientType,state:ak.state,nick:ak.nick};if(u){this.flex.addBuddy(J);}};this.addOnlineBuddy=function(ak){var J={uin:ak.uin,clientType:ak.clientType,state:ak.state,nick:ak.nick};if(u){this.flex.addOnlineBuddy(J);}};this.removeOnlineBuddy=function(J){if(u){this.flex.removeOnlineBuddy(J.uin);}};this.updateOnlineBuddyClass=function(J){if(u){this.flex.updateOnlineBuddyClass(J.length);}};this.flexStartJump=function(J){if(u){this.flex.startjump(J);}};this.flexStopJump=function(J){if(u){this.flex.stopjump(J);}};this.jumpUp=function(J){};this.jumpDown=function(J){};this.jumpAvatar=function(J){};this.flickerClassHide=function(J){};this.flickerClassShow=function(J){};this.flickerClass=function(J){};this.groupJumpUp=function(ak){o=true;for(var J=0;J<ak.length;J++){var al=F.id("EQQ_Group_"+ak[J]);if(al){F.addClass(al,"EQQ_jumpUpInGroupList");}}};this.groupJumpDown=function(ak){o=false;for(var J=0;J<ak.length;J++){var al=F.id("EQQ_Group_"+ak[J]);if(al){F.removeClass(al,"EQQ_jumpUpInGroupList");}}};this.groupJumpAvatar=function(J){if(o){this.groupJumpDown(J);}else{this.groupJumpUp(J);}};this.recentJumpUp=function(ak){aa=true;for(var J=0;J<ak.length;J++){var al=F.id("EQQ_Recent_"+ak[J]);if(al){F.addClass(al,"EQQ_jumpUpInBuddyList");F.addClass(al,"EQQ_jumpUpInGroupList");}}};this.recentJumpDown=function(ak){aa=false;for(var J=0;J<ak.length;J++){var al=F.id("EQQ_Recent_"+ak[J]);if(al){F.removeClass(al,"EQQ_jumpUpInBuddyList");F.removeClass(al,"EQQ_jumpUpInGroupList");}}};this.recentJumpAvatar=function(J){if(aa){this.recentJumpDown(J);}else{this.recentJumpUp(J);}};this.moveBuddy=function(ak){var J={uin:ak.uin,state:ak.state};if(u){this.flex.moveBuddy(J);}};this.moveOnlineBuddy=function(ak){var J={uin:ak.uin,state:ak.state};if(u){this.flex.moveOnlineBuddy(J);}};this.updateClientType=function(ak){var J={uin:ak.uin,clientType:ak.clientType};if(u){this.flex.updateClientType(J);}};this.updateBuddyClassOnlineBuddy=function(J){var ak={index:J.index,onlineCount:J.onlineCount};if(u){this.flex.updateBuddyClassOnlineBuddy(ak);}};this.updateRecentState=function(ak){var an=F.id("EQQ_Recent_"+ak.uin);if(an){an.className="";F.addClass(an,"EQQ_BuddyList_Buddy");F.addClass(an,"EQQ_"+EQQ.hash.onlineStatus[ak.state]+"Buddy");var am=EQQ.hash.clientType[ak.clientType];var al=EQQ.hash.clientTypeText[ak.clientType||"PC"];var J=F.id("EQQ_RecentList_ClientType_"+ak.uin)||{};var ao=F.id("EQQ_RecentList_ClientType_Title_"+ak.uin)||{};J.className="EQQ_BuddyList_ClientType_"+am;ao.title=al;}};this.updateBuddyClassCount=function(J){var ak={index:J.index,count:J.count};if(u){this.flex.updateBuddyClassCount(ak);}};this.updateStrangerClassOnlineCount=function(J){if(u){this.flex.updateStrangerClassOnlineCount(J);}};this.updateStrangerClassCount=function(J){if(u){this.flex.updateStrangerClassCount(J.length);}};this.setUserName=function(J){if(J.markName){var ak={uin:J.uin,nick:J.markName};if(u){this.flex.setUserName(ak);}}};this.setGroupMask=function(J){I=J;switch(J){case"0":case 0:F.id("EQQ_ListBottom_maskButton").className="accept";F.id("EQQ_ListBottom_maskButton").childNodes[0].className="accept_div";break;case"1":case 1:F.id("EQQ_ListBottom_maskButton").className="accept";F.id("EQQ_ListBottom_maskButton").childNodes[0].className="accept_div";break;case"2":case 2:F.id("EQQ_ListBottom_maskButton").className="mask";F.id("EQQ_ListBottom_maskButton").childNodes[0].className="mask_div";break;case"3":case 3:F.id("EQQ_ListBottom_maskButton").className="mask";F.id("EQQ_ListBottom_maskButton").childNodes[0].className="mask_div";break;}};this.showReLoginPanel=function(){F.hide(this.EQQ_Logining);F.hide(this.EQQ_Logining_feedback);F.show(this.EQQ_ReLoginPanel);F.hide(this.EQQ_LoginSuccess);};this.onReLoginButtonClick=function(){F.show(this.EQQ_Logining);F.show(this.EQQ_Logining_feedback);F.hide(this.EQQ_ReLoginPanel);F.hide(this.EQQ_LoginSuccess);D.notifyObservers(this,"ReLogin");};this.createGroupList=function(J){this.EQQ_groupListInner.innerHTML="";for(var ak=0;ak<J.length;ak++){this.addGroup(J[ak]);}};this.addGroup=function(al){var J='				<div class="EQQ_GroupList_AvatarContainer" title="">					<img id="EQQ_GroupList_Avatar_'+al.gid+'" class="EQQ_GroupList_Avatar" src="'+EQQ.getGroupAvatar(al.code)+'" />					<div class="EQQ_GroupList_State" id="EQQ_GroupList_State_'+al.gid+'" title="群屏蔽"></div>				</div>				<div class="EQQ_GroupList_RightContainer" title="<%=titleAllName%> - <%=titleTypeText%>">					<div class="EQQ_GroupList_Name"><%=htmlShowName%></div>				</div>			';var ak=l.string.template(J,al);var am=F.node("div",{id:"EQQ_Group_"+al.gid,code:al.code});am.innerHTML=ak;this.EQQ_groupListInner.appendChild(am);D.on(am,"mouseover",C);D.on(am,"click",ag);F.addClass(am,"EQQ_GroupList_Group");};this.createRecentList=function(ak){this.EQQ_recentList.innerHTML="";for(var J=0;J<ak.length;J++){this.addRecent(ak[J]);}};this.addRecent=function(at){if(at.content){if(at.type==0){var am=at.content;var an='						<div class="EQQ_RecentList_ClientType" uin="<%=uin%>" id="EQQ_BuddyList_ClientType_Title_<%=uin%>" title="'+EQQ.hash.clientTypeText[am.clientType||"PC"]+'">							<div id="EQQ_RecentList_ClientType_<%=uin%>" class="EQQ_BuddyList_ClientType_'+EQQ.hash.clientType[am.clientType||"10000"]+'"></div>						</div>						<div id="EQQ_RecentList_AvatarContainer_<%=uin%>" class="EQQ_BuddyList_AvatarContainer" uin="<%=uin%>" title="'+EQQ.hash.onlineStatusText[am.state]+'">							<img id="EQQ_RecentList_Avatar_<%=uin%>" class="EQQ_BuddyList_Avatar" src="'+EQQ.CONST.EQQ_SERVER_URL+'style/images/avatar_default_20_20.gif" />							<div class="EQQ_BuddyList_State"></div>						</div>						<div id="EQQ_RecentList_RightContainer_<%=uin%>" class="EQQ_BuddyList_RightContainer" title="<%=titleAllName%> - '+EQQ.hash.onlineStatusText[am.state]+'">							<div id="EQQ_BuddyList_Nick_<%=uin%>" class="EQQ_BuddyList_Nick"><%=htmlShowName%></div>						</div>					';var al=l.string.template(an,am);var ar=F.node("div",{id:"EQQ_Recent_"+am.uin,uin:am.uin});ar.innerHTML=al;this.EQQ_recentList.insertBefore(ar,this.EQQ_recentList.firstChild);D.on(ar,"mouseover",C);D.on(ar,"mouseout",L);D.on(ar,"click",ad);var ap=F.id("EQQ_RecentList_AvatarContainer_"+am.uin);D.on(ap,"mouseover",W);D.on(ap,"mouseout",h);F.addClass(ar,"EQQ_BuddyList_Buddy");F.addClass(ar,"EQQ_"+EQQ.hash.onlineStatus[am.state]+"Buddy");var J=F.id("EQQ_RecentList_Avatar_"+am.uin);if(am.uin&&J){J.src=EQQ.getUserAvatar(am.uin);}}else{var ao=at.content;var aq='					<div class="EQQ_GroupList_AvatarContainer" title="">						<img id="EQQ_GroupList_Avatar_'+ao.gid+'" class="EQQ_GroupList_Avatar" src="'+EQQ.getGroupAvatar(ao.code)+'" />						<div class="EQQ_GroupList_State" id="EQQ_RecentList_State_'+ao.gid+'" title="群屏蔽"></div>					</div>					<div class="EQQ_GroupList_RightContainer" title="<%=titleAllName%> - <%=titleTypeText%>">						<div class="EQQ_GroupList_Name"><%=htmlShowName%></div>					</div>				';var al=l.string.template(aq,ao);var ak=F.node("div",{id:"EQQ_Recent_"+ao.gid,code:ao.code});ak.innerHTML=al;this.EQQ_recentList.insertBefore(ak,this.EQQ_recentList.firstChild);D.on(ak,"mouseover",C);D.on(ak,"click",ag);F.addClass(ak,"EQQ_GroupList_Group");}}};this.updateRecentByBuddy=function(J){var ak=F.id("EQQ_Recent_"+J.uin);if(ak){this.EQQ_recentList.insertBefore(ak,this.EQQ_recentList.firstChild);}else{this.addRecent({type:0,content:J});}};this.updateRecentByGroup=function(J){var ak=F.id("EQQ_Recent_"+J.gid);if(ak){this.EQQ_recentList.insertBefore(ak,this.EQQ_recentList.firstChild);}else{this.addRecent({type:1,content:J});}};this.setMode=function(J){switch(J){case"master":c=U;F.removeClass(this.EQQ_MyState,"EQQ_DisableMyStateSelect");this.EQQ_MyState.title="更改在线状态";break;case"slave":c=m;F.addClass(this.EQQ_MyState,"EQQ_DisableMyStateSelect");this.EQQ_MyState.title="WebQQ现在处于辅模式，请从客户端QQ修改您的在线状态。";break;}};this.toggleStatePanel=function(J){if(this.statePanel&&this.statePanel.isShow()){this.hideStatePanel();}else{this.showStatePanel(J);}};this.showStatePanel=function(an){if(this.statePanel){}else{this.createStatePanelDom();}if(an){var am=this.statePanel.getWidth();var ak=this.statePanel.getHeight();var ao=qqweb.layout.getClientWidth();var al=qqweb.layout.getClientHeight();var J=an[0],ap=an[1];if(J<2){J=2;}if(ap<2){ap=2;}if(J>ao-am-2){J=ao-am-2;}if(ap>al-ak-2){ap=al-ak-2;}this.statePanel.setXY(J,ap);}this.statePanel.setTopZIndex();this.statePanel.show();};this.hideStatePanel=function(){if(this.statePanel){this.statePanel.hide();}};this.setSelfState=function(J){D.notifyObservers(this,"SelfStateChange",J);this.updateSelfStateChange(J);};});Jet().$package("EQQ.Presenter.MainPanel",function(m){var w=this,u=m.dom,t=m.event;var e=false;var s=[],v=[],n=[],g=[],r=true,k=false,o="";var h=false;var q=false;var z=false;this.init=function(){e=false;s=[];v=[];n=[];g=[];r=true;k=false,o="";h=false;q=false;z=false;this.View=EQQ.View.MainPanel;if(m.browser.ie){if(m.browser.ie==7){var A=m.GetSwfVer();if(A!=-1){var D=A.split(" ");var C=D[1];var B=C.split(",");if(parseInt(B[0])>=10){q=true;this.View=EQQ.View.MainPanelFlex;t.addObserver(EQQ.Model.ChatMsg,"flexStartJump",m.bind(this.onFlexStartJump,this));t.addObserver(EQQ.Model.ChatMsg,"flexStopJump",m.bind(this.onFlexStopJump,this));}else{b();}}else{b();}}}this.View.createDom(this.getContainer());t.addObserver(EQQ,"CloseWebQQ",m.bind(this.onCloseWebQQ,this));t.addObserver(EQQ,"SelfOffline",m.bind(this.onSelfOffline,this));t.addObserver(EQQ.Model.BuddyList,"SelfInfoChange",m.bind(this.onSelfInfoChange,this));t.addObserver(EQQ.Model.BuddyList,"SelfStateChange",m.bind(this.updateSelfStateChange,this));t.addObserver(EQQ.Model.BuddyList,"SelfSignatureChange",m.bind(this.handleSelfSignatureChange,this));t.addObserver(EQQ.Model.BuddyList,"UserSignatureChange",c);t.addObserver(EQQ.Model.BuddyList,"UserQQLevelChange",y);t.addObserver(EQQ.Model.BuddyList,"LoginFail",m.bind(this.onLoginFail,this));t.addObserver(EQQ.Model.BuddyList,"GetUserInfoSuccess",m.bind(this.onGetUserInfoSuccess,this));t.addObserver(EQQ.Model.BuddyList,"BuddyClassChange",m.bind(this.onBuddyClassChange,this));t.addObserver(EQQ.Model.BuddyList,"AllClassOnlineBuddyReady",m.bind(this.onAllClassOnlineBuddyReady,this));t.addObserver(EQQ.Model.BuddyList,"AddBuddy",m.bind(this.onAddANewBuddy,this));t.addObserver(EQQ.Model.BuddyList,"GroupListChange",m.bind(this.onGroupListChange,this));t.addObserver(EQQ.Model.BuddyList,"GroupMaskChange",m.bind(this.onGroupMaskChange,this));t.addObserver(EQQ.Model.BuddyList,"SingleGroupMaskChange",m.bind(this.onSingleGroupMaskChange,this));t.addObserver(EQQ.Model.BuddyList,"RecentListChange",m.bind(this.onRecentListChange,this));t.addObserver(EQQ.Model.ChatMsg,"NewStranger",m.bind(this.onNewStranger,this));t.addObserver(EQQ.Model.ChatMsg,"MessageBoxUserListChange",m.bind(this.onMessageBoxUserListChange,this));t.addObserver(EQQ.Model.ChatMsg,"MessageBoxGroupListChange",m.bind(this.onMessageBoxGroupListChange,this));t.addObserver(EQQ.Model.ChatMsg,"MessageListChange",m.bind(this.onMessageListChange,this));t.addObserver(EQQ.Model.ChatMsg,"GroupMessageListChange",m.bind(this.onGroupMessageListChange,this));t.addObserver(this.View,"StartChat",a);t.addObserver(this.View,"StartGroupChat",p);t.addObserver(this.View,"SelfStateChange",m.bind(this.onViewSelfStateChange,this));t.addObserver(this.View,"SetGroupMaskState",l);t.addObserver(this.View,"AddPObservers",m.bind(this.onAddPObservers,this));t.addObserver(this.View,"ExitPortal",m.bind(this.onExitPortal,this));t.addObserver(this.View,"CloseWebQQ",m.bind(i,this));t.addObserver(this.View,"MinMainPanel",m.bind(f,this));t.addObserver(this.View,"ReLogin",m.bind(d,this));t.addObserver(this.View,"Search",m.bind(this.onSearch,this));t.addObserver(this.View,"BuddyListReady",m.bind(this.onBuddyListDomReady,this));t.addObserver(this.View,"CloseYellowTipsFinish",m.bind(this.onCloseYellowTipsFinish,this));t.addObserver(this.View,"MiniCardShow",j);this.View.init();if(this.View.setNoneFlashStyle){this.View.setNoneFlashStyle();}};var b=function(){var A=new qqweb.businessClass.Window({title:"温馨提示",modeSwitch:true,dragable:true,resize:true,width:420,height:120,hasCloseButton:true,hasOkButton:true,isSetCentered:true});var B='<div style="width:100%; height:100%; background-color:#FFFFFF; line-height:60px;text-align:center; vertical-align:middle;">						检测到您为IE7内核用户，请安装最新<a target="_blank" href="http://get.adobe.com/flashplayer">Flash版本</a>，获得更好体验！					   </div>';A.setHtml(B);};this.onAddPObservers=function(){t.addObserver(EQQ.Model.BuddyList,"BuddyListChange",m.bind(this.onBuddyListChange,this));t.addObserver(EQQ.Model.BuddyList,"BuddyStateChange",m.bind(this.onBuddyStateChange,this));t.addObserver(EQQ.Model.BuddyList,"OnlineBuddyChange",m.bind(this.onOnlineBuddyChange,this));r=false;};this.onBuddyListDomReady=function(){if(!k){if(r){t.addObserver(EQQ.Model.BuddyList,"BuddyListChange",m.bind(this.onBuddyListChange,this));t.addObserver(EQQ.Model.BuddyList,"BuddyStateChange",m.bind(this.onBuddyStateChange,this));t.addObserver(EQQ.Model.BuddyList,"OnlineBuddyChange",m.bind(this.onOnlineBuddyChange,this));}t.addObserver(EQQ.Model.BuddyList,"UserNameChange",m.bind(this.onUserNameChange,this));k=true;}h=true;};this.getContainer=function(){return EQQ.panel.mainPanel;};this.getMyPanelContainer=function(){return EQQ.panel.myPanel;};var c=function(A){if(w.View.miniCardPanel){m.out("onUserSignatureChange 33:"+A.uin);w.View.miniCardPanel.setSignature(A);}};var y=function(A){if(w.View.miniCardPanel){m.out("onUserQQLevelChange 33:"+A.uin);w.View.miniCardPanel.setQQLevel(A);}};var j=function(A){if(A){EQQ.Model.BuddyList.getUserSignature(A.uin);EQQ.Model.BuddyList.sendGetQQLevel(A.uin);}};this.showYellowTips=function(){this.View.showYellowTips();};this.hideYellowTips=function(){this.View.hideYellowTips();};this.onCloseYellowTipsFinish=function(){this.setCookieTips("hide");};this.getCookieTips=function(){return m.cookie.get("is_close_tips",EQQ.CONST.MAIN_DOMAIN);};this.setCookieTips=function(A){m.cookie.set("is_close_tips",A,EQQ.CONST.MAIN_DOMAIN,null,120);};this.onSearch=function(B){var C=5;var A=EQQ.Model.BuddyList.searchBuddy(B,C);this.View.showSearchResult(A);};this.showMiniCardPanel=function(A,B){this.View.showMiniCardPanel(A,B);};this.hideMiniCardPanel=function(){this.View.hideMiniCardPanel();};this.onLoginFail=function(){alert("登录失败，请稍后重试");};this.onSelfInfoChange=function(A){this.View.updateSelfInfoChange(A);};this.updateSelfStateChange=function(A){this.View.updateSelfStateChange(A);};this.handleSelfSignatureChange=function(A){this.View.updateSelfSignatureChange(A);};this.onSelfOffline=function(B){var A=EQQ.Model.BuddyList.getSelf();z=false;h=false;EQQ.stopPoll();if(A){A.oldState=A.state;A.state="offline";}this.updateSelfStateChange("offline");qqweb.portal.alert(B);};this.onBuddyClassChange=function(A){this.clearBuddyList();this.View.createBuddyClass(A);this.View.hideLogin();};this.onAllClassOnlineBuddyReady=function(){if(!z){z=true;this.onBuddyClassListReady();}};this.onBuddyClassListReady=function(){EQQ.loginEnd=(new Date()).getTime();var A=EQQ.loginEnd-EQQ.loginStart;A=A/1000;m.out("time: "+A);if(A<=1){}else{if(A<=5){}else{if(A<=10){}else{if(A<=60){}else{}}}}};this.onBuddyListChange=function(A){if(h){}else{if(!q){this.updateAllBuddyClassCount(EQQ.Model.BuddyList.getClassList());this.createBuddyList(A);}}};this.onGroupListChange=function(A){this.View.createGroupList(A);};this.onAddANewBuddy=function(F){var G=this;var B=F.user;var A=F.newstate;this.View.addBuddy(B);var E=B.classId;var D=EQQ.Model.BuddyList.getClassById(E);this.View.updateBuddyClassCount(D);if(F.markname){var C=EQQ.Model.BuddyList.getBuddyByUin(B.uin);C.setMarkName(F.markname);}t.notifyObservers(EQQ.Model.BuddyList,"BuddyStatusChange",A);};this.onRecentListChange=function(B){for(var A=0;A<B.length;A++){if(B[A].type==0){B[A].content=EQQ.Model.BuddyList.getBuddyByUin(B[A].uin);}else{B[A].content=EQQ.Model.BuddyList.getGroupByGid(B[A].uin);}}this.View.createRecentList(B);};this.onUserNameChange=function(A){this.View.setUserName(A);};this.onGroupMaskChange=function(C){var A=EQQ.Model.BuddyList.getGroupList();for(var B=0;B<A.length;B++){var D=A[B];var E=EQQ.Model.BuddyList.isGroupPrompt(D.gid);this.View.setGroupListMaskState(D.gid,E);}this.View.setGroupMask(C);};this.onSingleGroupMaskChange=function(A){var B=EQQ.Model.BuddyList.isGroupPrompt(A.gid);this.View.setGroupListMaskState(A.gid,B);};this.onGetUserInfoSuccess=function(A){m.console.info(A);};this.onNewStranger=function(A){var C=EQQ.Model.BuddyList.getStrangerList();var B=C.length;this.View.updateStrangerClassOnlineCount(B);this.View.updateStrangerClassCount(C);this.View.addBuddy(A);};this.updateAllBuddyClassCount=function(B){for(var A=0;A<B.length;A++){this.updateBuddyClassCount(B[A]);}};this.updateBuddyClassCount=function(A){this.View.updateBuddyClassCount(A);};this.createBuddyList=function(A){this.View.createBuddyList(A);};this.updateRecentByBuddy=function(A){this.View.updateRecentByBuddy(A);};this.updateRecentByGroup=function(A){this.View.updateRecentByGroup(A);};this.onBuddyStateChange=function(C){if(q){if(h){var B=EQQ.Model.BuddyList.getUserByUin(C);var A={uin:B.uin,client_type:B.clientType,state:B.state,nick:B.nick};this.View.onBuddyStateChange(A);}}else{var B=EQQ.Model.BuddyList.getUserByUin(C);this.View.moveBuddy(B);this.View.moveOnlineBuddy(B);this.View.updateClientType(B);this.View.updateRecentState(B);if(this.View.miniCardPanel){this.View.miniCardPanel.setClientType(B);}}};this.onOnlineBuddyChange=function(C){if(q){if(h){var B=EQQ.Model.BuddyList.getUserByUin(C);var A={uin:B.uin,client_type:B.clientType,state:B.state,nick:B.showName};this.View.onOnlineBuddyChange(A);}}else{var B=EQQ.Model.BuddyList.getUserByUin(C);var F=EQQ.Model.BuddyList.getClassByUin(C);var E=EQQ.hash.onlineStatus.offline;var D=EQQ.Model.BuddyList.getOnlineBuddy();this.View.updateBuddyClassOnlineBuddy(F);this.View.updateOnlineBuddyClass(D);if(B.state==E){this.View.removeOnlineBuddy(B);}else{this.View.addOnlineBuddy(B);}}};this.onFlexStartJump=function(A){this.View.flexStartJump(A);};this.onFlexStopJump=function(A){this.View.flexStopJump(A);};this.onMessageBoxUserListChange=function(B){var A=EQQ.Model.BuddyList.getSelf();var D=(typeof EQQ.Presenter.TaskBar!="undefined")?EQQ.Presenter.TaskBar.getCurrentTaskUin():false;this.View.jumpDown(v);this.View.flickerClassShow(n);s=[];v=[];n=[];for(var C=0;C<B.length;C++){if(D!=B[C].from_uin){s.push(B[C].from_uin);if(EQQ.Model.BuddyList.getSelfState()=="callme"){a(B[C].from_uin);}}}if(s.length!==0){EQQ.addNeedBeat2("mainPanel");t.addObserver(EQQ,"NotifyBeat_250",x);}};this.onMessageBoxGroupListChange=function(C){var A=EQQ.Model.BuddyList.getSelf();var E;try{E=EQQ.Presenter.TaskBar.getCurrentTaskUin();}catch(D){}this.View.jumpDown(g);g=[];for(var B=0;B<C.length;B++){if(E!=C[B].from_uin&&EQQ.Model.BuddyList.isGroupPrompt(C[B].from_uin)){g.push(C[B].from_uin);}if(EQQ.Model.BuddyList.getSelfState()=="callme"&&EQQ.Model.BuddyList.isGroupPrompt(C[B].from_uin)){p(C[B].group_code);}}if(g.length!==0){EQQ.addNeedBeat2("mainPanel");t.addObserver(EQQ,"NotifyBeat_250",x);}};this.onMessageListChange=function(A){var B=EQQ.Model.BuddyList.getBuddyByUin(A.uin);if(B){this.View.updateRecentByBuddy(B);}};this.onGroupMessageListChange=function(A){var B=EQQ.Model.BuddyList.getGroupByGid(A.gid);if(B){this.View.updateRecentByGroup(B);}};var l=function(A){EQQ.Model.BuddyList.sendChangeGroupMask({type:"global",uin:EQQ.Model.BuddyList.getSelfUin(),mask:A});};var a=function(A){EQQ.api.call(["chat",["single",A]]);};var p=function(A){EQQ.api.call(["chat",["group",A]]);};this.collapsedAllClass=function(){var B=EQQ.Model.BuddyList.getClassList();for(var A=0;A<B.length;A++){this.View.collapsedClass(B[A].index);}};var i=function(){EQQ.exit();};var f=function(){this.hide();};var d=function(){EQQ.login();};this.onExitPortal=function(){qqweb.portal.exit();};this.onCloseWebQQ=function(){z=false;h=false;this.hide();this.View.showLogin();};this.clearBuddyList=function(){this.View.clearBuddyList();};this.showLogin=function(){this.View.showLogin();};this.show=function(){e=true;this.View.show();};this.hide=function(){e=false;this.View.hide();};this.toggleShow=function(){if(e){this.hide();}else{this.show();}};this.showReLoginPanel=function(){this.View.showReLoginPanel();};var x=function(){v=[];n=[];var D=s.concat(g);if(D.length===0){t.removeObserver(EQQ,"NotifyBeat_250",x);EQQ.removeNeedBeat2("mainPanel");}for(var A=0;A<s.length;A++){var B=s[A];var C=EQQ.Model.BuddyList.getClassIdByUin(B);if(w.View.getClassExpandFlag(C)){v.push(B);}else{if(m.array.indexOf(n,C)==-1){n.push(C);}}}if(v.length>0){w.View.jumpAvatar(v);}if(n.length>0){w.View.flickerClass(n);}if(g.length>0){w.View.groupJumpAvatar(g);}if(D.length>0){w.View.recentJumpAvatar(D);}};this.onViewSelfStateChange=function(C){var B="offline";var A=EQQ.Model.BuddyList.getSelf();if(A){B=A.state;A.state=C;}m.out("==onViewSelfStateChange, self: "+C+", old: "+B);if(B=="offline"&&C!="offline"){A.state=C;EQQ.login(C);}else{EQQ.Model.BuddyList.sendChangeStatus(C);}if(C=="offline"){z=false;h=false;EQQ.stopPoll();}if(C=="callme"){}};});